<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Trading Junction Journal</title>

  <!-- âœ… Google Verification -->
  <meta name="google-site-verification" content="iarkQywYkFLaL6gvIPgngYWjFFN8u-QZjH87QpdezZk" />

  <!-- âœ… Favicon -->
  <link rel="icon" type="image/png" href="https://livetradingjunction-cyber.github.io/Live-trading-Junction-Journal/favicon.ico" />
  <link rel="apple-touch-icon" href="https://livetradingjunction-cyber.github.io/Live-trading-Junction-Journal/favicon.ico" />
  <meta name="theme-color" content="#111827" />

  <!-- âœ… SEO Meta -->
  <meta
    name="description"
    content="ðŸ“Š Live Trading Junction Journal â€” Real-time Trading Tracker for Nifty, Banknifty, Gold, BTC & Crypto. Smart Analytics. Discipline-Based PnL Insights."
  />
  <meta
    name="keywords"
    content="Live Trading Journal, Nifty Tracker, Banknifty Journal, BTC Gold Calculator, Crypto Trades, Live PnL Tracker, Trader Discipline App"
  />
  <meta name="author" content="LiveTradingJunction-Cyber" />

  <!-- âœ… Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L1VHQ9XSFQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-L1VHQ9XSFQ");
  </script>

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: #f9fafb;
      overflow-x: hidden;
    }

    /* ðŸ’š View-Only Mode Blinking Badge */
    .viewOnlyBadge {
      position: fixed;
      bottom: 130px; /* moved up for better visibility */
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #16a34a, #22c55e);
      color: white;
      font-weight: 600;
      padding: 12px 28px;
      border-radius: 30px;
      box-shadow: 0 0 25px rgba(22, 163, 74, 0.5);
      animation: pulseGlow 2.5s infinite ease-in-out;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      z-index: 10000;
    }

    .viewOnlyBadge::before {
      content: "ðŸ”’";
      font-size: 18px;
    }

    @keyframes pulseGlow {
      0% {
        transform: translateX(-50%) scale(1);
        box-shadow: 0 0 25px rgba(22, 163, 74, 0.5);
        opacity: 1;
      }
      50% {
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 0 40px rgba(22, 163, 74, 0.8);
        opacity: 0.85;
      }
      100% {
        transform: translateX(-50%) scale(1);
        box-shadow: 0 0 25px rgba(22, 163, 74, 0.5);
        opacity: 1;
      }
    }

    /* ðŸ”´ Back To Journal Button */
    .backToJournal {
      position: fixed;
      bottom: 55px; /* moved up a bit */
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #ef4444, #b91c1c);
      color: #fff;
      border: none;
      font-weight: 600;
      padding: 12px 26px;
      border-radius: 12px;
      cursor: pointer;
      z-index: 9999;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      transition: transform 0.25s ease;
    }

    .backToJournal:hover {
      transform: translateX(-50%) scale(1.07);
    }

    /* Disable Inputs for View-Only Mode */
    .viewOnlyDim {
      pointer-events: none !important;
      opacity: 0.6 !important;
    }
  </style>
</head>

<body>
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Trading Journal</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- Added: React and Babel for Range Calculator -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
/* ---------- ROOT VARIABLES (Default: Premium Dark Blue) ---------- */
:root {
  --bg: #0f172a;
  --container-bg: #1e293b;
  --text: #f8fafc;
  --text-light: #e2e8f0;
  --text-muted: #94a3b8;
  --border: #475569;
  --input-bg: #334155;
  --input-border: #475569;
  --btn-primary: #3b82f6;
  --btn-success: #10b981;
  --btn-danger: #ef4444;
  --profit-color: #16a34a;
  --loss-color: #dc2626;
  --neutral-color: #facc15;
  --title-gradient: linear-gradient(135deg,#6366f1 0%,#8b5cf6 50%,#d946ef 100%);
  --shadow: 0 10px 40px rgba(0,0,0,0.1);
  --card-shadow: 0 4px 15px rgba(0,0,0,0.08);
  /* Updated: More vibrant theme-matching colors for weekly cells */
  --weekly-color1: #dbeafe; /* Vibrant light blue for odd columns (Mon, Wed, Fri) */
  --weekly-color2: #dcfce7; /* Vibrant light green for even columns (Tue, Thu, Weekend) */
  /* New: Light styling for form fields */
  --field-light: rgba(248, 250, 252, 0.8);
}
/* LIGHT-GRAY-SILVER MODE */
[data-theme="light-gray-silver"] {
  --bg: #f1f5f9;
  --container-bg: #ffffff;
  --text: #0f172a;
  --text-light: #475569;
  --text-muted: #64748b;
  --border: #cbd5e1;
  --input-bg: #e2e8f0;
  --input-border: #cbd5e1;
  --btn-primary: #2563eb;
  /* Updated: Vibrant light variants for weekly cells */
  --weekly-color1: #dbeafe; /* Vibrant light blue */
  --weekly-color2: #dcfce7; /* Vibrant light green */
  /* Light variant for form fields */
  --field-light: rgba(248, 250, 252, 0.8);
}
/* GRAPHITE-BLUE MODE */
[data-theme="graphite-blue"] {
  --bg: #1e293b;
  --container-bg: #334155;
  --text: #f8fafc;
  --text-light: #cbd5e1;
  --text-muted: #94a3b8;
  --border: #64748b;
  --input-bg: #475569;
  --input-border: #64748b;
  --btn-primary: #38bdf8;
  /* Updated: Vibrant blue variants for weekly cells */
  --weekly-color1: #dbeafe; /* Vibrant light blue */
  --weekly-color2: #3b82f6; /* Vibrant blue */
  /* Blue variant for form fields */
  --field-light: rgba(30, 64, 175, 0.8);
}
/* ---------- WEEKLY REPORT SPECIFIC STYLES ---------- */
#weeklyArea {
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
}
#weeklyArea .container {
  background: var(--container-bg);
  border: none;
  box-shadow: none;
}
#weeklyArea .view-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}
#weeklyArea .view-btn {
  padding: 8px 16px;
  background: linear-gradient(135deg, #10b981, #059669);
  color: #fff;
  border: 2px solid transparent;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
#weeklyArea .view-btn:nth-child(2) {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}
#weeklyArea .view-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}
#weeklyArea .view-btn:nth-child(2):hover {
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}
#weeklyArea .view-btn.active {
  background: linear-gradient(135deg, #059669, #047857);
  transform: scale(1.05);
}
#weeklyArea .view-btn.active:nth-child(2) {
  background: linear-gradient(135deg, #7c3aed, #6d28d9);
}
#weeklyArea .nav {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}
#weeklyArea .nav button {
  padding: 8px 12px;
  background: #ef4444;
  color: #fff;
  border: 2px solid transparent;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
#weeklyArea .nav button:nth-child(3) {
  background: #ef4444;
}
#weeklyArea .nav button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}
#weeklyArea .nav button:nth-child(3):hover {
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}
#weeklyArea .nav select {
  padding: 8px;
  background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
  color: var(--text);
  border: 2px solid #d1d5db;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 600;
}
[data-theme="premium-dark-blue"] #weeklyArea .nav select,
[data-theme="graphite-blue"] #weeklyArea .nav select {
  background: linear-gradient(135deg, #374151, #4b5563);
  color: #f9fafb;
  border-color: #6b7280;
}
#weeklyArea .calendar-grid {
  width: 100%;
  border-collapse: collapse;
  background: #ffffff;
  border: 1px solid #1e40af;
  table-layout: fixed;
}
#weeklyArea .calendar-header {
  background: var(--container-bg);
}
#weeklyArea .calendar-header th {
  padding: 10px;
  text-align: center;
  font-size: 16px;
  color: white;
  border: 1px solid #1e40af;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  font-weight: bold;
}
/* Simplified: Use only 2 permanent colors for headers (alternating) */
#weeklyArea .calendar-header th:nth-child(odd) { /* Mon, Wed, Fri, Weekend (1,3,5,6) */
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}
#weeklyArea .calendar-header th:nth-child(even) { /* Tue, Thu, Total (2,4,7) */
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}
/* Theme overrides for headers with 2 colors */
[data-theme="light-gray-silver"] #weeklyArea .calendar-header th:nth-child(odd),
[data-theme="light-gray-silver"] #weeklyArea .calendar-header th:nth-child(even) {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}
[data-theme="graphite-blue"] #weeklyArea .calendar-header th:nth-child(odd),
[data-theme="graphite-blue"] #weeklyArea .calendar-header th:nth-child(even) {
  background: linear-gradient(135deg, #475569 0%, #6b7280 100%);
  color: white;
}
/* Permanent 2-color backgrounds for cells (alternating columns, not overridden by profit/loss unless specified) */
#weeklyArea .calendar-cell:nth-child(odd) { /* Mon, Wed, Fri, Total (1,3,5,7) */
  background: #ffffff !important;
}
#weeklyArea .calendar-cell:nth-child(even) { /* Tue, Thu, Weekend (2,4,6) */
  background: #ffffff !important;
}
/* Theme overrides for cells */
[data-theme="premium-dark-blue"] #weeklyArea .calendar-cell:nth-child(odd),
[data-theme="graphite-blue"] #weeklyArea .calendar-cell:nth-child(odd) { /* Mon, Wed, Fri, Total */
  background: var(--container-bg) !important;
}
[data-theme="premium-dark-blue"] #weeklyArea .calendar-cell:nth-child(even),
[data-theme="graphite-blue"] #weeklyArea .calendar-cell:nth-child(even) { /* Tue, Thu, Weekend */
  background: var(--container-bg) !important;
}
#weeklyArea .calendar-cell {
  min-height: 50px;
  padding: 10px;
  text-align: center;
  font-size: 16px;
  border: 1px solid #1e40af;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  vertical-align: top;
  color: var(--text);
  font-weight: bold;
}
#weeklyArea .calendar-cell:hover {
  filter: brightness(1.05); /* Subtle hover without changing base color */
}
#weeklyArea .calendar-cell.today {
  border: 3px solid var(--btn-primary); /* Highlight today without overriding base bg */
}
/* Updated: Full background override for profit/loss to ensure visibility and change */
#weeklyArea .calendar-cell.profit {
  background: #dcfce7 !important;
  color: #16a34a !important;
  border-left: 4px solid var(--profit-color);
}
#weeklyArea .calendar-cell.loss {
  background: #fee2e2 !important;
  color: #dc2626 !important;
  border-left: 4px solid var(--loss-color);
}
/* Dark theme overrides for profit/loss */
[data-theme="premium-dark-blue"] #weeklyArea .calendar-cell.profit,
[data-theme="graphite-blue"] #weeklyArea .calendar-cell.profit {
  background: #064e3b !important;
  color: #d1fae5 !important;
}
[data-theme="premium-dark-blue"] #weeklyArea .calendar-cell.loss,
[data-theme="graphite-blue"] #weeklyArea .calendar-cell.loss {
  background: #451a03 !important;
  color: #fed7d7 !important;
}
#weeklyArea .calendar-cell.holiday {
  border-top: 3px dashed #1976d2; /* Accent for holiday */
  color: #1976d2;
}
[data-theme="premium-dark-blue"] #weeklyArea .calendar-cell.holiday,
[data-theme="graphite-blue"] #weeklyArea .calendar-cell.holiday {
  color: white;
}
#weeklyArea .calendar-cell.other-month {
  opacity: 0.3;
}
#weeklyArea .calendar-cell input {
  width: 100%;
  background: transparent;
  border: none;
  color: var(--text);
  font-size: 16px;
  text-align: center;
  font-family: monospace;
}
#weeklyArea .weekend-col {
  background: #e3f2fd !important; /* Ensure weekend uses unique holiday color */
}
[data-theme="premium-dark-blue"] #weeklyArea .weekend-col,
[data-theme="graphite-blue"] #weeklyArea .weekend-col {
  background: #1e3a8a !important; /* Dark variant for weekend */
}
#weeklyArea .total-col {
  background: #ffffff !important; /* Ensure total uses color1 (odd) */
  font-weight: bold;
  color: #60a5fa;
}
#weeklyArea .year-view {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 20px;
}
#weeklyArea .month-card {
  padding: 14px;
  background: linear-gradient(180deg, #ffffff, #f6f7ff);
  border: 2px solid var(--input-border);
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s;
  color: var(--text);
}
[data-theme="premium-dark-blue"] #weeklyArea .month-card,
[data-theme="graphite-blue"] #weeklyArea .month-card {
  background: linear-gradient(180deg, var(--container-bg), #334155);
}
#weeklyArea .month-card:hover {
  transform: scale(1.02);
}
#weeklyArea .month-card.profit {
  border: 2px solid var(--profit-color);
}
#weeklyArea .month-card.loss {
  border: 2px solid var(--loss-color);
}
#weeklyArea .month-card h4 {
  margin-bottom: 8px;
  font-size: 16px;
  color: var(--text);
}
#weeklyArea .month-card .val {
  font-weight: 900;
  font-size: 20px;
}
#weeklyArea .month-card.profit .val {
  color: var(--profit-color);
}
#weeklyArea .month-card.loss .val {
  color: var(--loss-color);
}
#weeklyArea .month-card .winrate {
  font-size: 13px;
  color: var(--text-muted);
}
#weeklyArea .footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px solid var(--border);
}
#weeklyArea .radio-group {
  display: flex;
  gap: 5px;
  align-items: center;
}
#weeklyArea .radio-group input[type="radio"] {
  display: none;
}
/* Updated: Complete blue background for PnL Amt label */
#weeklyArea #pnlToggle + label {
  padding: 10px 20px;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border: 2px solid #3b82f6;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
  color: #ffffff;
}
/* Updated: Complete green background for Win Ratio label */
#weeklyArea #winToggle + label {
  padding: 10px 20px;
  background: linear-gradient(135deg, #10b981, #059669);
  border: 2px solid #10b981;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
  color: #ffffff;
}
/* Checked states enhanced with brighter gradients */
#weeklyArea .radio-group input[type="radio"]:checked + label {
  background: linear-gradient(135deg, #6366f1, #4f46e5);
  color: white;
  border-color: #6366f1;
  transform: scale(1.05);
}
#weeklyArea #winToggle:checked + label {
  background: linear-gradient(135deg, #059669, #047857);
  color: white;
  border-color: #059669;
  transform: scale(1.05);
}
#weeklyArea input[type="radio"] {
  margin-right: 5px;
}
#weeklyArea .clear-btn {
  padding: 8px 16px;
  background: var(--btn-danger);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
}
#weeklyArea .clear-btn:hover {
  background: #dc2626;
}
#weeklyArea .back-btn {
  padding: 10px 20px;
  background: linear-gradient(90deg, #8b5cf6, #f472b6);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  margin-bottom: 20px;
}
#weeklyArea .back-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}
#weeklyArea .title-box {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
  padding: 25px 30px;
  border-radius: 15px;
  margin-bottom: 30px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
  border: 3px solid rgba(255, 255, 255, 0.3);
}
#weeklyArea .title-box h1 {
  color: #ffffff;
  font-size: 34px;
  font-weight: 900;
  margin-bottom: 16px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  letter-spacing: 1px;
}
#weeklyArea .title-box p {
  color: rgba(255, 255, 255, 0.95);
  font-size: 16px;
  font-weight: 600;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}
#weeklyArea .table-wrapper {
  overflow-x: auto;
  border-radius: 12px;
  box-shadow: var(--card-shadow);
  margin-bottom: 40px;
}
#weeklyArea table {
  width: 100%;
  border-collapse: collapse;
  background: var(--input-bg);
}
#weeklyArea thead th {
  background: var(--title-gradient);
  color: #fff;
  padding: 14px 10px;
  text-align: left;
  font-size: 12px;
  font-weight: 600;
  white-space: nowrap;
  position: sticky;
  top: 0;
  z-index: 3;
}
#weeklyArea td {
  padding: 12px 10px;
  border: 1px solid var(--border);
  font-size: 13px;
  background: var(--container-bg);
  color: var(--text);
}
#weeklyArea tbody tr:hover td {
  background: var(--input-bg);
}
#weeklyArea .profit {
  color: var(--profit-color);
  font-weight: 700;
}
#weeklyArea .loss {
  color: var(--loss-color);
  font-weight: 700;
}
.week-summary-card {
  padding: 15px;
  background: linear-gradient(180deg, #ffffff, #f0fdf4);
  border: 4px solid #10b981;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
  margin: 0 auto 20px;
  max-width: 250px;
}
.week-summary-card h4 {
  font-size: 18px;
  color: #065f46;
  margin-bottom: 10px;
  font-weight: bold;
}
.week-summary-card .val {
  font-size: 28px;
  font-weight: 900;
  color: #10b981;
  margin-bottom: 10px;
}
.week-summary-card.loss {
  background: linear-gradient(180deg, #ffffff, #fef2f2);
  border-color: #ef4444;
  box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);
}
.week-summary-card.loss h4 {
  color: #991b1b;
}
.week-summary-card.loss .val {
  color: #ef4444;
}
/* Highlighted week row background */
#weeklyArea tr.highlighted-week {
  background-color: #dbeafe !important;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:'Segoe UI',Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
  min-height:100vh;
  transition:background .3s ease;
}
.container {
  max-width:1400px; margin:0 auto; background:var(--container-bg); border-radius:20px;
  padding:30px; box-shadow:var(--shadow); transition:all .3s ease;
  /* NEW: Added border for complete layout with matching theme color */
  border: 2px solid #CBBD93;
}
/* Updated: Blue border for home page layout (#journalArea) */
#journalArea {
  border: 4px solid #CBBD93 !important;
}
/* ---------- TITLE BAR ---------- */
.title-bar {
  background:linear-gradient(135deg,#6366f1,#d946ef);
  padding:20px 30px; border-radius:18px; margin-bottom:25px; text-align:center;
  box-shadow:0 8px 25px rgba(99,102,241,0.4);
}
.title-bar h1 {
  color:#fff; font-size:48px; font-weight:900; margin:0; text-shadow:2px 2px 4px rgba(0,0,0,0.3);
  display:flex; align-items:center; justify-content:center; gap:10px;
  padding: 15px 30px;
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  border-radius: 50px;
  border: 2px solid rgba(255,255,255,0.3);
  box-shadow: 0 8px 25px rgba(79,70,229,0.4);
}
.title-bar p {
  color:rgba(255,255,255,0.9); font-size:15px; margin-top:8px; font-weight:600;
}
/* ---------- GOLDEN WORDS ---------- */
.golden-words {
  background:linear-gradient(135deg,#f59e0b,#fb923c);
  color:#000000;
  padding:16px;
  border-radius:14px;
  margin-bottom:20px;
  text-align:center;
  font-weight:700;
  font-size:18px;
  box-shadow:var(--card-shadow);
  overflow:hidden;
  white-space:nowrap;
  position:relative;
}
.golden-words span {
  display:inline-block;
  animation: scroll 20s linear infinite; /* Increased duration for slower scrolling */
}
@keyframes scroll {
  0% { transform:translateX(100%); }
  100% { transform:translateX(-100%); }
}
/* ---------- STATS ---------- */
.stats {
  display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-bottom:20px;
}
.stat-card {
  background:#1e3a8a; color:#fff; padding:16px; border-radius:14px; text-align:center;
  box-shadow:var(--card-shadow); font-weight:700; transition:transform .2s;
}
[data-theme="light-gray-silver"] .stat-card { background:#1e40af; }
[data-theme="graphite-blue"] .stat-card { background: linear-gradient(135deg, #475569, #6b7280); color: #fff; box-shadow: 0 0 20px rgba(148, 163, 184, 0.5); }
.stat-card:hover { transform:translateY(-3px); }
.stat-card h3 {
  font-size:20px; /* Increased from 16px for better emoji visibility */
  margin-bottom:6px;
  opacity:0.9;
  line-height: 1.2; /* Ensure emoji and text align properly */
}
.stat-card .value { font-size:24px; }
.stat-card.profit .value { color:var(--profit-color); }
.stat-card.loss .value { color:var(--loss-color); }
/* New: Gold Calculator Button in Stats - Right-aligned with nice background */
.gold-calc-btn {
  background: linear-gradient(135deg, #ffd700, #ffed4e) !important;
  color: #000 !important;
  font-weight: bold !important;
  border: 2px solid #b8860b !important;
  cursor: pointer !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  text-align: center !important;
  padding: 16px !important;
  min-height: 80px !important;
  transition: all 0.3s ease !important;
}
.gold-calc-btn:hover {
  transform: translateY(-3px) !important;
  box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4) !important;
}
.gold-calc-btn h3 {
  font-size: 16px !important;
  margin-bottom: 5px !important;
  opacity: 1 !important;
}
.gold-calc-btn .value {
  font-size: 18px !important;
  color: #b8860b !important;
}
/* ---------- ACTION BUTTONS BAR ---------- */
.action-bar {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap:12px; margin-bottom:25px;
  padding:15px 20px; background:var(--input-bg); border-radius:16px;
  border:2px solid var(--border); box-shadow:var(--card-shadow);
  max-width: 1200px; /* Updated: Increased max-width from 900px to 1200px for more space */
  width: 100%; /* Updated: Full width to utilize container space */
  margin: 0 auto 25px auto;
}
.action-btn {
  padding:8px 12px; border-radius:12px; font-weight:700; font-size:12px; color:#fff;
  cursor:pointer; display:flex; align-items:center; gap:8px; min-width:120px; /* Updated: Increased min-width from 100px to 120px */
  justify-content:center;
  transition:all .3s ease; box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
.action-btn:hover { transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,0.3); }
.action-btn:active { transform:scale(0.98); }
.add-btn { background:linear-gradient(135deg,#6366f1,#8b5cf6); }
.excel-btn { background:linear-gradient(135deg,#10b981,#34d399); }
.clear-btn { background:linear-gradient(135deg,#ef4444,#f87171); }
.monthly-btn{ background:linear-gradient(135deg,#8b5cf6,#c084fc); }
.yearly-btn { background:linear-gradient(135deg,#f472b6,#ec4899); }
.weekly-btn { background:linear-gradient(135deg,#06b6d4,#3b82f6); }
.pdf-btn { background:linear-gradient(135deg,#f59e0b,#fb923c); }
.charts-btn { background:linear-gradient(135deg,#3b82f6,#1d4ed8); }
.filter-btn { background:linear-gradient(135deg,#059669,#047857); }
.risk-btn { background:linear-gradient(135deg,#d97706,#b45309); }
.theme-btn { background:linear-gradient(135deg,#94a3b8,#64748b); }
.notify-btn { background:linear-gradient(135deg,#f59e0b,#fb923c); }
.crypto-btn { background:linear-gradient(135deg,#8b5cf6,#ec4899); }
.daily-btn { background:linear-gradient(135deg,#ef4444,#f87171); }
.capital-btn { background: linear-gradient(135deg, #00c6ff, #0072ff); }
/* New: Gold Calculator Action Button */
.gold-calc-action-btn { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000 !important; border: 2px solid #b8860b; }
/* New: BTC Calculator Action Button */
.btc-calc-action-btn { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000 !important; border: 2px solid #00bcd4; }
/* New: Nifty Setup Action Button */
.nifty-setup-btn { background: linear-gradient(135deg, #f6d365, #fda085); color: #000 !important; border: 2px solid #f97316; }
/* New: Range Calculator Action Button - Added near Nifty Setup */
.range-calc-btn { background: linear-gradient(135deg, #8b5cf6, #ec4899); color: #fff !important; border: 2px solid #d946ef; }
/* New: Email Export Button Style */
email-btn { background: linear-gradient(135deg, #8b5cf6, #ec4899); }
.action-btn .icon { font-size:14px; }
/* ---------- FORM ---------- */
.form-area {
  background:var(--input-bg); padding:15px; border-radius:16px; margin-bottom:25px;
  display:none; border:2px solid var(--border); /* Removed max-height and overflow-y to avoid scroll */
  box-shadow:var(--card-shadow);
}
.form-area.show { display:block; }
.form-area h3 { color:var(--text); margin-bottom:15px; font-size:18px; display:flex; align-items:center; gap:8px; } /* Kept font size 18px */
/* Updated: Removed ::before content for Pencil icon */
.form-area h3::before { content: none; } /* Removed Pencil icon */
/* Updated: Compact grid for 4-column layout - Reduced min width and gaps */
.form-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(120px, 1fr)); /* Reduced from 150px to 120px for compactness */
  grid-template-rows: repeat(7, auto); /* Changed to 7 rows as per request */
  gap: 8px; /* Reduced from 12px to 8px */
  margin-bottom: 8px; /* Reduced from 12px to 8px */
  border: 3px solid var(--border); /* Updated: Increased border thickness and ensured visibility around complete layout */
  border-radius: 12px; /* Rounded corners for the bordered layout */
  padding: 15px; /* Updated: Increased inner padding for better spacing */
  box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Added subtle shadow for emphasis */
}
.form-field {
  background: var(--field-light);
  border-radius: 6px; /* Reduced from 8px */
  padding: 6px; /* Reduced from 8px */
  border: 1px solid var(--input-border);
  transition: box-shadow 0.2s;
}
.form-field:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.form-field label {
  display:block;
  margin-bottom:3px; /* Reduced from 5px */
  /* Increased font-size a bit more from 14px to 16px */
  font-size: 16px;
  color:var(--text-light);
  font-family: 'Segoe UI', Arial, sans-serif; /* Ensure consistent font */
  font-weight: bold;
}
.form-field input,.form-field select,.form-field textarea {
  width:100%; padding:4px; /* Reduced from 6px */
  border:1px solid var(--input-border); background:transparent; color:var(--text);
  border-radius:3px; /* Reduced from 4px */
  font-size: 12px;
  /* Updated: Made bolder by setting font-weight (500) */
  font-weight: normal;
  text-shadow: 0 0 1px rgba(0,0,0,0.1);
  transition:border-color .3s;
  /* NEW: Uniform height for all single-line fields */
  height: 35px;
  box-sizing: border-box;
}
.form-field select {
  overflow-y: auto;
}
.form-field input::placeholder,
.form-field select::placeholder,
.form-field textarea::placeholder {
  /* Updated: Increased font-size to 18px and font-weight to 700 for better visibility and boldness */
  font-size: 14px;
  font-weight: normal;
  color: var(--text-muted);
}
.form-field input:focus,.form-field select:focus,.form-field textarea:focus {
  outline:none; border-color:var(--btn-primary);
  box-shadow: 0 0 10px var(--btn-primary);
}
.form-field textarea {
  resize: vertical;
  min-height: 35px;
  height: auto; /* Allow expansion but start uniform */
  /* NEW: Override height for textarea to match single-line fields initially */
  height: 35px;
} /* Reduced min-height from 60px to 40px */
/* New: Read-only for calculated fields */
.form-field.readonly input { background: #f0f0f0; color: var(--text-muted); font-weight: bold; }
.hidden { display:none !important; }
/* ---------- TABLE ---------- */
.table-wrapper { overflow-x:auto; border-radius:12px; box-shadow:var(--card-shadow); margin-bottom:40px; }
table { width:100%; border-collapse:collapse; background:var(--input-bg); }
thead th {
  background:var(--title-gradient); color:#000; padding:14px 10px; text-align:center; font-size:14px; font-weight:700;
  white-space:nowrap; position:sticky; top:0; z-index:3;
}
td { padding:12px 10px; border:1px solid var(--border); font-size:13px; background:var(--container-bg); color:var(--text); text-align: center; }
tbody tr:hover td { background:var(--input-bg); }
.profit { color:var(--profit-color); font-weight:700; }
.loss { color:var(--loss-color); font-weight:700; }
/* ---------- MONTH TABLE AND YEARLY TABLE SPECIFIC STYLING ---------- */
.month-table table, .yearly-table table { border-collapse: collapse; }
.month-table th, .month-table td, .yearly-table th, .yearly-table td { border: 1px solid #1e40af; font-weight: bold; text-align: center; padding: 8px 6px; }
.month-table td:nth-child(2), .yearly-table td:nth-child(2) { /* Targeting the "Total P&L" column */
  color: var(--text); /* Default color */
}
.month-table td:nth-child(2).profit, .yearly-table td:nth-child(2).profit { color: var(--profit-color); } /* Green for profit */
.month-table td:nth-child(2).loss, .yearly-table td:nth-child(2).loss { color: var(--loss-color); } /* Red for loss */
.month-table td:nth-child(4), .yearly-table td:nth-child(4) { /* Targeting the "Avg P&L / Trade" column */
  color: var(--text); /* Default color */
}
.month-table td:nth-child(4).profit, .yearly-table td:nth-child(4).profit { color: var(--profit-color); } /* Green for profit */
.month-table td:nth-child(4).loss, .yearly-table td:nth-child(4).loss { color: var(--loss-color); } /* Red for loss */
/* Updated: Added for Biggest Winner (nth-child(5)) and Biggest Loser (nth-child(6)) */
.month-table td:nth-child(5).profit, .yearly-table td:nth-child(5).profit { color: var(--profit-color); } /* Green for profit */
.month-table td:nth-child(5).loss, .yearly-table td:nth-child(5).loss { color: var(--loss-color); } /* Red for loss */
.month-table td:nth-child(6).profit, .yearly-table td:nth-child(6).profit { color: var(--profit-color); } /* Green for profit */
.month-table td:nth-child(6).loss, .yearly-table td:nth-child(6).loss { color: var(--loss-color); } /* Red for loss */
.month-table tbody tr.profit, .yearly-table tbody tr.profit { background: #c6f6d5 !important; } /* Green background for profit */
.month-table tbody tr.loss, .yearly-table tbody tr.loss { background: #fed7d7 !important; } /* Red background for loss */
/* ---------- CALENDAR STYLING ---------- */
.calendar-cell {
  border: 1px solid #1e40af;
  font-weight: bold;
  text-align: center !important;
  vertical-align: middle !important;
  padding: 10px;
}
.calendar-cell.empty { background: #f8f9fa; color: #999; }
.calendar-cell.holiday { background: #e3f2fd; color: #1976d2; }
.calendar-cell.profit { background: #c6f6d5 !important; color: var(--profit-color) !important; }
.calendar-cell.loss { background: #fed7d7 !important; color: var(--loss-color) !important; }
/* Override for monthly calendar th padding and border */
#monthlyArea table th {
  padding: 8px !important;
  border: 1px solid #1e40af !important;
}
/* ---------- RESPONSIVE ---------- */
@media (max-width:768px) {
  .action-bar { justify-content:center; }
  .action-btn { min-width:110px; font-size:12px; padding:8px 12px; }
  .stats { grid-template-columns:repeat(2,1fr); }
  .title-box h1 { font-size:24px; }
  .form-grid { grid-template-columns: repeat(2, 1fr); } /* Responsive: 2 cols on mobile */
}
/* ---------- ADDED STYLES FROM SCRIPT 1 ---------- */
.title-box { background: #C5C764; padding: 25px 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; box-shadow: 0 8px 25px rgba(197, 199, 100, 0.4); border: 3px solid rgba(0, 0, 0, 0.1); }
.title-box h1 { color: #000000; font-size: 34px; font-weight: 900; margin-bottom: 16px; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); letter-spacing: 1px; }
.title-box p { color: rgba(0, 0, 0, 0.8); font-size: 16px; font-weight: 600; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); }
.btn { padding: 12px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
.btn-toggle { background: linear-gradient(90deg,#8b5cf6,#f472b6); color: white; }
.btn-red { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
#monthlyArea, #yearlyArea, #weeklyArea, #cryptoArea { display: none; margin-top: 20px; }
.month-cards { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 18px; }
.month-card { padding: 14px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); background: linear-gradient(180deg,#ffffff,#f6f7ff); cursor: pointer; transition: transform 0.2s; text-align: center; }
.month-card:hover { transform: scale(1.02); }
.month-card h4 { margin-bottom: 8px; font-size: 16px; color: #111; }
.month-card .val { font-weight: 900; font-size: 20px; }
.month-card.profit .val { color: var(--profit-color); }
.month-card.loss .val { color: var(--loss-color); }
.month-card.profit { border: 6px solid var(--profit-color); }
.month-card.loss { border: 6px solid var(--loss-color); }
.month-card div { text-align: center; }
.month-table table, .yearly-table table { width: 100%; border-collapse: collapse; background: white; }
.month-table thead th, .yearly-table thead th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 10px; text-align: center; font-size: 12px; font-weight: 600; white-space: nowrap; border: 2px solid #1e40af; }
.month-table td, .yearly-table td { padding: 12px 10px; border: 2px solid #1e40af; font-size: 16px; background: #fff; color: #111; text-align: center; font-weight: bold; }
.month-table tbody tr:hover td, .yearly-table tbody tr:hover td { background: #f3f4f6; }
#calendarNav { display: flex; align-items: center; justify-content: center; margin: 20px 0; gap: 10px; }
#calendarNav .btn { padding: 8px 12px; font-size: 14px; background: #667eea; color: white; }
.empty { text-align: center; padding: 40px; color: #666; }
/* ---------- GOLDEN WORDS SECTION ---------- */
.motivation-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 30px;
  margin-top: 40px;
  padding-top: 30px;
}
.motivation-box {
  background: linear-gradient(135deg, #ec4899 0%, #f97316 100%);
  border-radius: 20px;
  box-shadow: 0 12px 30px rgba(236, 72, 153, 0.5);
  overflow: hidden;
  border: 3px solid rgba(255, 255, 255, 0.3);
}
.motivation-box h3 {
  font-size: 22px;
  margin: 0;
  padding: 20px 25px;
  color: white;
  font-weight: 900;
  background: rgba(15, 23, 42, 0.5);
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  text-align: center; /* Center Trading Rules and Daily Mantras titles */
}
.motivation-box ul { list-style: none; padding: 20px 25px; margin: 0; }
.motivation-box li {
  padding: 12px 0;
  padding-left: 35px;
  position: relative;
  line-height: 1.6;
  font-size: 15px;
  color: #ffffff;
  font-weight: 700;
  transition: all 0.3s ease;
  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}
.motivation-box li:hover {
  padding-left: 42px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
}
.motivation-box li:last-child { border-bottom: none; }
.motivation-box li:before {
  position: absolute;
  left: 0;
  font-size: 18px;
  font-weight: bold;
  content: "\2714";
}
.mantra-box { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5); }
.mantra-box li:before { content: "\2666"; }
@media (max-width: 768px) { .container { padding: 15px; } .title-box h1 { font-size: 24px; } .motivation-section { grid-template-columns: 1fr; } }
/* ---------- NEW STYLES FOR YEARLY TABLE VIEW ---------- */
.yearly-table-view {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
.yearly-table-view th, .yearly-table-view td {
  border: 2px solid #000;
  padding: 15px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
}
.yearly-table-view th {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}
.yearly-table-view td.profit {
  background-color: #c6f6d5;
  color: #155724;
}
.yearly-table-view td.loss {
  background-color: #fed7d7;
  color: #721c24;
}
/* Modal specific styles for responsiveness */
#visualizationsModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  padding: 10px;
}
#visualizationsModal > div {
  background: var(--container-bg);
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 1200px;
  max-height: 90vh;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
#visualizationsModal canvas {
  max-height: 300px;
  height: auto;
  width: 100%;
}
/* Additional charts in modal */
#winRateChart, #strategyChart { max-height: 250px; margin-top: 20px; }
/* Updated: Chart navigation buttons with background colors */
#visualizationsModal .chart-nav {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
#visualizationsModal .chart-nav button {
  padding: 8px 12px;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
  font-size: 14px;
}
#visualizationsModal .chart-nav button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}
#visualizationsModal .chart-nav button:disabled {
  background: #94a3b8;
  cursor: not-allowed;
  transform: none;
}
#visualizationsModal .chart-nav select,
#visualizationsModal .chart-nav input {
  padding: 8px;
  border: 2px solid var(--input-border);
  border-radius: 6px;
  background: var(--input-bg);
  color: var(--text);
}
/* ---------- UPDATED FILTER MODAL STYLES ---------- */
#searchFilterModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}
#searchFilterModal > div {
  background: var(--container-bg);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 90%;
  max-width: 500px;
  text-align: center;
}
#searchFilterModal h2 {
  text-align: center;
  margin-bottom: 20px;
  color: var(--text);
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  display: inline-block;
  font-weight: bold;
}
#searchFilterModal input[type="text"],
#searchFilterModal select {
  display: block;
  margin: 0 auto 15px;
  width: 70%;
  max-width: 300px;
  padding: 8px 12px;
  border: 2px solid var(--input-border);
  border-radius: 6px;
  font-size: 14px;
  background: var(--input-bg);
  color: var(--text);
}
#searchFilterModal button {
  display: block;
  margin: 0 auto;
  padding: 8px 16px;
  background: var(--btn-primary);
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}
#searchFilterModal button:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#searchFilterModal #filteredTrades {
  margin-top: 20px;
  max-height: 300px;
  overflow-y: auto;
  text-align: left;
}
#searchFilterModal #filteredTrades table {
  width: 100%;
  border-collapse: collapse;
}
#searchFilterModal #filteredTrades th,
#searchFilterModal #filteredTrades td {
  border: 1px solid var(--border);
  padding: 8px;
  text-align: left;
}
/* ---------- UPDATED RISK CALCULATOR MODAL STYLES ---------- */
#riskCalculatorModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}
#riskCalculatorModal > div {
  background: var(--container-bg);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 90%;
  max-width: 500px;
  text-align: center;
}
#riskCalculatorModal h2 {
  text-align: center;
  margin-bottom: 20px;
  color: var(--text);
  background: linear-gradient(135deg, #d97706, #b45309);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  display: inline-block;
  font-weight: bold;
}
#riskCalculatorModal .form-field {
  margin-bottom: 15px;
  text-align: left;
}
#riskCalculatorModal .form-field label {
  display: block;
  font-weight: 600;
  margin-bottom: 5px;
  font-size: 13px;
  color: var(--text-light);
}
#riskCalculatorModal .form-field input {
  display: block;
  margin: 0 auto;
  width: 70%;
  max-width: 300px;
  padding: 8px 12px;
  border: 2px solid var(--input-border);
  border-radius: 6px;
  font-size: 14px;
  background: var(--input-bg);
  color: var(--text);
}
#riskCalculatorModal button {
  display: block;
  margin: 20px auto 0;
  padding: 8px 16px;
  background: var(--btn-primary);
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}
#riskCalculatorModal button:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#riskCalculatorModal #riskResult {
  margin-top: 20px;
  font-weight: bold;
  text-align: left;
  padding: 10px;
  background: var(--input-bg);
  border-radius: 6px;
  border: 1px solid var(--border);
}
/* New: Notification styles */
#notificationToggle { background: linear-gradient(135deg, #f59e0b, #fb923c); }
/* Updated: Column layout for week title container */
#weekSummaryCard > div:first-child {
  display: block;
  text-align: center;
  margin-bottom: 8px;
}
#weekTitle {
  display: none;
}
/* Crypto Area Styles */
#cryptoArea {
  background: linear-gradient(135deg, #1e293b 0%, #581c87 50%, #1e293b 100%);
  min-height: 100vh;
  padding: 20px;
}
#cryptoArea .max-w-7xl {
  max-width: 1400px;
  margin: 0 auto;
}
/* ---------- MISTAKES MODAL STYLES ---------- */
#mistakesModal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  padding: 10px;
}
#mistakesModal .modal-content {
  background: var(--container-bg);
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
  position: relative;
}
#mistakesModal .close {
  position: absolute;
  right: 15px;
  top: 15px;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-muted);
  z-index: 1001;
}
#mistakesModal .close:hover {
  color: var(--text);
}
#mistakesModal h2 {
  margin-top: 0;
  color: var(--text);
  text-align: center;
  margin-bottom: 20px;
}
#mistakesModal .mistake-item {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  padding: 8px;
  background: var(--input-bg);
  border-radius: 6px;
  border: 1px solid var(--border);
}
#mistakesModal .mistake-item input[type="checkbox"] {
  margin-right: 10px;
  transform: scale(1.2);
}
#mistakesModal .mistake-item label {
  color: var(--text);
  font-size: 14px;
  cursor: pointer;
  flex: 1;
}
#mistakesModal button {
  background: var(--btn-primary);
  color: #fff;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
  width: 100%;
  font-weight: 600;
  transition: all 0.2s;
}
#mistakesModal button:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
/* Updated: Style for form title like a button */
#formTitle {
  display: flex;
  justify-content: center;
  align-items: center;
  background: #632713;
  color: #ffffff;
  padding: 12px 24px;
  border-radius: 25px;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(99, 39, 19, 0.3);
  text-align: center;
  min-width: 200px;
  transition: all 0.3s ease;
}
#formTitle:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(99, 39, 19, 0.4);
}
[data-theme="premium-dark-blue"] #formTitle,
[data-theme="graphite-blue"] #formTitle {
  background: #632713;
}
/* Daily PNL Modal Styles */
#dailyPNLModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}
#dailyPNLModal > div {
  background: var(--container-bg);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 90%;
  max-width: 800px;
  text-align: center;
}
#dailyPNLModal input[type="date"] {
  display: block;
  margin: 0 auto 15px;
  padding: 8px 12px;
  border: 2px solid var(--input-border);
  border-radius: 6px;
  font-size: 14px;
  background: var(--input-bg);
  color: var(--text);
}
#dailyPNLModal canvas {
  max-height: 300px;
  height: auto;
  width: 100%;
  margin-bottom: 20px;
}
#dailyPNLModal table {
  width: 100%;
  border-collapse: collapse;
}
#dailyPNLModal th, #dailyPNLModal td {
  border: 1px solid var(--border);
  padding: 8px;
  text-align: center; /* Center-align all values in table */
}
/* New: Final PNL Button in Daily PNL Modal */
#dailyPNLModal .final-pnl-btn {
  display: block;
  margin: 20px auto 0;
  padding: 15px 30px;
  background: linear-gradient(135deg, #10b981, #059669);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}
#dailyPNLModal .final-pnl-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}
#dailyPNLModal .final-pnl-btn.loss {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
}
#dailyPNLModal .final-pnl-btn.loss:hover {
  box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
}
/* ---------- TOTAL CAPITAL MODAL STYLES ---------- */
#totalCapitalModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}
#totalCapitalModal > div {
  background: var(--container-bg);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 90%;
  max-width: 800px;
  text-align: center;
}
#totalCapitalModal h2 {
  text-align: center;
  margin-bottom: 20px;
  color: var(--text);
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  display: inline-block;
  font-weight: bold;
}
#totalCapitalModal .input-group {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}
#totalCapitalModal .amount-input {
  padding: 10px;
  font-size: 16px;
  width: 180px;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 6px;
}
#totalCapitalModal #capitalTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
#totalCapitalModal th, #totalCapitalModal td {
  border: 1px solid var(--border);
  padding: 8px;
  text-align: center;
}
/* New: Gold Calculator Modal Styles - Embedded from Script 2 */
#goldCalculatorModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  padding: 10px;
}
#goldCalculatorModal > div {
  background: var(--container-bg);
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;
  text-align: center;
}
/* Updated: Increased height for navigation buttons in Gold Calculator Modal */
#goldCalculatorModal .btn {
  padding: 12px 16px !important; /* Increased padding for height */
  font-size: 14px !important; /* Increased font size */
  min-height: 45px; /* Minimum height to ensure taller buttons */
  line-height: 1.5;
}
/* Updated: Specific background color change for report buttons in Gold Calculator Modal */
#goldCalculatorModal .btn-toggle:not(.btn-red) {
  background: linear-gradient(135deg, #fbbf24, #f59e0b) !important; /* Changed to gold/orange gradient for Daily, Weekly, Monthly, Yearly */
  color: #000 !important; /* Dark text for contrast */
  border: 2px solid #d97706 !important;
}
#goldCalculatorModal .btn-toggle:not(.btn-red):hover {
  background: linear-gradient(135deg, #f59e0b, #d97706) !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}
#goldCalculatorModal h1 {
  text-align: center;
  color: WHITE;
  margin-bottom: 10px;
  font-size: 40px;
  background: #B76E79;
  padding: 20px;
  border-radius: 10px;
  border: 3px solid #333;
}
#goldCalculatorModal .input-group {
  margin-bottom: 20px;
  text-align: center;
}
#goldCalculatorModal label {
  display: block;
  margin-bottom: 8px;
  color: var(--text);
  font-weight: bold;
  font-size: 16px;
}
#goldCalculatorModal input {
  width: auto;
  max-width: 200px;
  padding: 12px;
  border: 3px solid #155724;
  border-radius: 5px;
  font-size: 16px;
  box-sizing: border-box;
  transition: border-color 0.3s;
  text-align: center;
  background: var(--input-bg);
  color: var(--text);
}
#goldCalculatorModal input:focus {
  outline: none;
  border-color: #667eea;
}
#goldCalculatorModal button {
  width: 200px;
  margin: 0 auto;
  display: block;
  padding: 12px;
  background: linear-gradient(135deg, #003B59 0%, #003B59 100%);
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s;
}
#goldCalculatorModal button:hover {
  transform: scale(1.02);
}
#goldCalculatorModal .result-group {
  margin-top: 30px;
  display: none;
}
#goldCalculatorModal .result-group.show {
  display: block;
}
#goldCalculatorModal .formula-box {
  background: #fff3cd;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 20px;
  border: 2px solid #ffc107;
  text-align: center;
  display: none;
}
#goldCalculatorModal .formula-box.show {
  display: block;
}
#goldCalculatorModal .formula-text {
  font-size: 14px;
  color: var(--text);
  line-height: 1.6;
}
#goldCalculatorModal .calculations-box {
  background: linear-gradient(135deg, #e8f4f8 0%, #f0e8f8 100%);
  padding: 25px;
  border-radius: 10px;
  border: 3px solid #667eea;
  margin-bottom: 25px;
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
}
#goldCalculatorModal .calc-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-bottom: 15px;
  align-items: center;
}
#goldCalculatorModal .calc-item-full {
  grid-column: 1 / -1;
}
#goldCalculatorModal .calc-item {
  text-align: center;
  padding: 12px;
  background: white;
  border-radius: 8px;
  border: 2px solid #ddd;
}
#goldCalculatorModal .calc-label {
  font-size: 13px;
  color: #666;
  margin-bottom: 5px;
  font-weight: 600;
}
#goldCalculatorModal .calc-value {
  font-size: 18px;
  font-weight: bold;
  color: #667eea;
}
#goldCalculatorModal .calc-value.highlighted {
  font-size: 18px;
  color: #000000;
  font-weight: bold;
}
#goldCalculatorModal .final-value-btn {
  width: 100%;
  padding: 20px;
  background: linear-gradient(135deg, #00537A 0%, #00537A 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 30px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
  grid-column: 1 / -1;
}
#goldCalculatorModal .final-value-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
}
#goldCalculatorModal .range-box {
  background: white;
  border: 4px solid #20a5b4;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 25px;
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
}
#goldCalculatorModal .range-title {
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  margin-bottom: 15px;
  padding: 10px;
  background: #20a5b4;
  color: white;
  border-radius: 5px;
}
#goldCalculatorModal .range-values {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}
#goldCalculatorModal .range-item {
  background: #f8f9fa;
  padding: 12px;
  border-radius: 5px;
  text-align: center;
  border: none;
}
#goldCalculatorModal .range-item-label {
  font-size: 12px;
  color: #666;
  margin-bottom: 3px;
  font-weight: 600;
  display: none;
}
#goldCalculatorModal .range-item-value {
  font-size: 22px;
  font-weight: bold;
  color: #333;
}
#goldCalculatorModal .two-column {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 20px;
}
#goldCalculatorModal .column-box {
  background: white;
  padding: 15px;
  border-radius: 5px;
  border: 3px solid #333;
}
#goldCalculatorModal .column-title {
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  margin-bottom: 15px;
  padding: 10px;
  border-bottom: 2px solid #667eea;
  border-radius: 3px;
}
#goldCalculatorModal .column-title.up {
  color: white;
  background: #28a745;
}
#goldCalculatorModal .column-title.down {
  color: white;
  background: #dc3545;
}
#goldCalculatorModal .value-row {
  margin-bottom: 10px;
  padding: 8px;
  background: #f8f9fa;
  border-radius: 3px;
  text-align: center;
  font-size: 18px;
  font-weight: bold;
}
#goldCalculatorModal .value-row.highlighted {
  font-size: 18px;
  font-weight: bold;
  background: #fff3cd;
  border: 2px solid #ffc107;
}
#goldCalculatorModal .export-btn {
  background: #28a745;
  margin-top: 20px;
  width: 200px;
}
#goldCalculatorModal .export-btn:hover {
  background: #218838;
}
/* New: BTC Calculator Modal Styles */
#btcCalculatorModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  padding: 10px;
}
#btcCalculatorModal > div {
  background: var(--container-bg);
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 1200px;
  max-height: 90vh;
  overflow-y: auto;
  text-align: center;
}
#btcCalculatorModal .btn {
  padding: 12px 16px !important;
  font-size: 14px !important;
  min-height: 45px;
  line-height: 1.5;
}
#btcCalculatorModal .btn-toggle:not(.btn-red) {
  background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
  color: #000 !important;
  border: 2px solid #b8860b !important;
}
#btcCalculatorModal .btn-toggle:not(.btn-red):hover {
  background: linear-gradient(135deg, #f59e0b, #d97706) !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}
#btcCalculatorModal .main-container { padding: 20px; }
#btcCalculatorModal .section { margin-bottom: 50px; border: 2px solid #ddd; border-radius: 10px; padding: 20px; background: white; }
#btcCalculatorModal .section h2 { text-align: center; font-size: 24px; margin-bottom: 20px; color: #333; }
/* Script 1 CSS for BTC Modal */
#btcCalculatorModal .script1 * { margin: 0; padding: 0; box-sizing: border-box; }
#btcCalculatorModal .script1 body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); min-height: 100vh; padding: 32px; }
#btcCalculatorModal .script1 .container { max-width: 1000px; margin: 0 auto; }
#btcCalculatorModal .script1 .title-box { text-align: center; margin-bottom: 32px; }
#btcCalculatorModal .script1 .title-btn { display: inline-block; background: linear-gradient(135deg, #fbbf24 0%, #f97316 100%); color: #111827; padding: 16px 48px; border-radius: 50px; font-weight: bold; font-size: 32px; border: none; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); cursor: default; }
#btcCalculatorModal .script1 .card { background: white; border-radius: 8px; box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1); padding: 32px; }
#btcCalculatorModal .script1 table { width: 100%; border-collapse: collapse; }
#btcCalculatorModal .script1 thead tr { background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%); color: white; }
#btcCalculatorModal .script1 th { padding: 16px 32px; text-align: center; font-weight: bold; font-size: 18px; border: 2px solid #6b21a8; }
#btcCalculatorModal .script1 tbody tr { background-color: #faf5ff; }
#btcCalculatorModal .script1 tbody tr:nth-child(even) { background-color: #fce7f3; }
#btcCalculatorModal .script1 td { padding: 20px 32px; text-align: center; border: 2px solid #d1d5db; }
#btcCalculatorModal .script1 input[type="number"] { width: 100%; padding: 12px 16px; border: 2px solid #a78bfa; border-radius: 8px; font-weight: 600; text-align: center; font-size: 16px; font-family: inherit; }
#btcCalculatorModal .script1 input[type="number"]:focus { outline: none; ring: 2px; border-color: #7c3aed; box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1); }
#btcCalculatorModal .script1 input[type="number"]::placeholder { color: #9ca3af; }
#btcCalculatorModal .script1 .result-box { padding: 12px 16px; border-radius: 8px; font-weight: bold; font-size: 18px; border: 2px solid; min-height: 40px; display: flex; align-items: center; justify-content: center; }
#btcCalculatorModal .script1 .level1-box { background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%); color: #0369a1; border-color: #0ea5e9; }
#btcCalculatorModal .script1 .level2-box { background: linear-gradient(135deg, #dcfce7 0%, #e0fdf4 100%); color: #15803d; border-color: #22c55e; }
#btcCalculatorModal .script1 .level3-box { background: linear-gradient(135deg, #fed7aa 0%, #fef3c7 100%); color: #92400e; border-color: #f97316; }
/* Script 2 CSS for BTC Modal */
#btcCalculatorModal .script2 * { margin:0; padding:0; box-sizing:border-box; }
#btcCalculatorModal .script2 body { font-family:Arial,sans-serif; padding:20px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; }
#btcCalculatorModal .script2 .container { max-width:1200px; margin:0 auto; background:white; border-radius:10px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.3); border:5px solid #006064; }
#btcCalculatorModal .script2 .header { background:rgba(0,0,0,0.75); padding:30px; text-align:center; border-bottom:6px solid #006064; position:relative; overflow:hidden; }
#btcCalculatorModal .script2 .header::before{ content:''; position:absolute; inset:0; background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Bitcoin.svg/1200px-Bitcoin.svg.png') center/cover; filter:blur(10px) brightness(0.4); z-index:0; }
#btcCalculatorModal .script2 .header h1{ color:#fff; font-size:48px; font-weight:900; margin:0; text-shadow:5px 5px 10px rgba(0,0,0,0.9),0 0 20px rgba(0,96,100,0.5); letter-spacing:3px; position:relative; z-index:2; background:linear-gradient(135deg,#006064,#00838f); padding:15px 40px; border-radius:50px; border:3px solid #fff; display:inline-block; box-shadow:0 8px 16px rgba(0,0,0,0.3); }
#btcCalculatorModal .script2 .input-section{ background:#e0f7fa; padding:30px; border-bottom:3px solid #006064; border:2px solid #006064; }
#btcCalculatorModal .script2 .input-group{display:flex;flex-direction:column;align-items:center;gap:15px;}
#btcCalculatorModal .script2 .input-group label{font-weight:bold;color:#333;font-size:26px;}
#btcCalculatorModal .script2 .input-group input{ padding:15px 20px; font-size:20px; border:3px solid #006064; border-radius:5px; background:#e0f7fa; font-weight:bold; width:220px; text-align:center; }
#btcCalculatorModal .script2 .input-group button{ padding:12px 50px; font-size:20px; background:#008000; color:#fff; border:none; border-radius:5px; cursor:pointer; font-weight:bold; transition:background .3s; border:3px solid #fff; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
#btcCalculatorModal .script2 .input-group button:hover{ background:#009900; }
#btcCalculatorModal .script2 .results{padding:20px; border:2px solid #006064;}
#btcCalculatorModal .script2 table{width:100%; border-collapse:collapse; border:3px solid #006064;}
#btcCalculatorModal .script2 th, #btcCalculatorModal .script2 td{padding:18px; text-align:center; border:2px solid #006064; font-size:24px; font-weight:bold;}
#btcCalculatorModal .script2 .column-header{color:#fff;font-size:24px;}
#btcCalculatorModal .script2 .level-col{background:#e91e63;color:#fff;}
#btcCalculatorModal .script2 .level-col.data-level{background:#e91e63;color:#fff;font-size:24px;}
#btcCalculatorModal .script2 .upper-levels-header{background:#2196F3;}
#btcCalculatorModal .script2 .lower-levels-header{background:#2196F3;}
#btcCalculatorModal .script2 .upper-levels-col{background:#ffff00;color:#333;}
#btcCalculatorModal .script2 .lower-levels-col{background:#ffcc99;color:#333;}
#btcCalculatorModal .script2 .data-row td{background:#fff;}
#btcCalculatorModal .script2 .data-row .level-col{background:#e91e63;color:#fff;}
/* Script 3 CSS for BTC Modal */
#btcCalculatorModal .script3 * { margin: 0; padding: 0; box-sizing: border-box; }
#btcCalculatorModal .script3 body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
#btcCalculatorModal .script3 .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
#btcCalculatorModal .script3 .title-button { display: block; width: fit-content; margin: 0 auto 40px; background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%); color: #222; padding: 15px 50px; border-radius: 50px; font-size: 26px; font-weight: 800; text-align: center; box-shadow: 0 8px 25px rgba(255, 204, 51, 0.5); border: none; cursor: default; }
#btcCalculatorModal .script3 .input-section { text-align: center; margin-bottom: 40px; }
#btcCalculatorModal .script3 .input-wrapper { display: inline-block; margin-bottom: 20px; }
#btcCalculatorModal .script3 label { display: block; font-weight: 600; margin-bottom: 10px; color: #333; font-size: 18px; }
#btcCalculatorModal .script3 input { width: 300px; padding: 15px 20px; border: 3px solid #667eea; border-radius: 10px; font-size: 20px; text-align: center; transition: all 0.3s; background: white; font-weight: 600; }
#btcCalculatorModal .script3 input:focus { outline: none; border-color: #764ba2; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2); }
#btcCalculatorModal .script3 .calculate-btn { display: block; margin: 20px auto; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 60px; border-radius: 50px; font-size: 20px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
#btcCalculatorModal .script3 .calculate-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6); }
#btcCalculatorModal .script3 .calculate-btn:active { transform: translateY(0); }
#btcCalculatorModal .script3 .results { margin-top: 40px; overflow-x: auto; }
#btcCalculatorModal .script3 .result-table { width: 100%; border-collapse: collapse; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; background-color: #f9fcff; border: 3px solid #ddd; }
#btcCalculatorModal .script3 .result-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: center; font-weight: 700; font-size: 20px; border: 2px solid #5568d3; }
#btcCalculatorModal .script3 .result-table th:nth-child(5) { background: linear-gradient(135deg, #90caf9 0%, #64b5f6 100%); color: #333; }
#btcCalculatorModal .script3 .result-table th:nth-child(6) { background: linear-gradient(135deg, #a5d6a7 0%, #81c784 100%); color: #333; }
#btcCalculatorModal .script3 .result-table th:nth-child(7) { background: linear-gradient(135deg, #ffb74d 0%, #ff9800 100%); color: #333; }
#btcCalculatorModal .script3 .result-table td { padding: 14px; text-align: center; font-size: 20px; border: 2px solid #ddd; background: #f9fcff; }
#btcCalculatorModal .script3 .result-table td:nth-child(5) { background-color: #90caf9; }
#btcCalculatorModal .script3 .result-table td:nth-child(6) { background-color: #a5d6a7; }
#btcCalculatorModal .script3 .result-table td:nth-child(7) { background-color: #ffb74d; }
#btcCalculatorModal .script3 .result-table tbody tr:hover { background: #f5f5f5; }
#btcCalculatorModal .script3 .highlight-row { background: #ffeb3b !important; }
#btcCalculatorModal .script3 .highlight-row:hover { background: #fdd835 !important; }
#btcCalculatorModal .script3 .row-header { font-weight: 700; background: #f0f0f0 !important; color: #333; }
#btcCalculatorModal .script3 .empty-cell { background: #f9f9f9 !important; }
#btcCalculatorModal .script3 .level-cell { text-align: center !important; }
#btcCalculatorModal .script3 .level-button { display: inline-block; padding: 10px 20px; border-radius: 25px; font-weight: 700; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: none; margin: 0 5px; }
#btcCalculatorModal .script3 .level-1 { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
#btcCalculatorModal .script3 .level-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
#btcCalculatorModal .script3 .level-3 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
#btcCalculatorModal .script3 .level-4 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
/* New: Nifty Setup Modal Styles */
#niftySetupModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  padding: 10px;
}
#niftySetupModal > div {
  background: var(--container-bg);
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 1200px;
  max-height: 90vh;
  overflow-y: auto;
  text-align: center;
}
#niftySetupModal .nifty-container {
  width: 95%;
  max-width: 1200px;
  background: white;
  border-radius: 20px;
  box-shadow: 0 25px 70px rgba(0,0,0,0.4);
  overflow: hidden;
  margin: 0 auto;
}
#niftySetupModal .nifty-header {
  background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
  padding: 50px;
  text-align: center;
}
#niftySetupModal .nifty-header h1 {
  color: #333;
  font-size: 42px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 3px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}
#niftySetupModal .nifty-content {
  padding: 60px;
}
#niftySetupModal .nifty-excel-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 40px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.15);
}
#niftySetupModal .nifty-excel-table th {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  text-align: center;
  font-weight: bold;
  border: 2px solid #ddd;
  color: white;
  font-size: 22px;
  letter-spacing: 1px;
}
#niftySetupModal .nifty-excel-table td {
  padding: 25px;
  border: 2px solid #ddd;
  text-align: center;
  font-size: 20px;
}
#niftySetupModal .nifty-label-cell {
  background: #fff3cd;
  font-weight: 700;
  text-align: left;
  font-size: 26px;
  color: #333;
}
#niftySetupModal .nifty-input-cell input {
  width: 100%;
  padding: 18px 25px;
  border: 3px solid #667eea;
  border-radius: 10px;
  font-size: 28px;
  text-align: left;
  box-sizing: border-box;
  font-weight: 600;
  transition: all 0.3s;
  letter-spacing: 1px;
}
#niftySetupModal .nifty-input-cell input:focus {
  outline: none;
  border-color: #764ba2;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
  transform: scale(1.02);
}
#niftySetupModal .nifty-result-cell {
  background: linear-gradient(135deg, #e7f3ff 0%, #cfe9ff 100%);
  font-size: 28px;
  font-weight: bold;
  color: #667eea;
}
#niftySetupModal .nifty-candle-cell {
  background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
  font-size: 56px;
  font-weight: bold;
  color: #d63031;
  text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
}
#niftySetupModal .nifty-unit-cell {
  background: linear-gradient(135deg, #dfe6e9 0%, #b2bec3 100%);
  font-size: 22px;
  font-weight: 700;
  color: #2d3436;
}
#niftySetupModal .nifty-button {
  width: 100%;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 15px;
  font-size: 26px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  letter-spacing: 2px;
  text-transform: uppercase;
}
#niftySetupModal .nifty-button:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}
#niftySetupModal .nifty-button:active {
  transform: translateY(0);
}
#niftySetupModal .pulse-animation {
  animation: pulse 0.6s ease-in-out, glow 1.5s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.08); }
}
@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(214, 48, 49, 0.5); }
  50% { box-shadow: 0 0 40px rgba(214, 48, 49, 0.8); }
}
/* New: Range Calculator Modal Styles - Added from Script 2 */
#rangeCalculatorModal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
  padding: 10px;
}
#rangeCalculatorModal > div {
  background: var(--container-bg);
  margin: 5% auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 1200px;
  max-height: 90vh;
  overflow-y: auto;
  text-align: center;
}
#rangeCalculatorModal .btn {
  padding: 12px 16px !important;
  font-size: 14px !important;
  min-height: 45px;
  line-height: 1.5;
}
#rangeCalculatorModal .btn-toggle:not(.btn-red) {
  background: linear-gradient(135deg, #8b5cf6, #ec4899) !important;
  color: #000 !important;
  border: 2px solid #d946ef !important;
}
#rangeCalculatorModal .btn-toggle:not(.btn-red):hover {
  background: linear-gradient(135deg, #ec4899, #d946ef) !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}
#rangeCalculatorModal #range-root {
  min-height: 400px;
}
</style>
</head>
<body>
<div class="container" id="journalArea">
  <!-- TITLE BAR -->
  <div class="title-bar">
    <h1>Live Trading Junction Journal</h1>
  </div>
  <!-- Present Capital Button -->
  <div style="text-align: center; margin: 20px 0;">
    <button id="presentCapitalBtn" style="padding: 15px 30px; background: #00537A; color: white; border: none; border-radius: 12px; font-size: 25px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3); transition: all 0.3s ease;">Present Capital: â‚¹0.00</button>
  </div>
  <!-- GOLDEN WORDS -->
  <div class="golden-words">
    <span id="goldenQuote"></span>
  </div>
  <!-- STATS -->
  <div class="stats">
    <div class="stat-card"><h3>ðŸ“Š Total Trades</h3><div class="value" id="total">0</div></div>
    <div class="stat-card"><h3>ðŸŽ¯ Win Rate</h3><div class="value" id="winrate">0%</div></div>
    <div class="stat-card"><h3>ðŸ’° Total P&L</h3><div class="value profit" id="totalpl">0</div></div>
    <div class="stat-card"><h3>ðŸ’¹ Avg P&L</h3><div class="value" id="avgpl">0</div></div>
    <div class="stat-card profit"><h3>ðŸ“ˆ Profit Trades</h3><div class="value" id="profits">0</div></div>
    <div class="stat-card loss"><h3>ðŸ“‰ Loss Trades</h3><div class="value" id="losses">0</div></div>
    <div class="stat-card" onclick="showDailyPNL()">
      <h3>ðŸ“… Daily PNL</h3>
      <div class="value" id="dailypnl">0</div>
    </div>
  </div>
  <!-- ACTION BUTTONS BAR -->
  <div class="action-bar" id="actionBar">
    <div class="action-btn add-btn" id="addBtn" onclick="toggleForm()">
      <span class="icon">âž•</span> Add New Trade
    </div>
    <div class="action-btn daily-btn" id="toggleDailyBtn" onclick="showDailyPNL()">
      <span class="icon">ðŸ“†</span> Daily Report
    </div>
    <div class="action-btn weekly-btn" id="toggleWeeklyBtn" onclick="toggleWeeklyView()">
      <span class="icon">ðŸ“…</span> Weekly Report
    </div>
    <div class="action-btn monthly-btn" id="toggleMonthlyBtn" onclick="toggleMonthlyView()">
      <span class="icon">ðŸ“Š</span> Monthly Report
    </div>
    <div class="action-btn yearly-btn" id="toggleYearlyBtn" onclick="toggleYearlyView()">
      <span class="icon">ðŸ“ˆ</span> Yearly Report
    </div>
    <div class="action-btn crypto-btn" id="toggleCryptoBtn" onclick="toggleCryptoView()">
      <span class="icon">â‚¿</span> Crypto Journal
    </div>
    <div class="action-btn charts-btn" onclick="showVisualizations()">
      <span class="icon">ðŸ“ˆ</span> View Charts
    </div>
    <div class="action-btn filter-btn" onclick="showSearchFilter()">
      <span class="icon">ðŸ”</span> Filter Trades
    </div>
    <div class="action-btn capital-btn" onclick="showTotalCapital()">
      <span class="icon">ðŸ’¼</span> Total Capital
    </div>
    <div class="action-btn gold-calc-action-btn" onclick="showGoldCalculator()" style="font-weight: bold;">
      <span class="icon">ðŸ†</span> Gold Calculator
    </div>
    <div class="action-btn btc-calc-action-btn" onclick="showBTCCalculator()" style="font-weight: bold;">
      <span class="icon">â‚¿</span> BTC Calculator
    </div>
    <div class="action-btn nifty-setup-btn" onclick="showNiftySetup()" style="font-weight: bold;">
      <span class="icon">ðŸ“ˆ</span> Nifty Setup
    </div>
    <div class="action-btn range-calc-btn" onclick="showRangeCalculator()" style="font-weight: bold;">
      <span class="icon">ðŸ“</span> Range Calculator
    </div>
    <div class="action-btn excel-btn" onclick="exportData()">
      <span class="icon">ðŸ“Š</span> Download Excel
    </div>
    <div class="action-btn clear-btn" onclick="clearAll()">
      <span class="icon">ðŸ—‘ï¸</span> Clear All Data
    </div>
    <div class="action-btn theme-btn" id="themeToggle">
      <span class="icon" id="themeIcon">â˜€ï¸</span> Theme
    </div>
  </div>
  <!-- FORM -->
  <div class="form-area" id="form">
    <h3 id="formTitle" style="display: none;">ðŸ“ Trade Fields</h3>
    <div class="form-grid">
      <!-- Row 1: Date, Market Type, Instrument, Trade Type -->
      <div class="form-field" style="grid-column: 1; grid-row: 1;">
        <label>Date *</label>
        <input type="date" id="date" required>
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 1;">
        <label>Market Type *</label>
        <select id="markettype" required onchange="updateInstruments()">
          <option value="">Select</option>
          <option value="Index Options">Index Options</option>
          <option value="Stock Options">Stock Options</option>
          <option value="Stock Trading">Stock Trading</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 1;">
        <label>Instrument *</label>
        <select id="instrument" required onchange="updateLotSize()">
          <option value="">Select</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 1;">
        <label>Trade Type *</label>
        <select id="type" required>
          <option value="">Select</option>
          <option value="BUY CALL">BUY CALL</option><option value="BUY PUT">BUY PUT</option>
          <option value="SELL CALL">SELL CALL</option><option value="SELL PUT">SELL PUT</option>
          <option value="LONG">LONG (Stock/Forex)</option><option value="SHORT">SHORT (Stock/Forex)</option>
        </select>
      </div>
      <!-- Row 2: Strike Price, Expiry Date, Entry Price, Exit Price -->
      <div class="form-field" style="grid-column: 1; grid-row: 2;">
        <label>Strike Price *</label>
        <input type="number" id="strike" placeholder="e.g., 24000" required>
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 2;" id="expiryField">
        <label>Expiry Date</label>
        <input type="date" id="expiry">
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 2;">
        <label>Entry Price (â‚¹) *</label>
        <input type="number" id="entry" placeholder="e.g., 150" step="0.01" required onchange="calculateInvestment();">
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 2;">
        <label>Exit Price (â‚¹) *</label>
        <input type="number" id="exit" placeholder="e.g., 200" step="0.01" required>
      </div>
      <!-- Row 3: Lots, Lot Size, Margin Used, Charges -->
      <div class="form-field" style="grid-column: 1; grid-row: 3;">
        <label>Lots *</label>
        <input type="number" id="qty" list="lotsOptions" placeholder="e.g., 1" min="1" required onchange="calculateInvestment();">
        <datalist id="lotsOptions">
          <option value="1"><option value="2"><option value="3"><option value="4"><option value="5">
          <option value="6"><option value="7"><option value="8"><option value="9"><option value="10">
          <option value="11"><option value="12"><option value="13"><option value="14"><option value="15">
          <option value="16"><option value="17"><option value="18"><option value="19"><option value="20">
          <option value="21"><option value="22"><option value="23"><option value="24"><option value="25">
          <option value="26"><option value="27"><option value="28"><option value="29"><option value="30">
          <option value="31"><option value="32"><option value="33"><option value="34"><option value="35">
          <option value="36"><option value="37"><option value="38"><option value="39"><option value="40">
          <option value="41"><option value="42"><option value="43"><option value="44"><option value="45">
          <option value="46"><option value="47"><option value="48"><option value="49"><option value="50">
        </datalist>
      </div>
      <div class="form-field" id="lotsizeField" style="grid-column: 2; grid-row: 3;">
        <label>Lot Size *</label>
        <input type="number" id="lotsize" placeholder="Auto-fill" required onchange="calculateInvestment();">
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 3;">
        <label>Margin Used (â‚¹)</label>
        <input type="text" id="investment" class="readonly" readonly placeholder="Auto-calculated">
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 3;">
        <label>Charges (â‚¹)</label>
        <input type="number" id="charges" placeholder="e.g., 50" step="0.01">
      </div>
      <!-- Row 4: Entry Time, Exit Time, Trade Reason, Stop Loss -->
      <div class="form-field" style="grid-column: 1; grid-row: 4;">
        <label>Entry Time</label>
        <input type="time" id="entrytime">
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 4;">
        <label>Exit Time</label>
        <input type="time" id="exittime">
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 4;">
        <label>Trade Reason</label>
        <select id="reason">
          <option value="">Select Reason</option>
          <option value="Breakout Setup">Breakout Setup</option>
          <option value="Pullback Setup">Pullback Setup</option>
          <option value="Reversal Pattern">Reversal Pattern</option>
          <option value="News / Event Based">News / Event Based</option>
          <option value="FOMO Entry">FOMO Entry</option>
          <option value="Revenge Trade">Revenge Trade</option>
          <option value="Stochastic Signal">Stochastic Signal</option>
          <option value="Scalp / Swing Setup">Scalp / Swing Setup</option>
          <option value="Price Action Signal">Price Action Signal</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 4;">
        <label>Stop Loss (â‚¹)</label>
        <input type="number" id="sl" placeholder="e.g., 100" step="0.01">
      </div>
      <!-- Row 5: Target, Market Bias, Pre-Trade Emotion, Post-Trade Emotion -->
      <div class="form-field" style="grid-column: 1; grid-row: 5;">
        <label>Target (â‚¹)</label>
        <input type="number" id="target" placeholder="e.g., 250" step="0.01">
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 5;">
        <label>Market Bias</label>
        <select id="bias">
          <option value="">Select</option>
          <option value="Bullish">Bullish</option>
          <option value="Bearish">Bearish</option>
          <option value="Neutral">Neutral</option>
          <option value="Volatile">Volatile</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 5;">
        <label>Pre-Trade Emotion</label>
        <select id="preEmotion">
          <option value="">Select</option>
          <option value="Excited">Excited</option>
          <option value="Fearful">Fearful</option>
          <option value="Confident">Confident</option>
          <option value="Calm">Calm</option>
          <option value="Anxious">Anxious</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 5;">
        <label>Post-Trade Emotion</label>
        <select id="postEmotion">
          <option value="">Select</option>
          <option value="Excited">Excited</option>
          <option value="Fearful">Fearful</option>
          <option value="Confident">Confident</option>
          <option value="Calm">Calm</option>
          <option value="Anxious">Anxious</option>
        </select>
      </div>
      <!-- Row 6: Followed Plan?, Strategy Used, Timeframe, Mistakes Made -->
      <div class="form-field" style="grid-column: 1; grid-row: 6;">
        <label>Followed Plan?</label>
        <select id="plan">
          <option value="Yes">Yes âœ…</option>
          <option value="No">No âŒ</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 6;">
        <label>Strategy Used</label>
        <select id="strategy">
          <option value="">Select</option>
          <option value="Support/Resistance">Support/Resistance</option>
          <option value="Stochastic">Stochastic</option>
          <option value="Breakout">Breakout</option>
          <option value="EMA Crossover">EMA Crossover</option>
          <option value="Divergence">Divergence</option>
          <option value="IV Crush">IV Crush</option>
          <option value="Delta Trading">Delta Trading</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 3; grid-row: 6;">
        <label>Timeframe</label>
        <select id="timeframe">
          <option value="">Select</option>
          <option value="1-min">1 Minute</option>
          <option value="3-min">3 Minutes</option>
          <option value="5-min">5 Minutes</option>
          <option value="15-min">15 Minutes</option>
          <option value="1-hour">1 Hour</option>
          <option value="Daily">Daily</option>
        </select>
      </div>
      <div class="form-field" style="grid-column: 4; grid-row: 6;" onclick="openMistakesModal()">
        <label>Mistakes Made</label>
        <textarea id="mistakes" placeholder="Click here to select common mistakes..."></textarea>
      </div>
      <!-- Row 7: Lesson Learned, Notes -->
      <div class="form-field" style="grid-column: 1; grid-row: 7;">
        <label>Lesson Learned</label>
        <textarea id="lesson" placeholder="What did you learn?"></textarea>
      </div>
      <div class="form-field" style="grid-column: 2; grid-row: 7;">
        <label>Notes</label>
        <textarea id="notes" rows="2" placeholder="Additional notes..."></textarea>
      </div>
    </div>
    <div style="margin-top:15px;display:flex;gap:10px; justify-content: center;"> <!-- Reduced margin-top from 20px to 15px -->
      <button style="padding:8px 16px;background:var(--btn-success);color:#fff;border:none;border-radius:8px;cursor:pointer;" onclick="saveTrade()">Save Trade</button> <!-- Reduced padding from 10px 20px -->
      <button style="padding:8px 16px;background:var(--btn-danger);color:#fff;border:none;border-radius:8px;cursor:pointer;" onclick="hideForm()">Cancel</button>
    </div>
  </div>
  <!-- TRADE TABLE -->
  <div class="table-wrapper">
    <table id="tradeTable">
      <thead>
        <tr>
          <th>Date</th><th>Instrument</th><th>Type</th><th>Strike</th><th>Entry</th><th>Exit</th><th>Lots</th><th>Quantity</th><th>Margin Used</th><th>P&L</th><th>Charges</th><th>%</th><th>Strategy</th><th>Plan</th><th>Notes</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div id="pagination"></div>
  </div>
  <div class="title-box" style="margin-top: 40px;">
    <h1>âœ¨ Golden Words</h1>
  </div>
  <div class="motivation-section">
    <div class="motivation-box rules-box">
      <h3>ðŸ“œ Trading Rules</h3>
      <ul>
        <li>Always use stop loss â€” no exceptions</li>
        <li>Cut losses quickly, let profits run</li>
        <li>Trading is a skill to be mastered, not gambling</li>
        <li>Don't worry about result, go with the process</li>
        <li>Mastery takes time, patience, and screen hours (6â€“12 months)</li>
        <li>Build mental strength, accept losses, focus on long-term</li>
        <li>Capital protection is always Rule No 1</li>
        <li>Discipline > Strategy > Prediction</li>
        <li>Every loss is a tuition fee â€” review it</li>
        <li>Set realistic goals, focus on consistent small small gains</li>
        <li>Patience, consistency, emotional control win long term</li>
        <li>Stick to your trading plan, use logic over emotion</li>
        <li>Always analyse and understand the market and data</li>
      </ul>
    </div>
    <div class="motivation-box mantra-box">
      <h3>ðŸ§˜ Daily Mantras</h3>
      <ul>
        <li>I will never trade without a clear plan</li>
        <li>My stop loss protects me, not limits me</li>
        <li>I trade probabilities, not predictions</li>
        <li>Every loss is data, not drama</li>
        <li>Consistency beats intensity</li>
        <li>My capital is my weapon</li>
        <li>No emotion, no ego â€” execution only</li>
        <li>Emotions have no place in trading</li>
        <li>I am always learning</li>
        <li>Market is my teacher</li>
        <li>I follow process; profits follow me</li>
        <li>Don't repeat the same mistake again</li>
        <li>The game is all about emotion and psychology</li>
        <li>No risk, no reward, no story at all</li>
      </ul>
    </div>
  </div>
</div>
<!-- MONTHLY VIEW -->
<div class="container" id="monthlyArea">
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
    <button class="btn btn-toggle" onclick="showDailyPNL()">Daily Report</button>
    <button class="btn btn-toggle" onclick="toggleWeeklyView()">Weekly Report</button>
    <button class="btn btn-toggle" onclick="toggleMonthlyView()">Monthly Report</button>
    <button class="btn btn-toggle" onclick="toggleYearlyView()">Yearly Report</button>
    <button class="btn btn-toggle" onclick="showVisualizations()">View Chart</button>
  </div>
  <div class="title-box">
    <h1>ðŸ“… Monthly Summary Report</h1>
    <p></p>
  </div>
  <div class="month-cards" id="monthCards"></div>
  <div id="calendarNav">
    <button class="btn" id="prevMonth">â—€ Prev</button>
    <span id="currentMonth" style="font-size: 18px; font-weight: 700; color: #333;">October 2025</span>
    <button class="btn" id="nextMonth">Next â–¶</button>
  </div>
  <div class="table-wrapper" id="calendarView"></div>
  <div class="table-wrapper month-table">
    <table>
      <thead>
        <tr>
          <th>Month</th>
          <th>Total P&L</th>
          <th>Trades Count</th>
          <th>Avg P&L / Trade</th>
          <th>Biggest Winner</th>
          <th>Biggest Loser</th>
          <th>Winning/Losing Trades</th>
        </tr>
      </thead>
      <tbody id="monthTableBody"><tr><td colspan="7" class="empty">No data</td></tr></tbody>
    </table>
  </div>
</div>
<!-- YEARLY VIEW -->
<div class="container" id="yearlyArea">
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
    <button class="btn btn-toggle" onclick="showDailyPNL()">Daily Report</button>
    <button class="btn btn-toggle" onclick="toggleWeeklyView()">Weekly Report</button>
    <button class="btn btn-toggle" onclick="toggleYearlyView()">Yearly Report</button>
    <button class="btn btn-toggle" onclick="toggleMonthlyView()">Monthly Report</button>
    <button class="btn btn-toggle" onclick="showVisualizations()">View Chart</button>
  </div>
  <div class="title-box">
    <h1>ðŸ“… Yearly Report</h1>
    <p></p>
  </div>
  <div class="table-wrapper yearly-table-view">
    <table>
      <thead>
        <tr>
          <th>Year</th>
          <th>January</th>
          <th>February</th>
          <th>March</th>
          <th>April</th>
          <th>May</th>
          <th>June</th>
          <th>July</th>
          <th>August</th>
          <th>September</th>
          <th>October</th>
          <th>November</th>
          <th>December</th>
        </tr>
      </thead>
      <tbody id="yearlyTableBody"><tr><td colspan="13" class="empty">No data</td></tr></tbody>
    </table>
  </div>
  <div style="text-align: center; margin-top: 20px;">
    <button id="yearlyPNLBtn" style="padding: 15px 30px; background: #10b981; color: #fff; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer;">Yearly PNL</button>
  </div>
</div>
<!-- WEEKLY VIEW -->
<div class="container" id="weeklyArea" style="display: none;">
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
    <button class="btn btn-toggle" onclick="showDailyPNL()">Daily Report</button>
    <button class="btn btn-toggle" onclick="toggleMonthlyView()">Monthly Report</button>
    <button class="btn btn-toggle" onclick="toggleWeeklyView()">Weekly Report</button>
    <button class="btn btn-toggle" onclick="toggleYearlyView()">Yearly Report</button>
    <button class="btn btn-toggle" onclick="showVisualizations()">View Chart</button>
  </div>
  <div class="title-box">
    <h1>ðŸ“… Weekly Report</h1>
    <p></p>
  </div>
  <div id="weekSummaryCard" class="week-summary-card">
    <div>
      <h4 id="weekTitle"></h4>
      <select id="weekSelector" style="padding: 5px 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--input-bg); color: var(--text); font-size: 14px; min-width: 200px; display: block; margin: 0 auto;"></select>
    </div>
    <div class="val" id="weekVal">â‚¹0.00</div>
    <div id="summaryDetails" style="margin-top: 6px; color: var(--text-muted);">Trades: 0</div>
    <div id="avgDetail" style="color: var(--text-muted); font-size: 12px; margin-top: 6px;">Avg/trade: â‚¹0.00</div>
  </div>
  <div class="view-buttons">
    <button class="view-btn active" onclick="switchView('week')">Week</button>
    <button class="view-btn" onclick="switchView('year')">Year</button>
  </div>
  <div class="nav">
    <button id="prevNav">â—€</button>
    <select id="dateSelector"></select>
    <button id="nextNav">â–¶</button>
  </div>
  <div id="weekView">
    <div class="table-wrapper">
      <table class="calendar-grid">
        <thead class="calendar-header">
          <tr>
            <th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th><th>Weekend</th><th>Total</th>
          </tr>
        </thead>
        <tbody id="calendarBody">
          <!-- Populated by JS -->
        </tbody>
      </table>
  </div>
  </div>
  <div id="yearView" style="display:none;">
    <div class="year-view" id="monthCardsYear">
      <!-- Populated by JS -->
    </div>
  </div>
  <div class="footer">
    <div class="radio-group">
      <input type="radio" id="pnlToggle" name="toggle" checked>
      <label for="pnlToggle">Pnl Amt</label>
      <input type="radio" id="winToggle" name="toggle">
      <label for="winToggle">Win Ratio</label>
    </div>
    <button class="clear-btn" onclick="clearWeeklyData()">Clear All Data</button>
  </div>
</div>
<!-- CRYPTO JOURNAL VIEW -->
<div id="cryptoArea" style="display: none;">
  <div class="max-w-7xl mx-auto">
    <!-- Navigation -->
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="showDailyPNL()">Daily Report</button>
      <button class="btn btn-toggle" onclick="toggleWeeklyView()">Weekly Report</button>
      <button class="btn btn-toggle" onclick="toggleMonthlyView()">Monthly Report</button>
      <button class="btn btn-toggle" onclick="toggleYearlyView()">Yearly Report</button>
      <button class="btn btn-toggle" onclick="showVisualizations()">View Chart</button>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle btn-red" onclick="showJournal()" style="background: #ef4444; margin: 0 auto;">Back to Journal</button>
    </div>
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-8 mb-6 shadow-2xl text-center">
        <h1 class="text-4xl font-bold text-white mb-2">ðŸ“Š Crypto Trading Journal</h1>
        <p class="text-purple-100">Track all your trades in one place</p>
    </div>
        <!-- Statistics Dashboard -->
        <div id="crypto-stats-dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <!-- Stats will be inserted here -->
        </div>
        <!-- Add Trade Button -->
        <div class="mb-6 text-center">
            <button id="add-trade-btn" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-xl font-bold text-sm hover:from-green-600 hover:to-blue-600 transition-all shadow-lg inline-flex items-center gap-2" onclick="toggleCryptoForm()">
                âž• Add New Trade
            </button>
        </div>
        <!-- Trade Form -->
        <div id="trade-form-container" class="bg-white rounded-2xl p-6 shadow-xl mb-6 max-h-screen overflow-y-auto" style="display: none;">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">âž• <span id="form-title">Add New Trade</span></h2>
            <form id="trade-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                        <input type="date" id="date" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Market Type</label>
                        <select id="market" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="Crypto Trading">Crypto Trading</option>
                            <option value="Forex Trading">Forex Trading</option>
                            <option value="Commodity Trading">Commodity Trading</option>
                        </select>
                    </div>
                    <div id="exchange-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Exchange</label>
                        <select id="exchange" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option>Binance</option>
                            <option>Coinbase</option>
                            <option>WazirX</option>
                            <option>Kraken</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div id="pair-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Trading Pair</label>
                        <input type="text" id="pair" placeholder="BTC/USDT" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="subtype-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Sub-Type</label>
                        <select id="subtype" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option>Spot</option>
                            <option>Futures</option>
                            <option>Margin</option>
                            <option>Options</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Instrument</label>
                        <select id="instrument" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Trade Type</label>
                        <select id="type" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option>Buy</option>
                            <option>Sell</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Quantity</label>
                        <input type="number" id="qty" step="0.0001" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Lot Size</label>
                        <input type="number" id="lotsize" step="0.0001" readonly class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg bg-gray-50">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Entry Price</label>
                        <input type="number" id="entry" step="0.01" required class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Stop Loss</label>
                        <input type="number" id="stopLoss" step="0.01" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Exit Price</label>
                        <input type="number" id="exit" step="0.01" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Entry Time</label>
                        <input type="time" id="entryTime" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Exit Time</label>
                        <input type="time" id="exitTime" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="leverage-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Leverage</label>
                        <input type="number" id="leverage" step="1" value="1" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="fee-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Transaction Fee (%)</label>
                        <input type="number" id="fee" step="0.01" value="0.1" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="funding-field" style="display:none;">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Funding Rate (%)</label>
                        <input type="number" id="fundingRate" step="0.001" value="0" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="wallet-field">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Wallet/Tx ID</label>
                        <input type="text" id="wallet" placeholder="Optional" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Followed Plan</label>
                        <select id="followedPlan" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Market Condition</label>
                        <select id="marketCondition" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="Bullish">Bullish</option>
                            <option value="Bearish">Bearish</option>
                            <option value="Neutral">Neutral</option>
                            <option value="Volatile">Volatile</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Confidence Level</label>
                        <select id="confidenceLevel" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Time Frame</label>
                        <select id="timeFrame" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="Intraday">Intraday</option>
                            <option value="Swing">Swing</option>
                            <option value="Long-term">Long-term</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Trade For Reason</label>
                        <textarea id="reason" rows="4" placeholder="Reason for the trade..." class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Mistakes</label>
                        <textarea id="mistakes" rows="4" placeholder="Any mistakes made..." class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
                        <textarea id="notes" rows="4" placeholder="Trade notes..." class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                    </div>
                </div>
                <div class="flex justify-center gap-3">
                    <button type="submit" id="submit-btn" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg flex items-center justify-center gap-2">
                        ðŸ’¾ Save Trade
                    </button>
                    <button type="button" id="cancel-btn" style="display:none;" class="p-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all text-2xl w-12 h-12 flex items-center justify-center">
                        âŒ
                    </button>
                </div>
            </form>
        </div>
        <!-- Trades Table -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="p-6 bg-gradient-to-r from-purple-600 to-blue-600 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white">ðŸ“œ Trade History</h2>
                <button id="clear-all" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
                    ðŸ—‘ï¸ Clear All
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Date</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Market</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Instrument</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Exchange</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Pair</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Type</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Qty</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Entry</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Exit</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Leverage</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Fee</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Followed Plan</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Holding</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">P&L</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 border-2 border-gray-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trades-table">
                        <tr>
                            <td colspan="15" class="px-4 py-8 text-center text-gray-500 border-2 border-gray-300">
                                No trades yet. Add your first trade above!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- VISUALIZATIONS MODAL -->
<div id="visualizationsModal">
  <div>
    <!-- First Row: Report Navigation -->
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="showDailyPNL()">Daily Report</button>
      <button class="btn btn-toggle" onclick="toggleWeeklyView()">Weekly Report</button>
      <button class="btn btn-toggle" onclick="toggleMonthlyView()">Monthly Report</button>
      <button class="btn btn-toggle" onclick="toggleYearlyView()">Yearly Report</button>
      <button class="btn btn-toggle" onclick="showVisualizations()">View Chart</button>
    </div>
    <!-- Second Row: Back to Journal Button (Centered) -->
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px;">
      <button class="btn btn-toggle btn-red" onclick="showJournal()" style="background: linear-gradient(135deg, #ef4444, #dc2626); padding: 12px 30px; font-size: 18px; font-weight: 700;">
        â—€ Back to Journal
      </button>
    </div>
    <div class="chart-nav">
      <button id="prevMonthChart">â—€ Prev Month</button>
      <select id="chartMonth">
        <option value="0">January</option>
        <option value="1">February</option>
        <option value="2">March</option>
        <option value="3">April</option>
        <option value="4">May</option>
        <option value="5">June</option>
        <option value="6">July</option>
        <option value="7">August</option>
        <option value="8">September</option>
        <option value="9">October</option>
        <option value="10">November</option>
        <option value="11">December</option>
      </select>
      <button id="nextMonthChart">Next Month â–¶</button>
    </div>
    <div style="display:grid; grid-template-columns:3fr 1fr; gap:20px;">
      <div>
        <canvas id="plChart"></canvas>
        <canvas id="winRateChart"></canvas>
        <canvas id="strategyChart"></canvas>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin-top:20px;">
          <div class="stat-card profit">
            <h3>Profit Trends</h3>
            <div class="value" id="monthlyProfit">0</div>
          </div>
          <div class="stat-card loss">
            <h3>Loss Trends</h3>
            <div class="value" id="monthlyLoss">0</div>
          </div>
          <div class="stat-card">
            <h3>Monthly Summary</h3>
            <div class="value" id="netAmount">0</div>
          </div>
        </div>
      </div>
      <div>
        <div style="border:2px solid var(--border); padding:20px; border-radius:8px; max-height:1100px; overflow-y:auto;">
          <h3>Recent Entries</h3>
          <div id="recentEntries"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- SEARCH/FILTER MODAL -->
<div id="searchFilterModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="showJournal()">â—€ Back to journal</button>
    </div>
    <h2>Search & Filter Trades</h2>
    <input type="text" id="searchInput" placeholder="Search by Instrument or Notes">
    <select id="filterMarket">
      <option value="">Filter by Market Type</option>
      <option value="Index Options">Index Options</option>
      <option value="Stock Options">Stock Options</option>
      <option value="Stock Trading">Stock Trading</option>
      <option value="Forex Trading">Forex Trading</option>
    </select>
    <button onclick="applyFilter()">Apply Filter</button>
    <div id="filteredTrades"></div>
  </div>
</div>
<!-- RISK CALCULATOR MODAL -->
<div id="riskCalculatorModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="showJournal()">â—€ Back to journal</button>
    </div>
    <h2>Risk Management Calculator</h2>
    <div class="form-field">
      <label>Account Balance (â‚¹)</label>
      <input type="number" id="accountBalanceModal" placeholder="e.g., 100000">
    </div>
    <div class="form-field">
      <label>Risk Per Trade (%)</label>
      <input type="number" id="riskPercentModal" placeholder="e.g., 1" step="0.1">
    </div>
    <div class="form-field">
      <label>Entry Price (â‚¹)</label>
      <input type="number" id="calcEntry" placeholder="e.g., 150">
    </div>
    <div class="form-field">
      <label>Stop Loss (â‚¹)</label>
      <input type="number" id="calcSL" placeholder="e.g., 140">
    </div>
    <button onclick="calculateRisk()">Calculate</button>
    <div id="riskResult"></div>
  </div>
</div>
<!-- MISTAKES MODAL -->
<div id="mistakesModal">
  <div class="modal-content">
    <span class="close" onclick="closeMistakesModal()">&times;</span>
    <h2>Mistakes Made</h2>
    <form id="mistakesForm">
      <div class="mistake-item">
        <input type="checkbox" id="mistake1" name="mistakes" value="Exceeded Position Size">
        <label for="mistake1">Exceeded Position Size</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake2" name="mistakes" value="Poor Entry">
        <label for="mistake2">Poor Entry</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake3" name="mistakes" value="Ignored Setup">
        <label for="mistake3">Ignored Setup</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake4" name="mistakes" value="Emotional Decision">
        <label for="mistake4">Emotional Decision</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake5" name="mistakes" value="Overtrading">
        <label for="mistake5">Overtrading</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake6" name="mistakes" value="Revenge Trade">
        <label for="mistake6">Revenge Trade</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake7" name="mistakes" value="Poor Timing">
        <label for="mistake7">Poor Timing</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake8" name="mistakes" value="Poor Research">
        <label for="mistake8">Poor Research</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake9" name="mistakes" value="No Stop-Loss / Ignored SL">
        <label for="mistake9">No Stop-Loss / Ignored SL</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake10" name="mistakes" value="Averaging Losing Trades">
        <label for="mistake10">Averaging Losing Trades</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake11" name="mistakes" value="Took Profits Too Early">
        <label for="mistake11">Took Profits Too Early</label>
      </div>
      <div class="mistake-item">
        <input type="checkbox" id="mistake12" name="mistakes" value="Overconfidence After Wins">
        <label for="mistake12">Overconfidence After Wins</label>
      </div>
      <button type="submit">Save Mistakes</button>
    </form>
  </div>
</div>
<!-- Daily PNL Modal -->
<div id="dailyPNLModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('dailyPNLModal'); showDailyPNL()">Daily Report</button>
      <button class="btn btn-toggle" onclick="closeModal('dailyPNLModal'); toggleWeeklyView()">Weekly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('dailyPNLModal'); toggleMonthlyView()">Monthly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('dailyPNLModal'); toggleYearlyView()">Yearly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('dailyPNLModal'); showVisualizations()">View Chart</button>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle btn-red" onclick="showJournal()" style="background: #ef4444; margin: 0 auto;">Back to Journal</button>
    </div>
    <input type="date" id="dailyDate" onchange="updateDailyPNL()">
    <canvas id="dailyChart"></canvas>
    <table id="dailyTable">
      <thead>
        <tr>
          <th>Instrument</th>
          <th>Type</th>
          <th>Entry</th>
          <th>Exit</th>
          <th>Lots</th>
          <th>Quantity</th>
          <th>Points Captured</th>
          <th>P&L</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <!-- New: Final PNL Button -->
    <button id="finalPNLBtn" class="final-pnl-btn" style="display: none;">Final PNL: â‚¹0.00</button>
  </div>
</div>
<!-- Total Capital Modal -->
<div id="totalCapitalModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('totalCapitalModal'); showDailyPNL()">Daily Report</button>
      <button class="btn btn-toggle" onclick="closeModal('totalCapitalModal'); toggleWeeklyView()">Weekly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('totalCapitalModal'); toggleMonthlyView()">Monthly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('totalCapitalModal'); toggleYearlyView()">Yearly Report</button>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle btn-red" onclick="showJournal()" style="background: #ef4444; margin: 0 auto; color: white;">Back to Journal</button>
    </div>
    <h2>Total Capital Summary</h2>
    <div class="input-group">
      <input type="text" id="initialCapital" class="amount-input" placeholder="Initial Capital (e.g., 1,00,000)">
    </div>
    <div id="capitalTableWrapper" class="table-wrapper">
      <table id="capitalTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Opening Balance</th>
            <th>Closing Balance</th>
            <th>Trade Count</th>
            <th>Charges</th>
            <th>Daily P&L</th>
            <th>Total Capital</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="totalCapitalButton" style="text-align: center; margin-top: 10px;"></div>
  </div>
</div>
<!-- New: Gold Calculator Modal - Embedded from Script 2 -->
<div id="goldCalculatorModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('goldCalculatorModal'); showDailyPNL()" style="font-size: 10px; padding: 6px 10px;">Daily Report</button>
      <button class="btn btn-toggle" onclick="closeModal('goldCalculatorModal'); toggleWeeklyView()" style="font-size: 10px; padding: 6px 10px;">Weekly Report</button>
      <button class="btn btn-toggle btn-red" onclick="closeModal('goldCalculatorModal'); showJournal()" style="background: #ef4444; font-size: 10px; padding: 6px 10px;">Back To Journal</button>
      <button class="btn btn-toggle" onclick="closeModal('goldCalculatorModal'); toggleMonthlyView()" style="font-size: 10px; padding: 6px 10px;">Monthly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('goldCalculatorModal'); toggleYearlyView()" style="font-size: 10px; padding: 6px 10px;">Yearly Report</button>
    </div>
    <h1>ðŸ† Gold Calculator</h1>
    <div class="formula-box" id="formulaBox" style="display: none;">
        <div class="formula-text">
            <strong>Formula:</strong><br>
            1. Square Root = âˆš(Today's Gold Value)<br>
            2. Add = Square Root + 0.105<br>
            3. Final Value = (Added Value)Â²<br><br>
            4. Points = Opening Value - Final Value<br>
            5. UP Values = Opening - Points (then keep subtracting)<br>
            6. DOWN Values = Opening + Points (then keep adding)<br>
            7. Range Value = Final Value - Opening Value<br>
            8. Range Value Ã— 2, Range Value Ã— 4
        </div>
    </div>
    <div class="input-group">
        <label for="goldValue">Today's Gold Opening Value:</label>
        <input type="number" id="goldValue" placeholder="Example: 7500" step="0.01">
    </div>
    <button onclick="calculateGold()">âœ¨ Calculate</button>
    <div class="result-group" id="goldResultGroup">
        <div class="calculations-box">
            <div class="calc-grid">
                <div class="calc-item">
                    <div class="calc-label">ðŸ“Š Today's Value</div>
                    <div class="calc-value highlighted" id="goldOriginalValue">-</div>
                </div>
                <div class="calc-item">
                    <div class="calc-label">âˆš Square Root</div>
                    <div class="calc-value highlighted" id="goldSqrtValue">-</div>
                </div>
                <div class="calc-item calc-item-full">
                    <div class="calc-label">âž• After Adding 0.105</div>
                    <div class="calc-value highlighted" id="goldAddedValue">-</div>
                </div>
                <button class="final-value-btn" id="goldFinalValueBtn">
                    <span style="display: block; font-size: 13px; margin-bottom: 5px; opacity: 0.9;">ðŸŽ¯ Final Value (Squared)</span>
                    <span id="goldFinalValue">-</span>
                </button>
            </div>
        </div>
        <div class="range-box">
            <div class="range-title">ðŸ“Š Range Values</div>
            <div class="range-values">
                <div class="range-item">
                    <div class="range-item-label">Range Value</div>
                    <div class="range-item-value" id="goldRangeValue">-</div>
                </div>
                <div class="range-item">
                    <div class="range-item-label">Range Value Ã— 2</div>
                    <div class="range-item-value" id="goldRangeMultiply2">-</div>
                </div>
                <div class="range-item">
                    <div class="range-item-label">Range Value Ã— 4</div>
                    <div class="range-item-value" id="goldRangeMultiply4">-</div>
                </div>
            </div>
        </div>
        <div class="two-column">
            <div class="column-box">
                <div class="column-title up">ðŸ“ˆ UP Values</div>
                <div class="value-row highlighted" id="goldUpValue1">-</div>
                <div class="value-row highlighted" id="goldUpValue2">-</div>
                <div class="value-row highlighted" id="goldUpValue3">-</div>
                <div class="value-row highlighted" id="goldUpValue4">-</div>
                <div class="value-row highlighted" id="goldUpValue5">-</div>
            </div>
            <div class="column-box">
                <div class="column-title down">ðŸ“‰ DOWN Values</div>
                <div class="value-row highlighted" id="goldDownValue1">-</div>
                <div class="value-row highlighted" id="goldDownValue2">-</div>
                <div class="value-row highlighted" id="goldDownValue3">-</div>
                <div class="value-row highlighted" id="goldDownValue4">-</div>
                <div class="value-row highlighted" id="goldDownValue5">-</div>
            </div>
        </div>
        <button class="export-btn" onclick="downloadGoldExcel()">ðŸ“¥ Download Excel</button>
    </div>
  </div>
</div>
<!-- New: BTC Calculator Modal -->
<div id="btcCalculatorModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('btcCalculatorModal'); showDailyPNL()" style="font-size: 10px; padding: 6px 10px;">Daily Report</button>
      <button class="btn btn-toggle" onclick="closeModal('btcCalculatorModal'); toggleWeeklyView()" style="font-size: 10px; padding: 6px 10px;">Weekly Report</button>
      <button class="btn btn-toggle btn-red" onclick="closeModal('btcCalculatorModal'); showJournal()" style="background: #ef4444; font-size: 10px; padding: 6px 10px;">Back To Journal</button>
      <button class="btn btn-toggle" onclick="closeModal('btcCalculatorModal'); toggleMonthlyView()" style="font-size: 10px; padding: 6px 10px;">Monthly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('btcCalculatorModal'); toggleYearlyView()" style="font-size: 10px; padding: 6px 10px;">Yearly Report</button>
    </div>
    <div class="main-container">
        <!-- Script 1 Section -->
        <div class="section">
            <h2></h2>
            <div class="script1">
                <div class="container">
                    <div class="title-box">
                        <button class="title-btn">BTC Day Range Calculator</button>
                    </div>
                    <div class="card">
                        <table>
                            <thead>
                                <tr>
                                    <th>Day Range</th>
                                    <th>Level 1</th>
                                    <th>Level 2</th>
                                    <th>Level 3</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody1">
                                <tr>
                                    <td><input type="number" step="0.01" placeholder="Ex: 1909.37" class="dayRangeInput" onchange="calculateAll1()" oninput="calculateAll1()"></td>
                                    <td><div class="result-box level1-box" id="level1Result1">-</div></td>
                                    <td><div class="result-box level2-box" id="level2Result1">-</div></td>
                                    <td><div class="result-box level3-box" id="level3Result1">-</div></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- Script 2 Section -->
        <div class="section">
            <h2></h2>
            <div class="script2">
                <div class="container">
                    <div class="header"><h1>BTC Level Calculator</h1></div>
                    <div class="input-section">
                        <div class="input-group">
                            <label>Enter Opening Price</label>
                            <input type="number" id="openingPrice" placeholder="Enter Price" step="0.01" value="110580">
                            <button onclick="calculateLevels2()">Calculate</button>
                        </div>
                    </div>
                    <div class="results">
                        <table>
                            <thead>
                                <tr>
                                    <th class="level-col column-header">Level</th>
                                    <th class="upper-levels-header column-header">Upper Levels</th>
                                    <th class="level-col column-header">Level</th>
                                    <th class="lower-levels-header column-header">Lower Levels</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTable2"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- Script 3 Section -->
        <div class="section">
            <h2></h2>
            <div class="script3">
                <div class="container">
                    <div class="title-button">ðŸ“ˆ Gold, BTC Level Calculator</div>
                    <div class="input-section">
                        <div class="input-wrapper">
                            <label for="valA3">Enter Number (A2):</label>
                            <input type="number" id="valA3" value="67072" step="any" placeholder="Enter any number">
                        </div>
                        <button class="calculate-btn" onclick="calculate3()">ðŸ”„ Calculate</button>
                    </div>
                    <div class="results" id="results3">
                        <table class="result-table">
                            <thead>
                                <tr>
                                    <th>A</th>
                                    <th>B</th>
                                    <th>C</th>
                                    <th>D</th>
                                    <th>E</th>
                                    <th>F</th>
                                    <th>G</th>
                                    <th>H</th>
                                    <th>I</th>
                                    <th>J</th>
                                </tr>
                            </thead>
                            <tbody id="resultBody3"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
</div>
<!-- New: Nifty Setup Modal -->
<div id="niftySetupModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('niftySetupModal'); showJournal()" style="background: #ef4444; color: white;">Back to Journal</button>
    </div>
    <div class="nifty-container">
        <div class="nifty-header">
            <h1>ðŸ•¯ï¸ NIFTY TIME SETUP</h1>
        </div>
        <div class="nifty-content">
            <table class="nifty-excel-table">
                <thead>
                    <tr>
                        <th style="width: 35%;"></th>
                        <th style="width: 35%;"></th>
                        <th style="width: 30%;">Candle</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="nifty-label-cell">Enter Opening Price</td>
                        <td class="nifty-input-cell">
                            <input type="number" id="niftyOpenPrice" step="0.01" value="24339" placeholder="Enter Opening">
                        </td>
                        <td class="nifty-result-cell" id="niftyAngleDisplay">-</td>
                    </tr>
                    <tr>
                        <td colspan="2" class="nifty-unit-cell">
                            <strong>Unit:</strong> <span id="niftyUnitDisplay">-</span>
                        </td>
                        <td class="nifty-candle-cell" id="niftyCandleDisplay">-</td>
                    </tr>
                </tbody>
            </table>
            <button class="nifty-button" onclick="calculateNifty()">ðŸ“Š Calculate</button>
        </div>
    </div>
  </div>
</div>
<!-- New: Range Calculator Modal - Embedded from Script 2 -->
<div id="rangeCalculatorModal">
  <div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 12px;">
      <button class="btn btn-toggle" onclick="closeModal('rangeCalculatorModal'); showDailyPNL()" style="font-size: 10px; padding: 6px 10px;">Daily Report</button>
      <button class="btn btn-toggle" onclick="closeModal('rangeCalculatorModal'); toggleWeeklyView()" style="font-size: 10px; padding: 6px 10px;">Weekly Report</button>
      <button class="btn btn-toggle btn-red" onclick="closeModal('rangeCalculatorModal'); showJournal()" style="background: #ef4444; font-size: 10px; padding: 6px 10px;">Back To Journal</button>
      <button class="btn btn-toggle" onclick="closeModal('rangeCalculatorModal'); toggleMonthlyView()" style="font-size: 10px; padding: 6px 10px;">Monthly Report</button>
      <button class="btn btn-toggle" onclick="closeModal('rangeCalculatorModal'); toggleYearlyView()" style="font-size: 10px; padding: 6px 10px;">Yearly Report</button>
    </div>
    <div id="range-root"></div>
  </div>
</div>
<!-- EXTERNAL LIBS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const { jsPDF } = window.jspdf;
let trades = [], editingIndex = -1;
const longGoldenQuotes = "â€œDiscipline is the bridge between goals and accomplishment.â€ â€“ Jim Rohn | ðŸ’¡ \"Trade what you see, not what you think.\" | âš¡ \"Discipline is your real edge.\" | ðŸ’° \"Cut losses early, let profits run.\" | ðŸŽ¯ \"No plan = No trade.\" | ðŸ§  \"Control emotions, control outcomes.\" | â³ \"Patience pays the biggest profits.\" | ðŸ“‰ \"Risk small, trade smart.\" | ðŸ“Š \"Consistency is greater than prediction.\" | ðŸš€ \"Every loss teaches â€” every win tests.\" | ðŸ”’ \"Protect capital first, profit next.\" | â€œPlan First, Trade Later.â€ â€“ Nithwinh Niyaanth | â€œRisk Only 1â€“2% Per Tradeâ€ â€“ Warren Buffett | â€œAlways use a stop-loss â€” position sizing is the key to survival..â€ â€“ Mownica | â€œCut your losses quickly and let profits run.â€ â€“ Old Trading Wisdom | â€œPlan the trade, trade the plan.â€ â€“ Yarramsetty Krishna | â€œThe trend is your friend until the end when it bends.â€ â€“ Ed Seykota | ðŸ’° \"Buy less, think more.\" | ðŸ§˜â€â™‚ï¸ \"Stay calm, stay consistent.\" | ðŸ“ˆ \"Follow the trend, not the crowd.\" | ðŸ§  \"Less emotion, more logic.\" | â³ \"Wait for your setup.\" | âš–ï¸ \"Risk first, reward next.\" | ðŸ“Š \"Charts donâ€™t lie.\" | ðŸ”’ \"Protect your capital.\" | ðŸŽ¯ \"One good trade is enough.\" | ðŸ’ª \"Patience builds profits.\" | ðŸš€ \"Every trade is a new beginning.\" | ðŸ’Ž \"Stay focused, the profits will follow.\" | ðŸ§  \"Master your mind, master the market.\" | ðŸŒ… \"A new day, a new opportunity.\" | ðŸ† \"Winners never quit, traders never fear.\" | ðŸ”¥ \"Turn patience into profit.\" | ðŸ’¡ \"Dream big, trade smart.\" | ðŸ“ˆ \"Believe in your strategy â€” trust the process.\" | ðŸŒŸ \"Consistency turns small gains into greatness.\"";
// Updated: Split into individual quotes array for one-by-one slow scrolling
const quotes = longGoldenQuotes.split('|').map(q => q.trim()).map(q => q);
let currentQuoteIndex = 0;
// Updated: Index Options now limited to 5 specific instruments with lot sizes
const instrumentData = {
  'Index Options': { instruments: ['Nifty', 'Banknifty', 'FinNifty', 'Midcap Nifty', 'Sensex'], lotSizes: {'Nifty':65, 'Banknifty':30, 'FinNifty':60, 'Midcap Nifty':120, 'Sensex':20} },
  'Stock Options': { instruments: ['TCS','INFY','RELIANCE','HDFC BANK','ICICI BANK','BAJAJ FINSERV','LT','MARUTI','AXIS BANK','WIPRO','HCL TECH','DIXON','ASIAN PAINTS','TITAN','ADANI PORTS'], lotSizes: {'TCS':300,'INFY':600,'RELIANCE':500,'HDFC BANK':500,'ICICI BANK':1500,'BAJAJ FINSERV':400,'LT':1500,'MARUTI':100,'AXIS BANK':1500,'WIPRO':1800,'HCL TECH':700,'DIXON':125,'ASIAN PAINTS':300,'TITAN':500,'ADANI PORTS':1000} },
  'Stock Trading': { instruments: ['TCS','INFY','RELIANCE','HDFC BANK','ICICI BANK','LT','MARUTI','ITC','AIRTEL','SBIN','DIXON','HCL TECH','ASIAN PAINTs','TITAN'] }
};
/* ---------- ADDED VARIABLES FOR MONTHLY/YEARLY/WEEKLY VIEW ---------- */
var currentViewYear = 2025;
var currentViewMonth = 10; // October
var globalDailyPL = {};
var holidays2025 = [
  '2025-01-01', '2025-01-26', '2025-03-14', '2025-03-31', '2025-04-10', '2025-04-18', '2025-05-01',
  '2025-05-12', '2025-08-15', '2025-10-02', '2025-10-21', '2025-11-05', '2025-11-14', '2025-12-25'
];
/* ---------- WEEKLY REPORT SPECIFIC VARIABLES ---------- */
let weeklyData = {};
let currentWeeklyMonth = 10;
let currentWeeklyYear = 2025;
let currentWeekStart = null;
let viewMode = 'pnl'; // 'pnl' or 'win'
const today = new Date();
let notificationsEnabled = false;
// Data structure
const cryptoInstrumentData = {
    'Forex Trading': {
        instruments: ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'USD/CAD', 'BTC/USD', 'ETH/USD'],
        lotSizes: { 'EUR/USD': 100000, 'GBP/USD': 100000, 'USD/JPY': 100000, 'AUD/USD': 100000, 'USD/CAD': 100000, 'BTC/USD': 1, 'ETH/USD': 1 }
    },
    'Crypto Trading': {
        instruments: ['BTC', 'ETH', 'SOL', 'BNB', 'XRP', 'ADA', 'DOGE', 'SHIB', 'AVAX', 'TRX'],
        lotSizes: { 'BTC': 0.01, 'ETH': 0.1, 'SOL': 1, 'BNB': 0.1, 'XRP': 10, 'ADA': 10, 'DOGE': 100, 'SHIB': 10000, 'AVAX': 1, 'TRX': 100 }
    },
    'Commodity Trading': {
        instruments: ['Gold', 'Silver', 'Crude Oil', 'Natural Gas', 'Copper'],
        lotSizes: { 'Gold': 100, 'Silver': 5000, 'Crude Oil': 1000, 'Natural Gas': 10000, 'Copper': 1000 }
    }
};
let cryptoTrades = [];
let editingCryptoId = null;
function getLocalDateStr(d) {
  const pad = n => String(n).padStart(2, '0');
  return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
}
function updateWeeklyDataFromTrades() {
  weeklyData = {};
  trades.forEach(t => {
    if (t.date && t.pl !== undefined) {
      if (!weeklyData[t.date]) weeklyData[t.date] = 0;
      weeklyData[t.date] += Number(t.pl);
    }
  });
  localStorage.setItem('weekly-report-data', JSON.stringify(weeklyData));
}
function computeCurrentMonday() {
  const now = new Date();
  const dayOfWeek = now.getDay();
  const daysToSubtract = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
  const monday = new Date(now);
  monday.setDate(now.getDate() - daysToSubtract);
  monday.setHours(0, 0, 0, 0);
  return monday;
}
function getWeekStartDates(year, month) {
  const weeks = [];
  const firstOfMonth = new Date(year, month - 1, 1);
  const lastOfMonth = new Date(year, month, 0);
  let temp = new Date(firstOfMonth);
  const fdow = firstOfMonth.getDay();
  const daysBack = fdow === 0 ? 6 : fdow - 1;
  temp.setDate(1 - daysBack);
  let currentMonday = temp;
  while (currentMonday <= lastOfMonth) {
    const fri = new Date(currentMonday);
    fri.setDate(currentMonday.getDate() + 4);
    if (fri >= firstOfMonth || currentMonday <= lastOfMonth) {
      weeks.push(new Date(currentMonday));
    }
    currentMonday.setDate(currentMonday.getDate() + 7);
  }
  return weeks;
}
function getWeekLabelAndSummary(weekStartDate) {
  const endDate = new Date(weekStartDate.getTime());
  endDate.setDate(weekStartDate.getDate() + 4);
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const startM = monthNames[weekStartDate.getMonth()];
  const endM = monthNames[endDate.getMonth()];
  const startD = weekStartDate.getDate();
  const endD = endDate.getDate();
  const year = weekStartDate.getFullYear();
  const label = `${startM} ${startD}<br>to<br><br>${endM} ${endD}, ${year}`;
  const weekTrades = trades.filter(t => {
    if (!t.date) return false;
    const tradeDate = new Date(t.date + 'T00:00:00');
    return tradeDate >= weekStartDate && tradeDate <= endDate;
  });
  let weekTotal = 0;
  weekTrades.forEach(t => weekTotal += Number(t.pl || 0));
  const count = weekTrades.length;
  const avg = count > 0 ? (weekTotal / count).toFixed(2) : '0.00';
  return { label, total: weekTotal, count, avg };
}
function populateWeekSelector(year, month, selectedStart) {
  const select = document.getElementById('weekSelector');
  if (!select) return;
  select.innerHTML = '';
  const weekStarts = getWeekStartDates(year, month);
  weekStarts.forEach(ws => {
    const { label } = getWeekLabelAndSummary(ws);
    const opt = document.createElement('option');
    opt.value = getLocalDateStr(ws);
    opt.textContent = label.replace(/<br>/g, ' - '); // Flatten for option text
    if (getLocalDateStr(ws) === getLocalDateStr(selectedStart)) opt.selected = true;
    select.appendChild(opt);
  });
  if (!select._listenerSet) {
    select.onchange = (e) => {
      const val = e.target.value;
      if (!val) return;
      const newStart = new Date(val + 'T00:00:00');
      currentWeekStart = newStart;
      updateWeekSummary(currentWeekStart);
      highlightWeekRow(currentWeekStart);
    };
    select._listenerSet = true;
  }
}
function updateWeekSummary(weekStartDate) {
  const summary = getWeekLabelAndSummary(weekStartDate);
  document.getElementById('weekTitle').innerHTML = '';
  document.getElementById('weekVal').textContent = `â‚¹${formatCurrency(summary.total)}`;
  document.getElementById('summaryDetails').textContent = `Trades: ${summary.count}`;
  document.getElementById('avgDetail').textContent = `Avg/trade: â‚¹${formatCurrency(summary.avg)}`;
  const card = document.getElementById('weekSummaryCard');
  card.classList.toggle('loss', summary.total < 0);
}
function highlightWeekRow(currentWeekStart) {
  const mondayStr = getLocalDateStr(currentWeekStart);
  const targetRow = document.querySelector(`tr[data-week-monday="${mondayStr}"]`);
  if (targetRow) {
    document.querySelectorAll('#weekView tbody tr').forEach(r => {
      r.classList.remove('highlighted-week');
    });
    targetRow.classList.add('highlighted-week');
    targetRow.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  }
}
/* ---------- GOLDEN WORDS ---------- */
// Updated: Initialize one-by-one slow scrolling for quotes
function initGoldenScroll() {
  if (quotes.length === 0) return;
  const span = document.getElementById('goldenQuote');
  function showNextQuote() {
    const quote = quotes[currentQuoteIndex];
    span.textContent = quote + ' '; // Add padding spaces for smooth scroll
    currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
  }
  showNextQuote(); // Show first quote
  span.addEventListener('animationiteration', showNextQuote); // Switch to next on each cycle end
}
/* ---------- THEME TOGGLE ---------- */
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const themes = ['premium-dark-blue', 'light-gray-silver', 'graphite-blue'];
let currentThemeIndex = 0;
const setTheme = (theme) => {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('tradingTheme', theme);
  // Update icon based on theme
  if (theme === 'premium-dark-blue') {
    themeIcon.textContent = 'ðŸŒ™'; // Switch to moon for light
  } else if (theme === 'light-gray-silver') {
    themeIcon.textContent = 'ðŸŒ—'; // Switch to half-moon for royal-blue
  } else if (theme === 'graphite-blue') {
    themeIcon.textContent = 'â˜€ï¸'; // Switch back to sun for dark-slate
  }
};
const savedTheme = localStorage.getItem('tradingTheme') || 'premium-dark-blue';
currentThemeIndex = themes.indexOf(savedTheme);
setTheme(savedTheme);
themeToggle.addEventListener('click', () => {
  currentThemeIndex = (currentThemeIndex + 1) % themes.length;
  const nextTheme = themes[currentThemeIndex];
  setTheme(nextTheme);
});
/* ---------- FORM & DATA ---------- */
function toggleForm() {
  const form = document.getElementById('form');
  const addBtn = document.getElementById('addBtn');
  if (form.classList.contains('show')) {
    // Hide form
    form.classList.remove('show');
    addBtn.innerHTML = '<span class="icon">âž•</span> Add New Trade';
    addBtn.textContent = 'âž• Add New Trade';
    resetForm();
  } else {
    // Show form
    editingIndex = -1;
    document.getElementById('formTitle').textContent = 'ðŸ“ Enter Trade Fields';
    document.getElementById('formTitle').style.display = 'flex';
    form.classList.add('show');
    // Set local current date correctly
    const now = new Date();
    const year = now.getFullYear();
    const mon = String(now.getMonth() + 1).padStart(2, '0');
    const dt = String(now.getDate()).padStart(2, '0');
    document.getElementById('date').value = `${year}-${mon}-${dt}`;
    resetForm();
    addBtn.innerHTML = '<span class="icon">âž•</span> Hide Trade';
    addBtn.textContent = 'âŒ Hide Form';
  }
}
function hideForm() {
  document.getElementById('form').classList.remove('show');
  document.getElementById('addBtn').innerHTML = '<span class="icon">âž•</span> Add New Trade';
  resetForm();
}
function resetForm() {
  ['date','markettype','instrument','type','strike','expiry','entry','exit','qty','lotsize','entrytime','exittime','sl','target','bias','strategy','timeframe','lesson','mistakes','notes','plan','preEmotion','postEmotion','charges','reason','investment'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  document.getElementById('instrument').innerHTML = '<option value="">Select</option>';
  document.getElementById('plan').value = 'Yes';
  calculateInvestment();
}
function updateInstruments() {
  const mt = document.getElementById('markettype').value;
  const inst = document.getElementById('instrument');
  inst.innerHTML = '<option value="">Select</option>';
  if (mt && instrumentData[mt]) {
    instrumentData[mt].instruments.forEach(i => {
      const o = document.createElement('option');
      o.value = i; o.textContent = i;
      inst.appendChild(o);
    });
  }
  const hide = mt === 'Stock Trading';
  document.getElementById('lotsizeField').classList.toggle('hidden', hide);
  document.getElementById('expiryField').classList.toggle('hidden', hide);
  if (hide) {
    document.getElementById('lotsize').value = '1';
  }
  calculateInvestment();
}
function updateLotSize() {
  const mt = document.getElementById('markettype').value;
  const inst = document.getElementById('instrument').value;
  if (mt && inst && instrumentData[mt]?.lotSizes?.[inst]) {
    document.getElementById('lotsize').value = instrumentData[mt].lotSizes[inst];
  }
  calculateInvestment();
}
function calculateInvestment() {
  const qty = parseFloat(document.getElementById('qty').value) || 0;
  const lotsize = parseFloat(document.getElementById('lotsize').value) || 0;
  const entry = parseFloat(document.getElementById('entry').value) || 0;
  const investment = qty * lotsize * entry;
  document.getElementById('investment').value = formatCurrency(investment);
}
function saveTrade() {
  const t = {
    date: document.getElementById('date').value,
    markettype: document.getElementById('markettype').value,
    instrument: document.getElementById('instrument').value,
    type: document.getElementById('type').value,
    strike: Number(document.getElementById('strike').value) || 0,
    expiry: document.getElementById('expiry').value,
    entry: Number(document.getElementById('entry').value) || 0,
    exit: Number(document.getElementById('exit').value) || 0,
    qty: Number(document.getElementById('qty').value) || 1,
    lotsize: Number(document.getElementById('lotsize').value) || 1,
    entrytime: document.getElementById('entrytime').value,
    exittime: document.getElementById('exittime').value,
    sl: document.getElementById('sl').value || '',
    target: document.getElementById('target').value || '',
    bias: document.getElementById('bias').value || '',
    strategy: document.getElementById('strategy').value || '-',
    plan: document.getElementById('plan').value,
    timeframe: document.getElementById('timeframe').value ||'',
    reason: document.getElementById('reason').value || '',
    lesson: document.getElementById('lesson').value || '',
    mistakes: document.getElementById('mistakes').value || '',
    notes: document.getElementById('notes').value || '-',
    preEmotion: document.getElementById('preEmotion').value || '',
    postEmotion: document.getElementById('postEmotion').value || '',
    charges: Number(document.getElementById('charges').value) || 0,
    investment: Number(document.getElementById('investment').value.replace(/,/g, '')) || 0
  };
  if (!t.date || !t.markettype || !t.instrument || !t.type || t.entry === 0 || t.exit === 0) {
    alert('Fill all required fields!');
    return;
  }
  // Fixed P&L calculation for BUY/SELL and LONG/SHORT
  const isBuyer = t.type.startsWith('BUY') || t.type === 'LONG';
  const diff = isBuyer ? (t.exit - t.entry) : (t.entry - t.exit);
  t.pl = diff * t.qty * t.lotsize;
  t.plpct = t.entry !== 0 ? ((diff / t.entry) * 100).toFixed(2) : '0.00';
  if (editingIndex >= 0) {
    trades[editingIndex] = t;
  } else {
    trades.push(t);
  }
  trades.sort((a,b) => b.date.localeCompare(a.date));
  saveData();
  updateWeeklyDataFromTrades();
  render();
  updateStats();
  renderMonthly();
  renderYearlyTable();
  if (notificationsEnabled) sendNotification('Trade Added', `New trade saved with P&L: â‚¹${t.pl.toFixed(2)}`);
  hideForm();
}
let currentPage = 1;
const tradesPerPage = 10;
function render() {
  const tbody = document.getElementById('tbody');
  tbody.innerHTML = '';
  if (!trades || trades.length === 0) {
    tbody.innerHTML = '<tr><td colspan="16" style="text-align:center;padding:50px;color:var(--text-muted);">No trades yet</td></tr>';
    return;
  }
  const start = (currentPage - 1) * tradesPerPage;
  const end = start + tradesPerPage;
  const pageTrades = trades.slice(start, end);
  pageTrades.forEach((t, local_i) => {
    const global_i = start + local_i;
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${formatDate(t.date) || ''}</td><td><strong>${t.instrument || ''}</strong></td><td>${t.type || ''}</td><td>${t.strike || ''}</td>
      <td>â‚¹${formatCurrency(t.entry) || '0.00'}</td><td>â‚¹${formatCurrency(t.exit) || '0.00'}</td>
      <td>${t.qty || 0}</td><td>${t.qty * t.lotsize}</td>
      <td>â‚¹${formatCurrency(t.investment || 0)}</td>
      <td class="${t.pl >= 0 ? 'profit' : 'loss'}">â‚¹${formatCurrency(t.pl) || '0.00'}</td>
      <td>â‚¹${formatCurrency(t.charges)}</td>
      <td class="${t.pl >= 0 ? 'profit' : 'loss'}">${t.plpct || '0.00'}%</td>
      <td>${t.strategy || '-'}</td><td>${t.plan || 'Yes'}</td>
      <td>${t.notes || '-'}</td>
      <td style="display:flex;gap:5px;">
        <button style="padding:6px 10px;background:#3b82f6;color:#fff;border:none;border-radius:5px;cursor:pointer;" onclick="editTrade(${global_i})">Edit</button>
        <button style="padding:6px 10px;background:#ef4444;color:#fff;border:none;border-radius:5px;cursor:pointer;" onclick="deleteTrade(${global_i})">Del</button>
      </td>`;
    tbody.appendChild(row);
  });
  renderPagination();
}
function renderPagination() {
  const totalPages = Math.ceil(trades.length / tradesPerPage);
  const paginationDiv = document.getElementById('pagination');
  paginationDiv.innerHTML = '';
  paginationDiv.style.textAlign = 'center';
  paginationDiv.style.marginTop = '20px'; // Added gap between table and pagination
  const prevBtn = document.createElement('button');
  prevBtn.textContent = 'Previous';
  prevBtn.disabled = currentPage === 1;
  prevBtn.style.marginRight = '10px';
  prevBtn.style.padding = '8px 12px';
  prevBtn.style.background = currentPage === 1 ? '#94a3b8' : 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
  prevBtn.style.color = '#fff';
  prevBtn.style.border = 'none';
  prevBtn.style.borderRadius = '6px';
  prevBtn.style.cursor = currentPage === 1 ? 'not-allowed' : 'pointer';
  prevBtn.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      render();
    }
  };
  paginationDiv.appendChild(prevBtn);
  for (let p = 1; p <= totalPages; p++) {
    const pageBtn = document.createElement('button');
    pageBtn.textContent = p;
    pageBtn.style.margin = '0 5px';
    pageBtn.style.padding = '8px 12px';
    pageBtn.style.background = p === currentPage ? 'linear-gradient(135deg, #6366f1, #4f46e5)' : 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
    pageBtn.style.color = '#fff';
    pageBtn.style.border = 'none';
    pageBtn.style.borderRadius = '6px';
    pageBtn.style.cursor = 'pointer';
    pageBtn.onclick = () => {
      currentPage = p;
      render();
    };
    paginationDiv.appendChild(pageBtn);
  }
  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'Next';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.style.marginLeft = '10px';
  nextBtn.style.padding = '8px 12px';
  nextBtn.style.background = currentPage === totalPages ? '#94a3b8' : 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
  nextBtn.style.color = '#fff';
  nextBtn.style.border = 'none';
  nextBtn.style.borderRadius = '6px';
  nextBtn.style.cursor = currentPage === totalPages ? 'not-allowed' : 'pointer';
  nextBtn.onclick = () => {
    if (currentPage < totalPages) {
      currentPage++;
      render();
    }
  };
  paginationDiv.appendChild(nextBtn);
}
function editTrade(i) {
  if (i < 0 || i >= trades.length) return;
  editingIndex = i;
  const t = trades[i];
  document.getElementById('formTitle').textContent = 'âœï¸ Edit Trade Fields';
  document.getElementById('formTitle').style.display = 'flex';
  document.getElementById('form').classList.add('show');
  document.getElementById('date').value = t.date || '';
  document.getElementById('markettype').value = t.markettype || '';
  updateInstruments();
  setTimeout(() => {
    document.getElementById('instrument').value = t.instrument || '';
    document.getElementById('type').value = t.type || '';
    document.getElementById('strike').value = t.strike || '';
    document.getElementById('expiry').value = t.expiry || '';
    document.getElementById('entry').value = t.entry || '';
    document.getElementById('exit').value = t.exit || '';
    document.getElementById('qty').value = t.qty || '';
    document.getElementById('lotsize').value = t.lotsize || '';
    document.getElementById('entrytime').value = t.entrytime || '';
    document.getElementById('exittime').value = t.exittime || '';
    document.getElementById('sl').value = t.sl || '';
    document.getElementById('target').value = t.target || '';
    document.getElementById('bias').value = t.bias || '';
    document.getElementById('strategy').value = t.strategy || '';
    document.getElementById('plan').value = t.plan || 'Yes';
    document.getElementById('timeframe').value = t.timeframe || '';
    document.getElementById('reason').value = t.reason || '';
    document.getElementById('lesson').value = t.lesson || '';
    document.getElementById('mistakes').value = t.mistakes || '';
    document.getElementById('notes').value = t.notes || '';
    document.getElementById('preEmotion').value = t.preEmotion || '';
    document.getElementById('postEmotion').value = t.postEmotion || '';
    document.getElementById('charges').value = t.charges || '';
    document.getElementById('investment').value = formatCurrency(t.investment || 0);
    calculateInvestment();
  }, 100);
}
function deleteTrade(i) {
  if (i < 0 || i >= trades.length || !confirm('Delete this trade?')) return;
  trades.splice(i, 1);
  trades.sort((a,b) => b.date.localeCompare(a.date));
  saveData();
  updateWeeklyDataFromTrades();
  if (currentPage > Math.ceil(trades.length / tradesPerPage)) {
    currentPage = Math.ceil(trades.length / tradesPerPage) || 1;
  }
  render();
  updateStats();
  renderMonthly();
  renderYearlyTable();
}
function clearAll() {
  if (!confirm('Delete ALL trades?') || !confirm('Final confirmation!')) return;
  trades = [];
  weeklyData = {};
  localStorage.setItem('tradingData', JSON.stringify(trades));
  localStorage.removeItem('weekly-report-data');
  currentPage = 1;
  render();
  updateStats();
  renderMonthly();
  renderYearlyTable();
}
function exportData() {
  if (!trades || trades.length === 0) { alert('No data!'); return; }
  let csv = 'Date,Instrument,Type,Strike,Entry,Exit,Lots,Quantity,Investment,P&L,Charges,%,Strategy,Plan,Notes\n';
  trades.forEach(t => csv += `"${formatDate(t.date) || ''}","${t.instrument || ''}","${t.type || ''}","${t.strike || ''}","${t.entry || 0}","${t.exit || 0}","${t.qty || 0}","${t.qty * t.lotsize}","${t.investment || 0}","${t.pl ? t.pl.toFixed(2) : '0.00'}","${t.charges.toFixed(2)}","${t.plpct || '0.00'}%","${t.strategy || '-'}","${t.plan || 'Yes'}","${(t.notes || '').replace(/"/g,'""')}"\n`);
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
  a.download = 'Trading_Journal_' + new Date().toISOString().split('T')[0] + '.csv';
  a.click();
}
/* Fixed: Email Export Function - Quoted all fields for CSV safety, formatted body as code block for readability, and added fallback alert if mailto fails */
function showEmailExportModal() {
  if (!trades || trades.length === 0) {
    alert('No data to export!');
    return;
  }
  document.getElementById('emailExportModal').style.display = 'block';
  document.getElementById('recipientEmail').value = '';
  document.getElementById('recipientEmail').focus();
}
function sendEmailExport() {
  const email = document.getElementById('recipientEmail').value.trim();
  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    alert('Please enter a valid email address.');
    return;
  }
  let csv = 'Date,Instrument,Type,Strike,Entry,Exit,Lots,Quantity,Investment,P&L,Charges,%,Strategy,Plan,Notes\n';
  trades.forEach(t => csv += `"${formatDate(t.date) || ''}","${t.instrument || ''}","${t.type || ''}","${t.strike || ''}","${t.entry || 0}","${t.exit || 0}","${t.qty || 0}","${t.qty * t.lotsize}","${t.investment || 0}","${t.pl ? t.pl.toFixed(2) : '0.00'}","${t.charges.toFixed(2)}","${t.plpct || '0.00'}%","${t.strategy || '-'}","${t.plan || 'Yes'}","${(t.notes || '').replace(/"/g,'""')}"\n`);
  const subject = `Trading Journal Export - ${new Date().toISOString().split('T')[0]}`;
  const body = `Trading Journal Journal Export - ${new Date().toISOString().split('T')[0]}
Please find the CSV data below. Copy-paste into a .csv file or Excel/Google Sheets.
\`\`\`csv
${csv}
\`\`\`
If email doesn't open, use the "Download Excel" button instead.
Best,
Live Trading Junction Journal`;
  const encodedSubject = encodeURIComponent(subject);
  const encodedBody = encodeURIComponent(body);
  const mailtoLink = `mailto:${email}?subject=${encodedSubject}&body=${encodedBody}`;
  // Try to open email
  const emailWindow = window.open(mailtoLink, '_blank');
  // Better fallback: Check if window opened (basic heuristic), then prompt user
  setTimeout(() => {
    if (emailWindow && emailWindow.closed) {
      // Window opened but closed quickly? Or blocked?
      if (confirm('Email client didn\'t open properly. Download CSV as fallback?')) {
        // Download CSV
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
        a.download = 'Trading_Journal_Email_Export_' + new Date().toISOString().split('T')[0] + '.csv';
        a.click();
      }
    }
  }, 2000); // Increased to 2s for slower devices
  console.log('Email export attempted:', mailtoLink); // Debug in browser console (F12)
  closeModal('emailExportModal');
}
function exportPDF() {
  if (!trades || trades.length === 0) { alert('No data!'); return; }
  html2canvas(document.getElementById('journalArea')).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    const width = pdf.internal.pageSize.getWidth();
    const height = (canvas.height * width) / canvas.width;
    pdf.addImage(imgData, 'PNG', 0, 0, width, height);
    pdf.save('Trading_Journal_' + new Date().toISOString().split('T')[0] + '.pdf');
  });
}
function updateStats() {
  const total = trades.length;
  const wins = trades.filter(t => t.pl >= 0).length;
  const tpl = trades.reduce((a, t) => a + (t.pl || 0), 0);
  const avg = total ? (tpl / total).toFixed(2) : '0.00';
  document.getElementById('total').textContent = total;
  document.getElementById('winrate').textContent = total ? ((wins / total) * 100).toFixed(2) + '%' : '0%';
  document.getElementById('totalpl').textContent = formatCurrency(tpl);
  document.getElementById('totalpl').className = 'value ' + (tpl >= 0 ? 'profit' : 'loss');
  document.getElementById('avgpl').textContent = formatCurrency(avg);
  document.getElementById('profits').textContent = wins;
  document.getElementById('losses').textContent = total - wins;
  // Add Daily PNL calculation
  const today = new Date().toISOString().split('T')[0];
  const todayPL = trades.filter(t => t.date === today).reduce((a, t) => a + (t.pl || 0), 0);
  document.getElementById('dailypnl').textContent = formatCurrency(todayPL);
  document.getElementById('dailypnl').className = 'value ' + (todayPL >= 0 ? 'profit' : 'loss');
  updatePresentCapital();
}
function toggleMonthlyView() {
  const j = document.getElementById('journalArea');
  const m = document.getElementById('monthlyArea');
  const y = document.getElementById('yearlyArea');
  const w = document.getElementById('weeklyArea');
  const c = document.getElementById('cryptoArea');
  const btn = document.getElementById('toggleMonthlyBtn');
  if (m.style.display === 'block') {
    m.style.display = 'none';
    j.style.display = 'block';
    btn.innerHTML = '<span class="icon">ðŸ“Š</span> Monthly Report';
  } else {
    j.style.display = 'none';
    m.style.display = 'block';
    y.style.display = 'none';
    w.style.display = 'none';
    c.style.display = 'none';
    btn.innerHTML = '<span class="icon">ðŸ“Š</span> Back to Journal';
    renderMonthly();
    updateBackButtonInNav('monthlyArea');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}
function toggleYearlyView() {
  const j = document.getElementById('journalArea');
  const m = document.getElementById('monthlyArea');
  const y = document.getElementById('yearlyArea');
  const w = document.getElementById('weeklyArea');
  const c = document.getElementById('cryptoArea');
  const btn = document.getElementById('toggleYearlyBtn');
  if (y.style.display === 'block') {
    y.style.display = 'none';
    j.style.display = 'block';
    btn.innerHTML = '<span class="icon">ðŸ“ˆ</span> Yearly Report';
  } else {
    j.style.display = 'none';
    m.style.display = 'none';
    y.style.display = 'block';
    w.style.display = 'none';
    c.style.display = 'none';
    btn.innerHTML = '<span class="icon">ðŸ“ˆ</span> Back to Journal';
    renderYearlyTable();
    updateBackButtonInNav('yearlyArea');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}
function toggleWeeklyView() {
  const j = document.getElementById('journalArea');
  const m = document.getElementById('monthlyArea');
  const y = document.getElementById('yearlyArea');
  const w = document.getElementById('weeklyArea');
  const c = document.getElementById('cryptoArea');
  const btn = document.getElementById('toggleWeeklyBtn');
  if (w.style.display === 'block') {
    w.style.display = 'none';
    j.style.display = 'block';
    btn.innerHTML = '<span class="icon">ðŸ“…</span> Weekly Report';
  } else {
    j.style.display = 'none';
    m.style.display = 'none';
    y.style.display = 'none';
    w.style.display = 'block';
    c.style.display = 'none';
    btn.innerHTML = '<span class="icon">ðŸ“…</span> Back to Journal';
    renderWeeklyReport();
    updateBackButtonInNav('weeklyArea');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}
function toggleCryptoView() {
  const j = document.getElementById('journalArea');
  const m = document.getElementById('monthlyArea');
  const y = document.getElementById('yearlyArea');
  const w = document.getElementById('weeklyArea');
  const c = document.getElementById('cryptoArea');
  const btn = document.getElementById('toggleCryptoBtn');
  if (c.style.display === 'block') {
    c.style.display = 'none';
    j.style.display = 'block';
    btn.innerHTML = '<span class="icon">â‚¿</span> Crypto Journal';
  } else {
    j.style.display = 'none';
    m.style.display = 'none';
    y.style.display = 'none';
    w.style.display = 'none';
    c.style.display = 'block';
    btn.innerHTML = '<span class="icon">â—€</span> Back to Journal';
    initialize();
    updateBackButtonInNav('cryptoArea');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
}
/* ---------- MONTHLY VIEW RENDERING ---------- */
function renderMonthly() {
  // Update current month/year to system date on render
  const now = new Date();
  currentViewYear = now.getFullYear();
  currentViewMonth = now.getMonth() + 1;
  let months = {};
  let minDate = null, maxDate = null;
  trades.forEach(t => {
    if (!t.date) return;
    const d = new Date(t.date);
    const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
    if (!months[key]) months[key] = { total: 0, count: 0, winningTrades: 0, losingTrades: 0, maxProfit: 0, minLoss: 0, dailyPL: {} };
    months[key].total += Number(t.pl || 0);
    months[key].count += 1;
    const pl = Number(t.pl || 0);
    if (pl > 0) months[key].winningTrades++;
    if (pl < 0) months[key].losingTrades++;
    if (pl > months[key].maxProfit) months[key].maxProfit = pl;
    if (pl < months[key].minLoss) months[key].minLoss = pl;
    if (!months[key].dailyPL[t.date]) months[key].dailyPL[t.date] = 0;
    months[key].dailyPL[t.date] += pl;
    if (!minDate || d < minDate) minDate = d;
    if (!maxDate || d > maxDate) maxDate = d;
  });
  const monthKeys = Object.keys(months).sort();
  const cardsContainer = document.getElementById('monthCards');
  const tableBody = document.getElementById('monthTableBody');
  cardsContainer.innerHTML = '';
  tableBody.innerHTML = '';
  if (monthKeys.length === 0) {
    cardsContainer.innerHTML = '<div class="empty">No trades to summarise</div>';
    tableBody.innerHTML = '<tr><td colspan="7" class="empty">No data</td></tr>';
    updateCalendarView();
    return;
  }
  globalDailyPL = {};
  trades.forEach(t => {
    if (t.date && t.pl !== undefined) {
      if (!globalDailyPL[t.date]) globalDailyPL[t.date] = 0;
      globalDailyPL[t.date] += Number(t.pl);
    }
  });
  if (monthKeys.length > 0) {
    const latestKey = monthKeys[monthKeys.length - 1];
    const latestParts = latestKey.split('-');
    currentViewYear = parseInt(latestParts[0]);
    currentViewMonth = parseInt(latestParts[1]);
  }
  updateCalendarView();
  monthKeys.forEach(k => {
    const parts = k.split('-');
    const yyyy = Number(parts[0]), mm = Number(parts[1]);
    const d = new Date(yyyy, mm - 1, 1);
    const label = d.toLocaleString('default', { month: 'short', year: 'numeric' });
    const mdata = months[k];
    const avg = mdata.count ? (mdata.total / mdata.count).toFixed(2) : '0.00';
    const card = document.createElement('div');
    card.className = 'month-card ' + (mdata.total >= 0 ? 'profit' : 'loss');
    card.innerHTML = `<h4>${label}</h4><div class="val">â‚¹${formatCurrency(mdata.total)}</div><div style="margin-top:6px;color:#555;">Trades: ${mdata.count}</div><div style="color:#777;font-size:12px;margin-top:6px;">Avg/trade: â‚¹${formatCurrency(avg)}</div>`;
    card.onclick = () => {
      currentViewYear = yyyy;
      currentViewMonth = mm;
      updateCalendarView();
    };
    cardsContainer.appendChild(card);
    const row = document.createElement('tr');
    row.className = mdata.total >= 0 ? 'profit' : 'loss';
    const biggestWinner = mdata.maxProfit > 0 ? `â‚¹${formatCurrency(mdata.maxProfit)}` : 'N/A';
    const biggestLoser = mdata.minLoss < 0 ? `â‚¹${formatCurrency(mdata.minLoss)}` : 'N/A';
    const biggestWinnerClass = mdata.maxProfit > 0 ? 'profit' : '';
    const biggestLoserClass = mdata.minLoss < 0 ? 'loss' : '';
    const days = `${mdata.winningTrades || 0} / ${mdata.losingTrades || 0}`;
    row.innerHTML = `<td style="text-align: center;">${label}</td><td style="text-align: center;" class="${mdata.total >= 0 ? 'profit' : 'loss'}">â‚¹${formatCurrency(mdata.total)}</td><td style="text-align: center;">${mdata.count}</td><td style="text-align: center;" class="${avg >= 0 ? 'profit' : 'loss'}">â‚¹${formatCurrency(avg)}</td><td style="text-align: center;" class="${biggestWinnerClass}">${biggestWinner}</td><td style="text-align: center;" class="${biggestLoserClass}">${biggestLoser}</td><td style="text-align: center;">${days}</td>`;
    tableBody.appendChild(row);
  });
  if (!window.calendarListeners) {
    document.getElementById('prevMonth').onclick = () => {
      currentViewMonth--;
      if (currentViewMonth < 1) { currentViewMonth = 12; currentViewYear--; }
      updateCalendarView();
    };
    document.getElementById('nextMonth').onclick = () => {
      currentViewMonth++;
      if (currentViewMonth > 12) { currentViewMonth = 1; currentViewYear++; }
      updateCalendarView();
    };
    window.calendarListeners = true;
  }
  // Update title p with current month year
  const monthlyTitleP = document.querySelector('#monthlyArea .title-box p');
  const monthlyDate = new Date(currentViewYear, currentViewMonth - 1, 1);
  monthlyTitleP.textContent = monthlyDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
}
function updateCalendarView() {
  const date = new Date(currentViewYear, currentViewMonth - 1, 1);
  document.getElementById('currentMonth').textContent = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  generateCalendar(currentViewYear, currentViewMonth, globalDailyPL);
  // Update title <p> on navigation
  const monthlyTitleP = document.querySelector('#monthlyArea .title-box p');
  if (monthlyTitleP) {
    const monthlyDate = new Date(currentViewYear, currentViewMonth - 1, 1);
    monthlyTitleP.textContent = monthlyDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  }
}
function generateCalendar(year, month, dailyPL) {
  const firstDayOfWeek = new Date(year, month - 1, 1).getDay();
  const daysInMonth = new Date(year, month, 0).getDate();
  let calendarHtml = '<table style="border-collapse: collapse; width: 100%; background: white;"><thead><tr>';
  ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
    calendarHtml += `<th style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px; text-align: center; font-size: 12px; border: 2px solid #1e40af; font-weight: bold;">${day}</th>`;
  });
  calendarHtml += '</tr></thead><tbody>';
  let day = 1;
  for (let week = 0; week < 6; week++) {
    calendarHtml += '<tr>';
    for (let wday = 0; wday < 7; wday++) {
      if (week === 0 && wday < firstDayOfWeek) {
        calendarHtml += '<td class="calendar-cell empty" style="text-align: center; vertical-align: middle;">&nbsp;</td>';
      } else if (day > daysInMonth) {
        calendarHtml += '<td class="calendar-cell empty" style="text-align: center; vertical-align: middle;">&nbsp;</td>';
      } else {
        const dateObj = new Date(year, month - 1, day);
        const dateKey = year + '-' + String(month).padStart(2, '0') + '-' + String(day).padStart(2, '0');
        const pl = dailyPL[dateKey] || 0;
        let cellClass = 'calendar-cell';
        let cellText = `<strong style="display: block; text-align: center; font-size: 16px;">${day}</strong>`;
        const isHoliday = (dateObj.getDay() === 0 || dateObj.getDay() === 6) || holidays2025.includes(dateKey);
        if (isHoliday) {
          cellClass += ' holiday';
          cellText += '<br><div style="text-align: center; font-size: 14px; color: #1976d2;">Holiday</div>';
        }
        if (pl > 0) {
          cellClass += ' profit';
          cellText += `<br><span style="display: block; text-align: center;">â‚¹${formatCurrency(pl)}</span>`;
        } else if (pl < 0) {
          cellClass += ' loss';
          cellText += `<br><span style="display: block; text-align: center;">â‚¹${formatCurrency(pl)}</span>`;
        }
        calendarHtml += `<td class="${cellClass}" style="text-align: center; vertical-align: middle;">${cellText}</td>`;
        day++;
      }
    }
    calendarHtml += '</tr>';
    if (day > daysInMonth) break;
  }
  calendarHtml += '</tbody></table>';
  document.getElementById('calendarView').innerHTML = calendarHtml;
}
/* ---------- YEARLY TABLE VIEW RENDERING ---------- */
function renderYearlyTable() {
  let months = {};
  trades.forEach(t => {
    if (!t.date) return;
    const d = new Date(t.date);
    const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
    if (!months[key]) months[key] = { total: 0, count: 0 };
    months[key].total += Number(t.pl || 0);
    months[key].count += 1;
  });
  const yearKeys = Object.keys(months).map(k => k.split('-')[0]).filter((v, i, a) => a.indexOf(v) === i).sort();
  const tableBody = document.getElementById('yearlyTableBody');
  tableBody.innerHTML = '';
  if (yearKeys.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="13" class="empty">No data</td></tr>';
    return;
  }
  let currentYearTotal = 0;
  const currentYear = new Date().getFullYear();
  yearKeys.forEach(year => {
    const row = document.createElement('tr');
    const yearData = {};
    Object.keys(months).filter(k => k.startsWith(year)).forEach(k => {
      const month = parseInt(k.split('-')[1]) - 1;
      yearData[month] = months[k].total;
    });
    const cells = [`<td>${year}</td>`];
    for (let month = 0; month < 12; month++) {
      const pl = yearData[month] || 0;
      const cellClass = pl > 0 ? 'profit' : (pl < 0 ? 'loss' : '');
      cells.push(`<td class="${cellClass}">${pl !== 0 ? 'â‚¹' + formatCurrency(pl) : ''}</td>`);
      if (parseInt(year) === currentYear) {
        currentYearTotal += pl;
      }
    }
    row.innerHTML = cells.join('');
    tableBody.appendChild(row);
  });
  const yearlyPNLBtn = document.getElementById('yearlyPNLBtn');
  yearlyPNLBtn.textContent = `Yearly PNL: â‚¹${formatCurrency(currentYearTotal)}`;
  yearlyPNLBtn.style.background = currentYearTotal >= 0 ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)';
}
/* ---------- WEEKLY REPORT FUNCTIONS ---------- */
function renderWeeklyReport() {
  // Update current week/month/year to system date on render
  const now = new Date();
  currentWeekStart = computeCurrentMonday();
  currentWeeklyYear = now.getFullYear();
  currentWeeklyMonth = now.getMonth() + 1;
  document.getElementById('dateSelector').value = `${currentWeeklyMonth.toString().padStart(2, '0')}`;
  populateDateSelector();
  renderWeekView();
  populateWeekSelector(currentWeeklyYear, currentWeeklyMonth, currentWeekStart);
  updateWeekSummary(currentWeekStart);
  highlightWeekRow(currentWeekStart);
  renderYearView();
  setupWeeklyEventListeners();
  // Update title p with current month year
  const weeklyTitleP = document.querySelector('#weeklyArea .title-box p');
  const weeklyDate = new Date(currentWeeklyYear, currentWeeklyMonth - 1, 1);
  weeklyTitleP.textContent = weeklyDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
}
function populateDateSelector() {
  const select = document.getElementById('dateSelector');
  select.innerHTML = '';
  for (let y = 2023; y <= 2030; y++) {
    for (let m = 1; m <= 12; m++) {
      const date = new Date(y, m - 1, 1);
      const option = document.createElement('option');
      option.value = `${y}-${String(m).padStart(2, '0')}`;
      option.textContent = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      if (y === currentWeeklyYear && m === currentWeeklyMonth) option.selected = true;
      select.appendChild(option);
    }
  }
}
function createCell(date, month, data, mode, todayDate) {
  const cell = document.createElement('td');
  cell.className = 'calendar-cell';
  const dateStr = getLocalDateStr(date);
  const value = data[dateStr] || 0;
  const dayNum = date.getDate();
  let displayValue = '';
  if (mode === 'pnl') {
    displayValue = value !== 0 ? `â‚¹${formatCurrency(value)}` : '';
  } else {
    displayValue = value > 0 ? 'âœ“' : (value < 0 ? 'âœ—' : '');
  }
  const day = date.getDay();
  let holidayText = '';
  if (holidays2025.includes(dateStr) && (day >= 1 && day <= 5)) {
    holidayText = '<div style="font-size:14px; color:#1976d2; font-weight:bold;">Holiday</div>';
    cell.classList.add('holiday');
  }
  cell.innerHTML = `<div class="date" style="font-size:16px;">${dayNum}</div><div class="value" style="font-family:monospace;font-size:16px;">${displayValue}</div>${holidayText}`;
  if (value > 0) cell.classList.add('profit');
  else if (value < 0) cell.classList.add('loss');
  if (date.toDateString() === todayDate.toDateString()) cell.classList.add('today');
  if (date.getMonth() !== month) cell.classList.add('other-month');
  return cell;
}
function renderWeekView() {
  const tbody = document.getElementById('calendarBody');
  tbody.innerHTML = '';
  const year = currentWeeklyYear;
  const month = currentWeeklyMonth - 1;
  const firstDate = new Date(year, month, 1);
  const lastDate = new Date(year, month + 1, 0);
  const firstDayOfWeek = firstDate.getDay();
  let startMonday = new Date(firstDate);
  startMonday.setDate(1 - (firstDayOfWeek - 1));
  if (firstDayOfWeek === 0) startMonday.setDate(1 - 6); // If Sunday, previous previous
  for (let w = 0; w < 6; w++) {
    let monDate = new Date(startMonday);
    monDate.setDate(startMonday.getDate() + w * 7);
    if (monDate > lastDate) break;
    const row = document.createElement('tr');
    row.setAttribute('data-week-monday', getLocalDateStr(monDate));
    let weekTotal = 0;
    // Mon
    let monCell = createCell(monDate, month, weeklyData, viewMode, today);
    if (monDate.getMonth() === month && monDate.getDay() !== 0 && monDate.getDay() !== 6)
      weekTotal += weeklyData[getLocalDateStr(monDate)] || 0;
    row.appendChild(monCell);
    // Tue
    let tueDate = new Date(monDate);
    tueDate.setDate(monDate.getDate() + 1);
    let tueCell = createCell(tueDate, month, weeklyData, viewMode, today);
    if (tueDate.getMonth() === month && tueDate.getDay() !== 0 && tueDate.getDay() !== 6)
      weekTotal += weeklyData[getLocalDateStr(tueDate)] || 0;
    row.appendChild(tueCell);
    // Wed
    let wedDate = new Date(tueDate);
    wedDate.setDate(tueDate.getDate() + 1);
    let wedCell = createCell(wedDate, month, weeklyData, viewMode, today);
    if (wedDate.getMonth() === month && wedDate.getDay() !== 0 && wedDate.getDay() !== 6)
      weekTotal += weeklyData[getLocalDateStr(wedDate)] || 0;
    row.appendChild(wedCell);
    // Thu
    let thuDate = new Date(wedDate);
    thuDate.setDate(wedDate.getDate() + 1);
    let thuCell = createCell(thuDate, month, weeklyData, viewMode, today);
    if (thuDate.getMonth() === month && thuDate.getDay() !== 0 && thuDate.getDay() !== 6)
      weekTotal += weeklyData[getLocalDateStr(thuDate)] || 0;
    row.appendChild(thuCell);
    // Fri
    let friDate = new Date(thuDate);
    friDate.setDate(thuDate.getDate() + 1);
    let friCell = createCell(friDate, month, weeklyData, viewMode, today);
    if (friDate.getMonth() === month && friDate.getDay() !== 0 && friDate.getDay() !== 6)
      weekTotal += weeklyData[getLocalDateStr(friDate)] || 0;
    row.appendChild(friCell);
    // Weekend
    let satDate = new Date(friDate);
    satDate.setDate(friDate.getDate() + 1);
    let sunDate = new Date(satDate);
    sunDate.setDate(satDate.getDate() + 1);
    const weekendCell = document.createElement('td');
    weekendCell.className = 'calendar-cell weekend-col';
    let weekendText = '';
    let isOtherMonth = true;
    if (satDate.getMonth() === month || sunDate.getMonth() === month) {
      weekendText = `${satDate.getDate()}-${sunDate.getDate()}`;
      isOtherMonth = false;
    }
    weekendCell.innerHTML = `<div style="font-size:11px;">${weekendText || '&nbsp;'}</div>`;
    if (isOtherMonth) weekendCell.classList.add('other-month');
    row.appendChild(weekendCell);
    // Total
    const totalCell = document.createElement('td');
    totalCell.className = 'calendar-cell total-col';
    let totalText = '';
    if (viewMode === 'pnl') {
      totalText = weekTotal !== 0 ? `â‚¹${formatCurrency(weekTotal)}` : '';
    } else {
      totalText = weekTotal > 0 ? 'âœ“' : (weekTotal < 0 ? 'âœ—' : '');
    }
    totalCell.innerHTML = `<div style="font-size:12px;">Week ${w + 1}</div><div style="font-family:monospace;font-size:16px;">${totalText}</div>`;
    if (weekTotal > 0) totalCell.classList.add('profit');
    else if (weekTotal < 0) totalCell.classList.add('loss');
    row.appendChild(totalCell);
    tbody.appendChild(row);
  }
}
function renderYearView() {
  const container = document.getElementById('monthCardsYear');
  container.innerHTML = '';
  const year = currentWeeklyYear;
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  for (let m = 0; m < 12; m++) {
    const monthStr = `${year}-${String(m+1).padStart(2, '0')}`;
    let monthTotal = 0;
    let winCount = 0;
    let totalDays = 0;
    const daysInM = new Date(year, m + 1, 0).getDate();
    for (let d = 1; d <= daysInM; d++) {
      const dateStr = `${monthStr}-${String(d).padStart(2, '0')}`;
      const value = weeklyData[dateStr] || 0;
      if (value !== 0) {
        totalDays++;
        if (value > 0) winCount++;
        monthTotal += value;
      }
    }
    const winRate = totalDays > 0 ? ((winCount / totalDays) * 100).toFixed(1) + '%' : '0.0%';
    const card = document.createElement('div');
    let className = 'month-card';
    if (monthTotal > 0) {
      className += ' profit';
    } else if (monthTotal < 0) {
      className += ' loss';
    } else {
      className += ' neutral';
    }
    card.className = className;
    // Always show value with â‚¹
    let valHtml = '';
    if (monthTotal !== 0) {
      valHtml = `<div class="val">â‚¹${formatCurrency(monthTotal)}</div>`;
    }
    let winrateHtml = '';
    if (totalDays > 0) {
      winrateHtml = `<div class="winrate">${winRate}</div>`;
    }
    let html = `
      <h4>${monthNames[m]}</h4>
      ${valHtml}
      ${winrateHtml}
    `;
    card.innerHTML = html;
    card.onclick = () => {
      currentWeeklyMonth = m + 1;
      document.getElementById('dateSelector').value = `${year}-${String(m+1).padStart(2, '0')}`;
      switchView('week');
      renderWeekView();
      const weekStarts = getWeekStartDates(year, m + 1);
      if (weekStarts.length > 0) {
        currentWeekStart = weekStarts[0];
      }
      populateWeekSelector(year, m + 1, currentWeekStart);
      updateWeekSummary(currentWeekStart);
      highlightWeekRow(currentWeekStart);
    };
    container.appendChild(card);
  }
}
function switchView(mode) {
  document.getElementById('weekView').style.display = mode === 'week' ? 'block' : 'none';
  document.getElementById('yearView').style.display = mode === 'year' ? 'block' : 'none';
  document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  if (mode === 'week') {
    renderWeekView();
    updateWeekSummary(currentWeekStart);
    highlightWeekRow(currentWeekStart);
  } else {
    renderYearView();
  }
}
function setupWeeklyEventListeners() {
  if (window.weeklyListeners) return;
  document.getElementById('prevNav').onclick = () => {
    let [y, m] = document.getElementById('dateSelector').value.split('-').map(Number);
    m--;
    if (m < 1) { m = 12; y--; }
    currentWeeklyYear = y;
    currentWeeklyMonth = m;
    document.getElementById('dateSelector').value = `${y}-${String(m).padStart(2, '0')}`;
    renderWeekView();
    const weekStarts = getWeekStartDates(y, m);
    if (weekStarts.length > 0) {
      currentWeekStart = weekStarts[0];
    }
    populateWeekSelector(y, m, currentWeekStart);
    updateWeekSummary(currentWeekStart);
    highlightWeekRow(currentWeekStart);
  };
  document.getElementById('nextNav').onclick = () => {
    let [y, m] = document.getElementById('dateSelector').value.split('-').map(Number);
    m++;
    if (m > 12) { m = 1; y++; }
    currentWeeklyYear = y;
    currentWeeklyMonth = m;
    document.getElementById('dateSelector').value = `${y}-${String(m).padStart(2, '0')}`;
    renderWeekView();
    const weekStarts = getWeekStartDates(y, m);
    if (weekStarts.length > 0) {
      currentWeekStart = weekStarts[0];
    }
    populateWeekSelector(y, m, currentWeekStart);
    updateWeekSummary(currentWeekStart);
    highlightWeekRow(currentWeekStart);
  };
  document.getElementById('dateSelector').onchange = (e) => {
    const [y, m] = e.target.value.split('-').map(Number);
    currentWeeklyYear = y;
    currentWeeklyMonth = m;
    renderWeekView();
    const weekStarts = getWeekStartDates(y, m);
    if (weekStarts.length > 0) {
      currentWeekStart = weekStarts[0];
    }
    populateWeekSelector(y, m, currentWeekStart);
    updateWeekSummary(currentWeekStart);
    highlightWeekRow(currentWeekStart);
    // Update title p when month changes
    const weeklyTitleP = document.querySelector('#weeklyArea .title-box p');
    const weeklyDate = new Date(y, m - 1, 1);
    weeklyTitleP.textContent = weeklyDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  };
  document.getElementById('pnlToggle').onchange = () => {
    viewMode = 'pnl';
    renderWeekView();
  };
  document.getElementById('winToggle').onchange = () => {
    viewMode = 'win';
    renderWeekView();
  };
  window.weeklyListeners = true;
}
function clearWeeklyData() {
  if (confirm('Clear all weekly data?')) {
    weeklyData = {};
    localStorage.removeItem('weekly-report-data');
    renderWeekView();
    updateWeekSummary(currentWeekStart);
    renderYearView();
  }
}
// Toggle form visibility
function toggleCryptoForm() {
    try {
        const formContainer = document.getElementById('trade-form-container');
        const addBtn = document.getElementById('add-trade-btn');
        if (formContainer.style.display === 'none') {
            formContainer.style.display = 'block';
            addBtn.innerHTML = `
                <div class="flex items-center justify-between h-full">
                    <div>
                        <p class="text-white/90 text-sm">Hide Form</p>
                        <p class="text-2xl font-bold text-white">âŒ</p>
                    </div>
                    <span class="text-4xl">ðŸ“</span>
                </div>
            `;
            addBtn.classList.add('bg-red-500', 'hover:bg-red-600');
            addBtn.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-blue-500', 'hover:from-green-600', 'hover:to-blue-600');
            window.scrollTo({ top: formContainer.offsetTop - 100, behavior: 'smooth' });
        } else {
            formContainer.style.display = 'none';
            addBtn.innerHTML = `
                <div class="flex items-center justify-between h-full">
                    <div>
                        <p class="text-white/90 text-sm">Add New Trade</p>
                        <p class="text-2xl font-bold text-white">âž•</p>
                    </div>
                    <span class="text-4xl">ðŸ“</span>
                </div>
            `;
            addBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            addBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-blue-500', 'hover:from-green-600', 'hover:to-blue-600');
        }
        console.log('Form toggled');
    } catch (error) {
        console.error('Error toggling form:', error);
    }
}
// Load trades from localStorage
function loadTrades() {
    try {
        const saved = localStorage.getItem('cryptoTrades');
        if (saved) {
            cryptoTrades = JSON.parse(saved).filter(trade => trade && trade.market !== 'Stock Trading');
            console.log('Trades loaded:', cryptoTrades);
            saveCryptoTrades(); // Save filtered trades
            renderCryptoTrades();
            updateCryptoStats();
        } else {
            console.log('No trades found in localStorage');
            updateCryptoStats(); // Ensure stats are updated even with no trades
        }
    } catch (error) {
        console.error('Error loading trades:', error);
        updateCryptoStats(); // Fallback to update stats
    }
}
// Save trades to localStorage
function saveCryptoTrades() {
    try {
        localStorage.setItem('cryptoTrades', JSON.stringify(cryptoTrades));
        console.log('Trades saved:', cryptoTrades);
    } catch (error) {
        console.error('Error saving trades:', error);
    }
}
// Update instruments dropdown
function updateCryptoInstruments() {
    try {
        const market = document.getElementById('market').value;
        const instrumentSelect = document.getElementById('instrument');
        const instruments = cryptoInstrumentData[market].instruments;
        instrumentSelect.innerHTML = '';
        instruments.forEach(inst => {
            const option = document.createElement('option');
            option.value = inst;
            option.textContent = inst;
            instrumentSelect.appendChild(option);
        });
        updateCryptoLotSize();
        toggleCryptoFields();
        console.log('Instruments updated for market:', market);
    } catch (error) {
        console.error('Error updating instruments:', error);
    }
}
// Update lot size
function updateCryptoLotSize() {
    try {
        const market = document.getElementById('market').value;
        const instrument = document.getElementById('instrument').value;
        const lotSize = cryptoInstrumentData[market].lotSizes[instrument];
        document.getElementById('lotsize').value = lotSize;
        // Update pair for crypto
        if (market === 'Crypto Trading') {
            document.getElementById('pair').value = instrument + '/USDT';
        }
        console.log('Lot size updated:', lotSize);
    } catch (error) {
        console.error('Error updating lot size:', error);
    }
}
// Toggle crypto-specific fields
function toggleCryptoFields() {
    try {
        const market = document.getElementById('market').value;
        const isCrypto = market === 'Crypto Trading';
        document.getElementById('exchange-field').style.display = isCrypto ? 'block' : 'none';
        document.getElementById('pair-field').style.display = isCrypto ? 'block' : 'none';
        document.getElementById('subtype-field').style.display = isCrypto ? 'block' : 'none';
        document.getElementById('leverage-field').style.display = isCrypto ? 'block' : 'none';
        document.getElementById('fee-field').style.display = isCrypto ? 'block' : 'none';
        document.getElementById('wallet-field').style.display = isCrypto ? 'block' : 'none';
        toggleCryptoFundingField();
        console.log('Crypto fields toggled:', isCrypto);
    } catch (error) {
        console.error('Error toggling crypto fields:', error);
    }
}
// Toggle funding rate field
function toggleCryptoFundingField() {
    try {
        const market = document.getElementById('market').value;
        const subtype = document.getElementById('subtype').value;
        const showFunding = market === 'Crypto Trading' && subtype === 'Futures';
        document.getElementById('funding-field').style.display = showFunding ? 'block' : 'none';
        console.log('Funding field toggled:', showFunding);
    } catch (error) {
        console.error('Error toggling funding field:', error);
    }
}
// Calculate P&L
function calculateCryptoPL(trade) {
    try {
        if (!trade.exit) return 0;
        const entryPrice = parseFloat(trade.entry);
        const exitPrice = parseFloat(trade.exit);
        const qty = parseFloat(trade.qty);
        const lotsize = parseFloat(trade.lotsize);
        const leverage = parseFloat(trade.leverage || 1);
        const feePercent = parseFloat(trade.fee || 0);
        let diff = trade.type === 'Buy' ? (exitPrice - entryPrice) : (entryPrice - exitPrice);
        let pl = diff * qty * lotsize * leverage;
        const totalValue = entryPrice * qty * lotsize;
        const totalFees = (totalValue * feePercent / 100) * 2;
        pl = pl - totalFees;
        console.log('P&L calculated for trade:', trade.id, pl);
        return pl;
    } catch (error) {
        console.error('Error calculating P&L:', error);
        return 0;
    }
}
// Calculate holding period
function calculateCryptoHoldingPeriod(trade) {
    try {
        if (!trade.exitTime || !trade.entryTime) return '-';
        const entry = new Date(trade.entryTime);
        const exit = new Date(trade.exitTime);
        const diffMs = exit - entry;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        if (diffDays > 0) {
            return diffDays + 'd ' + diffHours + 'h';
        }
        return diffHours + 'h';
    } catch (error) {
        console.error('Error calculating holding period:', error);
        return '-';
    }
}
// Render trades table
function renderCryptoTrades() {
    try {
        const tbody = document.getElementById('trades-table');
        if (cryptoTrades.length === 0) {
            tbody.innerHTML = '<tr><td colspan="15" class="px-4 py-8 text-center text-gray-500 border-2 border-gray-300">No trades yet. Add your first trade above!</td></tr>';
            console.log('No trades to render');
            return;
        }
        tbody.innerHTML = cryptoTrades.map(trade => `
            <tr class="border-b hover:bg-gray-50 transition">
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${formatDate(trade.date) || '-'}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.market}</td>
                <td class="px-4 py-3 text-sm font-medium border-2 border-gray-300">${trade.instrument}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.exchange || '-'}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.pair || '-'}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">
                    <span class="px-2 py-1 rounded text-xs font-semibold ${trade.type === 'Buy' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                        ${trade.type}
                    </span>
                </td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.qty}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">â‚¹${formatCurrency(trade.entry)}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.exit ? 'â‚¹' + formatCurrency(trade.exit) : '-'}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.leverage}x</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.fee}%</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${trade.followedPlan || '-'}</td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">${calculateCryptoHoldingPeriod(trade)}</td>
                <td class="px-4 py-3 text-sm font-semibold border-2 border-gray-300">
                    <span class="${trade.pl >= 0 ? 'text-green-600' : 'text-red-600'}">
                        â‚¹${formatCurrency(trade.pl)}
                    </span>
                </td>
                <td class="px-4 py-3 text-sm border-2 border-gray-300">
                    <div class="flex gap-2">
                        <button onclick="editCryptoTrade(${trade.id})" class="text-blue-600 hover:text-blue-800">âœï¸</button>
                        <button onclick="deleteCryptoTrade(${trade.id})" class="text-red-600 hover:text-red-800">ðŸ—‘ï¸</button>
                    </div>
                </td>
            </tr>
        `).join('');
        console.log('Trades table rendered');
    } catch (error) {
        console.error('Error rendering trades:', error);
    }
}
// Update statistics
function updateCryptoStats() {
    try {
        const stats = {
            totalTrades: cryptoTrades.length,
            closedTrades: cryptoTrades.filter(t => t.exit).length,
            openTrades: cryptoTrades.filter(t => !t.exit).length,
            totalPL: cryptoTrades.reduce((sum, t) => sum + (t.pl || 0), 0),
            winningTrades: cryptoTrades.filter(t => t.pl > 0).length,
            losingTrades: cryptoTrades.filter(t => t.pl < 0).length,
            totalFees: cryptoTrades.reduce((sum, t) => {
                const entryValue = parseFloat(t.entry || 0) * parseFloat(t.qty || 0) * parseFloat(t.lotsize || 0);
                const feePercent = parseFloat(t.fee || 0);
                return sum + (entryValue * feePercent / 100) * (t.exit ? 2 : 1);
            }, 0)
        };
        stats.winRate = stats.closedTrades > 0 ? (stats.winningTrades / stats.closedTrades) * 100 : 0;
        stats.avgPL = stats.closedTrades > 0 ? stats.totalPL / stats.closedTrades : 0;
        const dashboard = document.getElementById('crypto-stats-dashboard');
        if (!dashboard) {
            console.error('Stats dashboard element not found');
            return;
        }
        dashboard.innerHTML = `
            <div class="bg-white rounded-xl p-4 shadow-lg border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Total Trades</p>
                        <p class="text-2xl font-bold text-gray-800">${stats.totalTrades}</p>
                        <p class="text-xs text-gray-500 mt-1">Open: ${stats.openTrades} | Closed: ${stats.closedTrades}</p>
                    </div>
                    <span class="text-3xl">ðŸ“Š</span>
                </div>
            </div>
            <div class="rounded-xl p-4 shadow-lg border-l-4 ${stats.totalPL >= 0 ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'}">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Total P&L</p>
                        <p class="text-2xl font-bold ${stats.totalPL >= 0 ? 'text-green-600' : 'text-red-600'}">â‚¹${formatCurrency(stats.totalPL)}</p>
                        <p class="text-xs text-gray-500 mt-1">Fees: â‚¹${formatCurrency(stats.totalFees)}</p>
                    </div>
                    <span class="text-3xl">${stats.totalPL >= 0 ? 'ðŸ“ˆ' : 'ðŸ“‰'}</span>
                </div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-lg border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Win Rate</p>
                        <p class="text-2xl font-bold text-purple-600">${stats.winRate.toFixed(1)}%</p>
                        <p class="text-xs text-gray-500 mt-1">Based on closed trades</p>
                    </div>
                    <span class="text-3xl">ðŸŽ¯</span>
                </div>
            </div>
            <div class="bg-green-50 rounded-xl p-4 shadow-lg border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Profit Trades</p>
                        <p class="text-2xl font-bold text-green-600">${stats.winningTrades}</p>
                        <p class="text-xs text-gray-500 mt-1">Trades with positive P&L</p>
                    </div>
                    <span class="text-3xl">ðŸ†</span>
                </div>
            </div>
            <div class="bg-red-50 rounded-xl p-4 shadow-lg border-l-4 border-red-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Loss Trades</p>
                        <p class="text-2xl font-bold text-red-600">${stats.losingTrades}</p>
                        <p class="text-xs text-gray-500 mt-1">Trades with negative P&L</p>
                    </div>
                    <span class="text-3xl">ðŸ“‰</span>
                </div>
            </div>
            <div class="bg-yellow-50 rounded-xl p-4 shadow-lg border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-xs">Avg P&L</p>
                        <p class="text-2xl font-bold text-yellow-600">â‚¹${formatCurrency(stats.avgPL)}</p>
                        <p class="text-xs text-gray-500 mt-1">Per closed trade</p>
                    </div>
                    <span class="text-3xl">ðŸ’°</span>
                </div>
            </div>
        `;
        console.log('Stats dashboard updated:', stats);
    } catch (error) {
        console.error('Error updating stats:', error);
        const dashboard = document.getElementById('crypto-stats-dashboard');
        if (dashboard) {
            dashboard.innerHTML = '<div class="text-red-600 p-8 col-span-full">Error loading statistics. Please check the console for details.</div>';
        }
    }
}
// Form submit
function submitCryptoForm(e) {
    try {
        e.preventDefault();
        const date = document.getElementById('date').value;
        const entryTime = document.getElementById('entryTime').value || '00:00:00';
        const exitTime = document.getElementById('exitTime').value || '00:00:00';
        const entryDatetime = date + 'T' + entryTime;
        const exitDatetime = document.getElementById('exit').value ? date + 'T' + exitTime : null;
        const trade = {
            id: editingCryptoId || Date.now(),
            date:date,
            market: document.getElementById('market').value,
            instrument: document.getElementById('instrument').value,
            exchange: document.getElementById('exchange').value,
            pair: document.getElementById('pair').value,
            subtype: document.getElementById('subtype').value,
            type: document.getElementById('type').value,
            qty: document.getElementById('qty').value,
            lotsize: document.getElementById('lotsize').value,
            entry: document.getElementById('entry').value,
            stopLoss: document.getElementById('stopLoss').value,
            exit: document.getElementById('exit').value,
            leverage: document.getElementById('leverage').value,
            fee: document.getElementById('fee').value,
            fundingRate: document.getElementById('fundingRate').value,
            wallet: document.getElementById('wallet').value,
            followedPlan: document.getElementById('followedPlan').value,
            marketCondition: document.getElementById('marketCondition').value,
            confidenceLevel: document.getElementById('confidenceLevel').value,
            timeFrame: document.getElementById('timeFrame').value,
            reason: document.getElementById('reason').value,
            mistakes: document.getElementById('mistakes').value,
            notes: document.getElementById('notes').value,
            entryTime: entryDatetime,
            exitTime: exitDatetime,
            pl: 0
        };
        trade.pl = calculateCryptoPL(trade);
        if (editingCryptoId) {
            cryptoTrades = cryptoTrades.map(t => t.id === editingCryptoId ? trade : t);
            editingCryptoId = null;
        } else {
            cryptoTrades.push(trade);
        }
        saveCryptoTrades();
        renderCryptoTrades();
        updateCryptoStats();
        resetCryptoForm();
        console.log('Trade submitted:', trade);
    } catch (error) {
        console.error('Error submitting form:', error);
    }
}
// Edit trade
function editCryptoTrade(id) {
    try {
        const trade = cryptoTrades.find(t => t.id === id);
        if (!trade) {
            console.error('Trade not found:', id);
            return;
        }
        editingCryptoId = id;
        const entryDateTime = trade.entryTime ? new Date(trade.entryTime) : null;
        const exitDateTime = trade.exitTime ? new Date(trade.exitTime) : null;
        document.getElementById('date').value = entryDateTime ? entryDateTime.toISOString().split('T')[0] : '';
        document.getElementById('entryTime').value = entryDateTime ? entryDateTime.toISOString().split('T')[1].substring(0, 5) : '';
        document.getElementById('exitTime').value = exitDateTime ? exitDateTime.toISOString().split('T')[1].substring(0, 5) : '';
        document.getElementById('market').value = trade.market;
        updateCryptoInstruments();
        document.getElementById('instrument').value = trade.instrument;
        document.getElementById('exchange').value = trade.exchange || '';
        document.getElementById('pair').value = trade.pair || '';
        document.getElementById('subtype').value = trade.subtype || '';
        document.getElementById('type').value = trade.type;
        document.getElementById('qty').value = trade.qty || '';
        document.getElementById('lotsize').value = trade.lotsize || '';
        document.getElementById('entry').value = trade.entry || '';
        document.getElementById('stopLoss').value = trade.stopLoss || '';
        document.getElementById('exit').value = trade.exit || '';
        document.getElementById('leverage').value = trade.leverage || '1';
        document.getElementById('fee').value = trade.fee || '0.1';
        document.getElementById('fundingRate').value = trade.fundingRate || '0';
        document.getElementById('wallet').value = trade.wallet || '';
        document.getElementById('followedPlan').value = trade.followedPlan || 'No';
        document.getElementById('marketCondition').value = trade.marketCondition || 'Bullish';
        document.getElementById('confidenceLevel').value = trade.confidenceLevel || 'Medium';
        document.getElementById('timeFrame').value = trade.timeFrame || 'Intraday';
        document.getElementById('reason').value = trade.reason || '';
        document.getElementById('mistakes').value = trade.mistakes || '';
        document.getElementById('notes').value = trade.notes || '';
        document.getElementById('form-title').textContent = 'Edit Trade';
        document.getElementById('submit-btn').innerHTML = 'ðŸ’¾ Update Trade';
        document.getElementById('cancel-btn').style.display = 'block';
        // Show form if hidden
        const formContainer = document.getElementById('trade-form-container');
        if (formContainer.style.display === 'none') {
            toggleCryptoForm();
        }
        window.scrollTo(0, 0);
        console.log('Editing trade:', id);
    } catch (error) {
        console.error('Error editing trade:', error);
    }
}
// Delete trade
function deleteCryptoTrade(id) {
    try {
        if (confirm('Delete this trade?')) {
            cryptoTrades = cryptoTrades.filter(t => t.id !== id);
            saveCryptoTrades();
            renderCryptoTrades();
            updateCryptoStats();
            console.log('Trade deleted:', id);
        }
    } catch (error) {
        console.error('Error deleting trade:', error);
    }
}
// Reset form
function resetCryptoForm() {
    try {
        document.getElementById('trade-form').reset();
        document.getElementById('marketCondition').value = 'Bullish';
        document.getElementById('confidenceLevel').value = 'Medium';
        document.getElementById('timeFrame').value = 'Intraday';
        editingCryptoId = null;
        document.getElementById('form-title').textContent = 'Add New Trade';
        document.getElementById('submit-btn').innerHTML = 'ðŸ’¾ Save Trade';
        document.getElementById('submit-btn').innerHTML = 'ðŸ’¾ Save Trade';
        document.getElementById('cancel-btn').style.display = 'none';
        updateCryptoInstruments();
        console.log('Form reset');
    } catch (error) {
        console.error('Error resetting form:', error);
    }
}
// Clear all
function clearCryptoAll() {
    try {
        if (confirm('Delete all trades permanently?')) {
            cryptoTrades = [];
            localStorage.removeItem('cryptoTrades');
            renderCryptoTrades();
            updateCryptoStats();
            console.log('All trades cleared');
        }
    } catch (error) {
        console.error('Error clearing all trades:', error);
    }
}
// Initialize
function initialize() {
    try {
        console.log('Initializing application');
        // Add event listeners
        document.getElementById('trade-form').addEventListener('submit', submitCryptoForm);
        document.getElementById('clear-all').addEventListener('click', clearCryptoAll);
        document.getElementById('cancel-btn').addEventListener('click', resetCryptoForm);
        document.getElementById('market').addEventListener('change', updateCryptoInstruments);
        document.getElementById('instrument').addEventListener('change', updateCryptoLotSize);
        document.getElementById('subtype').addEventListener('change', toggleCryptoFundingField);
        // Initial setup
        updateCryptoInstruments();
        loadTrades();
        updateCryptoStats(); // Ensure stats are updated on page load
        console.log('Initialization complete');
    } catch (error) {
        console.error('Error during initialization:', error);
        const dashboard = document.getElementById('crypto-stats-dashboard');
        if (dashboard) {
            dashboard.innerHTML = '<div class="text-red-600 p-8 col-span-full">Error initializing application. Please check the console for details.</div>';
        }
    }
}
/* ---------- MISTAKES MODAL FUNCTIONS ---------- */
function openMistakesModal() {
  document.getElementById('mistakesModal').style.display = 'flex';
  // FIXED: Removed auto-scroll to bottom to prevent unwanted scrolling/jumping
  // Pre-populate checkboxes if textarea has values
  const currentMistakes = document.getElementById('mistakes').value.split('\n').filter(m => m.trim());
  document.querySelectorAll('#mistakesForm input[name="mistakes"]').forEach(cb => {
    cb.checked = currentMistakes.includes(cb.value);
  });
  // FIXED: Focus on the first checkbox for better UX without better scrolling
  document.querySelector('#mistakesForm input[name="mistakes"]').focus();
}
function closeMistakesModal() {
  document.getElementById('mistakesModal').style.display = 'none';
}
document.getElementById('mistakesForm').onsubmit = function(e) {
  e.preventDefault();
  const selected = Array.from(document.querySelectorAll('#mistakesForm input[name="mistakes"]:checked'))
                        .map(cb => cb.value);
  document.getElementById('mistakes').value = selected.join('\n');
  // FIXED: Ensure modal closes reliably and focus returns to form
  closeMistakesModal();
  document.getElementById('mistakes').focus();
  // FIXED: Scroll back to the form area smoothly
  document.getElementById('form').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
};
// Close modal on outside click
window.onclick = function(event) {
  const modal = document.getElementById('mistakesModal');
  if (event.target === modal) {
    closeMistakesModal();
  }
};
function loadData() {
  const s = localStorage.getItem('tradingData');
  if (s) trades = JSON.parse(s) || [];
  trades.sort((a,b) => b.date.localeCompare(a.date));
  updateWeeklyDataFromTrades();
  notificationsEnabled = localStorage.getItem('notificationsEnabled') === 'true';
  if (notificationsEnabled) {
    if (Notification.permission === 'default') {
      Notification.requestPermission();
    }
  }
}
function saveData() {
  localStorage.setItem('tradingData', JSON.stringify(trades));
}
function toggleNotifications() {
  if (notificationsEnabled) {
    notificationsEnabled = false;
    localStorage.setItem('notificationsEnabled', 'false');
    document.getElementById('notificationToggle').innerHTML = '<span class="icon">ðŸ””</span> Notifications (Off)';
  } else {
    Notification.requestPermission().then(permission => {
      if (permission === 'granted') {
        notificationsEnabled = true;
        localStorage.setItem('notificationsEnabled', 'true');
        document.getElementById('notificationToggle').innerHTML = '<span class="icon">ðŸ›Žï¸</span> Notifications (On)';
        sendNotification('Notifications Enabled', 'You will now receive trade updates!');
      } else {
        alert('Notifications require permission. Please enable in browser settings.');
      }
    });
  }
}
function sendNotification(title, body) {
  if (notificationsEnabled && Notification.permission === 'granted') {
    new Notification(title, { body, icon: '/icon.png' }); // Assume icon
  }
}
// Weekly summary notification (example: on load if enabled)
if (notificationsEnabled && trades.length > 0) {
  const currentMon = computeCurrentMonday();
  const weeklySummary = getWeekLabelAndSummary(currentMon);
  sendNotification('Weekly Summary', `Total P&L: â‚¹${weeklySummary.total.toFixed(2)}, Trades: ${weeklySummary.count}`);
}
/* ---------- SAFEGUARD: remove duplicate action buttons (if any) ---------- */
function dedupeActionButtons() {
  const bar = document.getElementById('actionBar');
  if (!bar) return;
  const seen = new Set();
  const children = Array.from(bar.children);
  children.forEach(ch => {
    const key = (ch.textContent || '').trim().replace(/\s+/g, ' ').toLowerCase();
    if (seen.has(key)) ch.remove(); else seen.add(key);
  });
}
// VISUALIZATIONS
function showVisualizations() {
  ['monthlyArea', 'yearlyArea', 'weeklyArea', 'cryptoArea'].forEach(id => document.getElementById(id).style.display = 'none');
  document.getElementById('visualizationsModal').style.display = 'block';
  const now = new Date();
  document.getElementById('chartMonth').value = now.getMonth();
  renderPLChart();
  setupChartNavListeners();
}
let plChart, winRateChart, strategyChart;
function setupChartNavListeners() {
  if (window.chartNavListeners) return;
  document.getElementById('prevMonthChart').onclick = () => {
    let month = parseInt(document.getElementById('chartMonth').value);
    month--;
    if (month < 0) {
      month = 11;
      let year = new Date().getFullYear();
      year--;
      renderPLChart(year);
    } else {
      document.getElementById('chartMonth').value = month;
      renderPLChart();
    }
  };
  document.getElementById('nextMonthChart').onclick = () => {
    let month = parseInt(document.getElementById('chartMonth').value);
    month++;
    if (month > 11) {
      month = 0;
      let year = new Date().getFullYear();
      year++;
      renderPLChart(year);
    } else {
      document.getElementById('chartMonth').value = month;
      renderPLChart();
    }
  };
  document.getElementById('chartMonth').onchange = renderPLChart;
  window.chartNavListeners = true;
}
function renderPLChart(selectedYear = new Date().getFullYear()) {
  const ctx = document.getElementById('plChart').getContext('2d');
  if (plChart) plChart.destroy();
  const selectedMonth = parseInt(document.getElementById('chartMonth').value);
  const monthStr = String(selectedMonth + 1).padStart(2, '0');
  const filterPrefix = `${selectedYear}-${monthStr}`;
  const dailyProfit = {};
  const dailyLoss = {};
  trades.forEach(t => {
    if (t.date && t.date.startsWith(filterPrefix)) {
      const dayStr = t.date;
      if (!dailyProfit[dayStr]) dailyProfit[dayStr] = 0;
      if (!dailyLoss[dayStr]) dailyLoss[dayStr] = 0;
      const pl = t.pl || 0;
      if (pl >= 0) {
        dailyProfit[dayStr] += pl;
      } else {
        dailyLoss[dayStr] += Math.abs(pl);
      }
    }
  });
  const daysInMonth = new Date(selectedYear, selectedMonth + 1, 0).getDate();
  const labels = [];
  const profitData = [];
  const lossData = [];
  for (let day = 1; day <= daysInMonth; day++) {
    labels.push(day);
    const dayStr = `${filterPrefix}-${String(day).padStart(2, '0')}`;
    profitData.push(dailyProfit[dayStr] || 0);
    lossData.push(-(dailyLoss[dayStr] || 0));
  }
  plChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Profits',
          data: profitData,
          backgroundColor: '#16a34a'
        },
        {
          label: 'Losses',
          data: lossData,
          backgroundColor: '#dc2626'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      aspectRatio: 2,
      scales: {
        x: {
          title: {
            display: true,
            text: 'Days'
          }
        },
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'P&L (â‚¹)'
          },
          ticks: {
            callback: function(value) {
              return 'â‚¹' + value.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            }
          }
        }
      },
      plugins: {
        legend: {
          display: true
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              if (context.parsed.y !== null) {
                label += 'â‚¹' + Math.abs(context.parsed.y).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
              }
              return label;
            }
          }
        }
      }
    }
  });
  renderWinRateChart(labels, profitData, lossData);
  renderStrategyChart();
  const monthlyProfitVal = profitData.reduce((sum, v) => sum + v, 0);
  const monthlyLossVal = Math.abs(lossData.reduce((sum, v) => sum + v, 0));
  const net = monthlyProfitVal - monthlyLossVal;
  document.getElementById('monthlyProfit').textContent = 'â‚¹' + formatCurrency(monthlyProfitVal);
  document.getElementById('monthlyLoss').textContent = 'â‚¹' + formatCurrency(monthlyLossVal);
  document.getElementById('netAmount').textContent = 'â‚¹' + formatCurrency(net);
  document.getElementById('netAmount').className = 'value ' + (net >= 0 ? 'profit' : 'loss');
  renderRecentEntries();
}
function renderWinRateChart(labels, profitData, lossData) {
  const ctx = document.getElementById('winRateChart').getContext('2d');
  if (winRateChart) winRateChart.destroy();
  const winRates = labels.map((label, i) => {
    const total = profitData[i] + Math.abs(lossData[i]);
    return total > 0 ? (profitData[i] / total * 100).toFixed(1) : 0;
  });
  winRateChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Win Rate (%)',
        data: winRates,
        borderColor: '#16a34a',
        backgroundColor: 'rgba(22, 163, 74, 0.2)',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: { display: true, text: 'Win Rate (%)' }
        }
      }
    }
  });
}
function renderStrategyChart() {
  const ctx = document.getElementById('strategyChart').getContext('2d');
  if (strategyChart) strategyChart.destroy();
  const strategyPL = {};
  trades.forEach(t => {
    const strat = t.strategy || 'Other';
    if (!strategyPL[strat]) strategyPL[strat] = 0;
    strategyPL[strat] += t.pl || 0;
  });
  const labels = Object.keys(strategyPL);
  const data = Object.values(strategyPL);
  strategyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Total P&L by Strategy',
        data: data,
        backgroundColor: labels.map(() => `hsl(${Math.random() * 360}, 70%, 50%)`)
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'P&L (â‚¹)' }
        }
      }
    }
  });
}
function renderRecentEntries() {
  const div = document.getElementById('recentEntries');
  div.innerHTML = '';
  const selectedMonth = parseInt(document.getElementById('chartMonth').value);
  const selectedYear = new Date().getFullYear();
  const monthStr = String(selectedMonth + 1).padStart(2, '0');
  const filterPrefix = `${selectedYear}-${monthStr}`;
  const dailyPL = {};
  trades.forEach(t => {
    if (t.date.startsWith(filterPrefix)) {
      if (!dailyPL[t.date]) dailyPL[t.date] = {profit: 0, loss: 0};
      const pl = t.pl || 0;
      if (pl >= 0) {
        dailyPL[t.date].profit += pl;
      } else {
        dailyPL[t.date].loss += Math.abs(pl);
      }
    }
  });
  const sortedDays = Object.keys(dailyPL).sort((a, b) => b.localeCompare(a));
  sortedDays.forEach(date => {
    const entry = dailyPL[date];
    const dayDiv = document.createElement('div');
    dayDiv.style = 'background:var(--input-bg); padding:10px; border-radius:8px; margin-bottom:10px;';
    dayDiv.innerHTML = `
      <p style="font-weight:bold;">${formatDate(date)}</p>
      <p style="color:var(--profit-color);">+â‚¹${formatCurrency(entry.profit)}</p>
      <p style="color:var(--loss-color);">-â‚¹${formatCurrency(entry.loss)}</p>
    `;
    div.appendChild(dayDiv);
  });
  if (sortedDays.length === 0) {
    div.innerHTML = '<p style="text-align:center; color:var(--text-muted);">No entries</p>';
  }
}
function showSearchFilter() {
  document.getElementById('searchFilterModal').style.display = 'block';
  document.getElementById('filteredTrades').innerHTML = '';
}
function applyFilter() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const marketFilter = document.getElementById('filterMarket').value;
  const filtered = trades.filter(t => {
    let match = true;
    if (query) {
      match = match && (t.instrument.toLowerCase().includes(query) || (t.notes || '').toLowerCase().includes(query));
    }
    if (marketFilter) {
      match = match && t.markettype === marketFilter;
    }
    return match;
  });
  const filteredDiv = document.getElementById('filteredTrades');
  filteredDiv.innerHTML = '<h3>Filtered Trades (' + filtered.length + ')</h3>';
  if (filtered.length === 0) {
    filteredDiv.innerHTML += '<p>No matching trades found.</p>';
    return;
  }
  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';
  table.innerHTML = '<thead><tr><th style="border:1px solid #ccc;padding:8px;">Date</th><th style="border:1px solid #ccc;padding:8px;">Instrument</th><th style="border:1px solid #ccc;padding:8px;">P&L</th></tr></thead><tbody>';
  filtered.forEach(t => {
    table.innerHTML += `<tr><td style="border:1px solid #ccc;padding:8px;">${formatDate(t.date)}</td><td style="border:1px solid #ccc;padding:8px;">${t.instrument}</td><td style="border:1px solid #ccc;padding:8px; color:${t.pl >= 0 ? 'var(--profit-color)' : 'var(--loss-color)'}">â‚¹${formatCurrency(t.pl)}</td></tr>`;
  });
  table.innerHTML += '</tbody>';
  filteredDiv.appendChild(table);
}
function showRiskCalculator() {
  document.getElementById('riskCalculatorModal').style.display = 'block';
  document.getElementById('riskResult').innerHTML = '';
}
function calculateRisk() {
  const balance = Number(document.getElementById('accountBalanceModal').value) || 0;
  const riskPct = Number(document.getElementById('riskPercentModal').value) || 1;
  const entry = Number(document.getElementById('calcEntry').value) || 0;
  const sl = Number(document.getElementById('calcSL').value) || 0;
  if (balance === 0 || entry === 0 || sl === 0) {
    document.getElementById('riskResult').innerHTML = 'Please fill all fields.';
    return;
  }
  const riskAmount = balance * (riskPct / 100);
  const riskPerShare = Math.abs(entry - sl);
  const positionSize = riskPerShare > 0 ? Math.floor(riskAmount / riskPerShare) : 0;
  document.getElementById('riskResult').innerHTML = `
    <p>Risk Amount: â‚¹${formatCurrency(riskAmount)}</p>
    <p>Risk Per Share: â‚¹${formatCurrency(riskPerShare)}</p>
    <p>Recommended Position Size: ${positionSize} shares/lots</p>
  `;
}
function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}
function dedupeActionButtons() {
  const bar = document.getElementById('actionBar');
  if (!bar) return;
  const seen = new Set();
  const children = Array.from(bar.children);
  children.forEach(ch => {
    const key = (ch.textContent || '').trim().replace(/\s+/g, ' ').toLowerCase();
    if (seen.has(key)) ch.remove(); else seen.add(key);
  });
}
function showJournal() {
  document.getElementById('journalArea').style.display = 'block';
  ['monthlyArea', 'yearlyArea', 'weeklyArea', 'cryptoArea'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
  closeModal('visualizationsModal');
  closeModal('dailyPNLModal');
  closeModal('searchFilterModal');
  closeModal('riskCalculatorModal');
  closeModal('totalCapitalModal');
  closeModal('emailExportModal');
  closeModal('goldCalculatorModal');
  closeModal('btcCalculatorModal');
  closeModal('niftySetupModal');
  closeModal('rangeCalculatorModal');
  closeMistakesModal();
  document.getElementById('toggleDailyBtn').innerHTML = '<span class="icon">ðŸ“†</span> Daily Report';
  document.getElementById('toggleWeeklyBtn').innerHTML = '<span class="icon">ðŸ“…</span> Weekly Report';
  document.getElementById('toggleMonthlyBtn').innerHTML = '<span class="icon">ðŸ“Š</span> Monthly Report';
  document.getElementById('toggleYearlyBtn').innerHTML = '<span class="icon">ðŸ“ˆ</span> Yearly Report';
  document.getElementById('toggleCryptoBtn').innerHTML = '<span class="icon">â‚¿</span> Crypto Journal';
}
function showDailyPNL() {
  ['monthlyArea', 'yearlyArea', 'weeklyArea', 'cryptoArea'].forEach(id => document.getElementById(id).style.display = 'none');
  document.getElementById('dailyPNLModal').style.display = 'block';
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('dailyDate').value = today;
  updateDailyPNL();
}
function showTotalCapital() {
  document.getElementById('totalCapitalModal').style.display = 'block';
  const initial = Number(localStorage.getItem('initialCapital')) || 0;
  document.getElementById('initialCapital').value = formatCurrency(initial);
  updateTotalCapitalTable();
}
function updateTotalCapitalTable() {
  const initialFormatted = document.getElementById('initialCapital').value;
  const initial = parseInt(initialFormatted.replace(/,/g, '')) || 0;
  localStorage.setItem('initialCapital', initial);
  const dates = [...new Set(trades.map(t => t.date))].sort();
  const tbody = document.getElementById('capitalTable').querySelector('tbody');
  tbody.innerHTML = '';
  let capital = initial;
  dates.forEach(date => {
    const dayTrades = trades.filter(t => t.date === date);
    const count = dayTrades.length;
    const charges = dayTrades.reduce((sum, t) => sum + (t.charges || 0), 0);
    const pl = dayTrades.reduce((sum, t) => sum + (t.pl || 0), 0);
    const opening = capital;
    const closing = opening + pl - charges;
    capital = closing;
    const row = `<tr>
      <td>${formatDate(date)}</td>
      <td>â‚¹${formatCurrency(opening)}</td>
      <td>â‚¹${formatCurrency(closing)}</td>
      <td>${count}</td>
      <td>â‚¹${formatCurrency(charges)}</td>
      <td class="${pl >= 0 ? 'profit' : 'loss'}">â‚¹${formatCurrency(pl)}</td>
      <td>â‚¹${formatCurrency(closing)}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
  if (dates.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7">No trades yet</td></tr>';
  }
  document.getElementById('totalCapitalButton').innerHTML = `<button style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 18px;">Total Capital: â‚¹${formatCurrency(capital)}</button>`;
  updatePresentCapital();
}
function updatePresentCapital() {
  const initial = Number(localStorage.getItem('initialCapital')) || 0;
  const tpl = trades.reduce((a, t) => a + (t.pl || 0), 0);
  const tcharges = trades.reduce((a, t) => a + (t.charges || 0), 0);
  const present = initial + tpl - tcharges;
  document.getElementById('presentCapitalBtn').textContent = `Present Capital: â‚¹${formatCurrency(present)}`;
}
// Auto-format initialCapital input
const initialCapitalInput = document.getElementById('initialCapital');
initialCapitalInput.addEventListener('input', function(e) {
  let cursorPos = e.target.selectionStart;
  let oldValue = e.target.value;
  let rawValue = oldValue.replace(/\D/g, '');
  let newValue = rawValue ? parseInt(rawValue).toLocaleString('en-IN') : '';
  e.target.value = newValue;
  // Adjust cursor position
  let diff = newValue.length - oldValue.length;
  let newCursorPos = cursorPos + diff;
  if (newCursorPos >= 0) {
    setTimeout(() => e.target.setSelectionRange(newCursorPos, newCursorPos), 0);
  }
  updateTotalCapitalTable();
});
function updateBackButtonInNav(areaId) {
  const area = document.getElementById(areaId);
  if (!area) return;
  const buttons = area.querySelectorAll('.btn.btn-toggle');
  let viewName = areaId.replace('Area', '');
  if (viewName === 'yearly') viewName = 'Yearly';
  else if (viewName === 'monthly') viewName = 'Monthly';
  else if (viewName === 'weekly') viewName = 'Weekly';
  else if (viewName === 'crypto') viewName = 'Crypto';
  buttons.forEach(btn => {
    const onclickStr = btn.getAttribute('onclick') || '';
    let isCurrent = false;
    if (viewName === 'Crypto') {
      isCurrent = onclickStr.includes('toggleCryptoView');
    } else {
      isCurrent = onclickStr.includes(`toggle${viewName}View`);
    }
    if (isCurrent) {
      btn.innerHTML = 'Back to Journal';
      btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
      btn.style.color = '#fff';
      btn.classList.add('btn-red');
    }
  });
}
// New: Gold Calculator Functions
function showGoldCalculator() {
  document.getElementById('goldCalculatorModal').style.display = 'block';
  document.getElementById('goldResultGroup').classList.remove('show');
  document.getElementById('formulaBox').classList.remove('show');
  document.getElementById('goldValue').value = '';
}
function calculateGold() {
  const goldValue = parseFloat(document.getElementById('goldValue').value);
  if (!goldValue || goldValue <= 0) {
    alert('Please enter a valid gold value');
    return;
  }
  const sqrtVal = Math.sqrt(goldValue);
  const addedVal = sqrtVal + 0.105;
  const finalVal = addedVal * addedVal;
  document.getElementById('goldOriginalValue').textContent = goldValue.toFixed(2);
  document.getElementById('goldSqrtValue').textContent = sqrtVal.toFixed(6);
  document.getElementById('goldAddedValue').textContent = addedVal.toFixed(6);
  document.getElementById('goldFinalValue').textContent = finalVal.toFixed(2);
  const rangeValue = finalVal - goldValue;
  const rangeMultiply2 = rangeValue * 2;
  const rangeMultiply4 = rangeMultiply2 * 2;
  document.getElementById('goldRangeValue').textContent = rangeValue.toFixed(2);
  document.getElementById('goldRangeMultiply2').textContent = rangeMultiply2.toFixed(2);
  document.getElementById('goldRangeMultiply4').textContent = rangeMultiply4.toFixed(2);
  const points = goldValue - finalVal;
  const upValue1 = goldValue - points;
  const upValue2 = upValue1 - points;
  const upValue3 = upValue2 - points;
  const upValue4 = upValue3 - points;
  const upValue5 = upValue4 - points;
  const downValue1 = points + goldValue;
  const downValue2 = downValue1 + points;
  const downValue3 = downValue2 + points;
  const downValue4 = downValue3 + points;
  const downValue5 = downValue4 + points;
  document.getElementById('goldUpValue1').textContent = upValue1.toFixed(2);
  document.getElementById('goldUpValue2').textContent = upValue2.toFixed(2);
  document.getElementById('goldUpValue3').textContent = upValue3.toFixed(2);
  document.getElementById('goldUpValue4').textContent = upValue4.toFixed(2);
  document.getElementById('goldUpValue5').textContent = upValue5.toFixed(2);
  document.getElementById('goldDownValue1').textContent = downValue1.toFixed(2);
  document.getElementById('goldDownValue2').textContent = downValue2.toFixed(2);
  document.getElementById('goldDownValue3').textContent = downValue3.toFixed(2);
  document.getElementById('goldDownValue4').textContent = downValue4.toFixed(2);
  document.getElementById('goldDownValue5').textContent =downValue5.toFixed(2);
  document.getElementById('goldResultGroup').classList.add('show');
}
function downloadGoldExcel() {
  const goldValue = parseFloat(document.getElementById('goldValue').value);
  const sqrtVal = Math.sqrt(goldValue);
  const addedVal = sqrtVal + 0.105;
  const finalVal = addedVal * addedVal;
  const points = goldValue - finalVal;
  const rangeValue = finalVal - goldValue;
  const rangeMultiply2 = rangeValue * 2;
  const rangeMultiply4 = rangeValue * 4;
  const upValue1 = goldValue - points;
  const upValue2 = upValue1 - points;
  const upValue3 = upValue2 - points;
  const upValue4 = upValue3 - points;
  const upValue5 = upValue4 - points;
  const downValue1 = points + goldValue;
  const downValue2 = downValue1 + points;
  const downValue3 = downValue2 + points;
  const downValue4 = downValue3 + points;
  const downValue5 = downValue4 + points;
  let csv = 'Gold Value Calculator\n\n';
  csv += 'BASIC CALCULATIONS\n';
  csv += 'Description,Value\n';
  csv += '"Today\'s Gold Opening Value","' + goldValue.toFixed(2) + '"\n';
  csv += '"Square Root","' + sqrtVal.toFixed(6) + '"\n';
  csv += '"After Adding 0.105","' + addedVal.toFixed(6) + '"\n';
  csv += '"Final Value (Squared)","' + finalVal.toFixed(2) + '"\n';
  csv += '"Points (Opening - Final)","' + points.toFixed(2) + '"\n\n';
  csv += 'RANGE VALUES\n';
  csv += '"Range Value (Final - Today)","' + rangeValue.toFixed(2) + '"\n';
  csv += '"Range Value Ã— 2","' + rangeMultiply2.toFixed(2) + '"\n';
  csv += '"Range Value Ã— 4","' + rangeMultiply4.toFixed(2) + '"\n\n';
  csv += 'UP VALUES\n';
  csv += 'UP Value 1,"' + upValue1.toFixed(2) + '"\n';
  csv += 'UP Value 2,"' + upValue2.toFixed(2) + '"\n';
  csv += 'UP Value 3,"' + upValue3.toFixed(2) + '"\n';
  csv += 'UP Value 4,"' + upValue4.toFixed(2) + '"\n';
  csv += 'UP Value 5,"' + upValue5.toFixed(2) + '"\n\n';
  csv += 'DOWN VALUES\n';
  csv += 'DOWN Value 1,"' + downValue1.toFixed(2) + '"\n';
  csv += 'DOWN Value 2,"' + downValue2.toFixed(2) + '"\n';
  csv += 'DOWN Value 3,"' + downValue3.toFixed(2) + '"\n';
  csv += 'DOWN Value 4,"' + downValue4.toFixed(2) + '"\n';
  csv += 'DOWN Value 5,"' + downValue5.toFixed(2) + '"\n';
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  link.setAttribute('href', url);
  link.setAttribute('download', 'GoldCalculation.csv');
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
document.getElementById('goldValue').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') calculateGold();
});
// Close Gold Modal on outside click
window.onclick = function(event) {
  const modal = document.getElementById('goldCalculatorModal');
  if (event.target === modal) {
    closeModal('goldCalculatorModal');
  }
};
// New: BTC Calculator Functions
function showBTCCalculator() {
  document.getElementById('btcCalculatorModal').style.display = 'block';
  calculateLevels2();
}
// Script 1 JS (prefixed)
const DIVISOR1 = 287;
function calculateResults1(dayRange) {
    if (!dayRange) return { level1: '', level2: '', level3: '' };
    const inputStr = dayRange.toString();
    let rangeWithoutDecimal;
    let rangeInteger;
    if (inputStr.includes('.')) {
        const range = parseFloat(dayRange);
        rangeWithoutDecimal = Math.round(range * 100);
        rangeInteger = Math.floor(range);
    } else {
        rangeWithoutDecimal = parseFloat(dayRange);
        rangeInteger = Math.floor(rangeWithoutDecimal / 100);
    }
    const dividedBy287 = rangeWithoutDecimal / DIVISOR1;
    const subtractedValue = dividedBy287 - rangeInteger;
    const level1Result = subtractedValue / 2;
    const level2Result = level1Result / 2;
    const level3Result = level2Result / 2;
    return {
        level1: level1Result.toFixed(2),
        level2: level2Result.toFixed(2),
        level3: level3Result.toFixed(2)
    };
}
function calculateAll1() {
    const inputs = document.querySelectorAll('.dayRangeInput');
    const level1Results = document.querySelectorAll('#level1Result1');
    const level2Results = document.querySelectorAll('#level2Result1');
    const level3Results = document.querySelectorAll('#level3Result1');
    inputs.forEach((input, idx) => {
        const results = calculateResults1(input.value);
        if (level1Results[idx]) level1Results[idx].textContent = results.level1 || '-';
        if (level2Results[idx]) level2Results[idx].textContent = results.level2 || '-';
        if (level3Results[idx]) level3Results[idx].textContent = results.level3 || '-';
    });
}
// Script 2 JS (prefixed)
function calculateLevels2(){
    const openingPrice = parseFloat(document.getElementById('openingPrice').value);
    if(isNaN(openingPrice) || openingPrice<=0){alert('Please enter a valid opening price!');return;}
    const sqrtP = Math.sqrt(openingPrice);
    const tbody = document.getElementById('resultsTable2');
    tbody.innerHTML='';
    for(let i=1;i<=6;i++){
        const tr=document.createElement('tr'); tr.className='data-row';
        const tdLU=document.createElement('td'); tdLU.className='level-col data-level'; tdLU.textContent=i; tr.appendChild(tdLU);
        const tdUp=document.createElement('td'); tdUp.className='upper-levels-col';
        tdUp.textContent=( (sqrtP+i)**2 ).toFixed(4); tr.appendChild(tdUp);
        const tdLL=document.createElement('td'); tdLL.className='level-col data-level'; tdLL.textContent=i; tr.appendChild(tdLL);
        const tdLow=document.createElement('td'); tdLow.className='lower-levels-col';
        tdLow.textContent=( (sqrtP-i)**2 ).toFixed(4); tr.appendChild(tdLow);
        tbody.appendChild(tr);
    }
}
document.getElementById('openingPrice').addEventListener('keypress',e=>{if(e.key==='Enter')calculateLevels2();});
// Script 3 JS (prefixed)
function sumProductDigits3(num) {
    const numStr = Math.abs(num).toString().replace('.', '');
    let sum = 0;
    for (let i = 0; i < numStr.length; i++) {
        sum += parseInt(numStr[i]);
    }
    return sum;
}
function calculate3() {
    const A2 = parseFloat(document.getElementById('valA3').value);
    const C2 = sumProductDigits3(A2);
    const D2 = C2 / 10;
    const E2 = Math.sqrt(A2);
    const F2 = E2 * D2;
    const G2 = F2 / 2;
    const H2 = G2 / 2;
    const I2 = H2 / 2;
    const J2 = I2 / 2;
    const E3 = E2 / 1.618;
    const F3 = F2 / 1.618;
    const G3 = G2 / 1.618;
    const H3 = H2 / 1.618;
    const E4 = E3;
    const F4 = E2 / 2.618;
    const G4 = E4 / 4.618;
    const H4 = G4 / 1.618;
    const E10 = G2 / 10;
    const F10 = E10 / 2;
    const G10 = E10 + F10;
    const resultBody = document.getElementById('resultBody3');
    resultBody.innerHTML = `
        <tr>
            <td>${A2}</td>
            <td class="empty-cell"></td>
            <td>${C2}</td>
            <td>${D2.toFixed(1)}</td>
            <td>${E2.toFixed(7)}</td>
            <td>${F2.toFixed(7)}</td>
            <td>${G2.toFixed(8)}</td>
            <td>${H2.toFixed(5)}</td>
            <td>${I2.toFixed(6)}</td>
            <td>${J2.toFixed(6)}</td>
        </tr>
        <tr>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td>${E3.toFixed(8)}</td>
            <td>${F3.toFixed(8)}</td>
            <td>${G3.toFixed(8)}</td>
            <td>${H3.toFixed(8)}</td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
        <tr>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td>${E4.toFixed(8)}</td>
            <td>${F4.toFixed(8)}</td>
            <td>${G4.toFixed(9)}</td>
            <td>${H4.toFixed(8)}</td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
        <tr class="highlight-row">
            <td class="empty-cell"></td>
            <td colspan="2" class="level-cell">
                <span class="level-button level-1">Level 1</span>
            </td>
            <td class="empty-cell"></td>
            <td><strong>${E10.toFixed(8)}</strong></td>
            <td><strong>${F10.toFixed(8)}</strong></td>
            <td><strong>${G10.toFixed(8)}</strong></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
        <tr class="highlight-row">
            <td class="empty-cell"></td>
            <td colspan="2" class="level-cell">
                <span class="level-button level-2">Level 2</span>
            </td>
            <td class="empty-cell"></td>
            <td><strong>${(E10 * 2).toFixed(8)}</strong></td>
            <td><strong>${(F10 * 2).toFixed(8)}</strong></td>
            <td><strong>${(G10 * 2).toFixed(8)}</strong></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
        <tr class="highlight-row">
            <td class="empty-cell"></td>
            <td colspan="2" class="level-cell">
                <span class="level-button level-3">Level 3</span>
            </td>
            <td class="empty-cell"></td>
            <td><strong>${(E10 * 3).toFixed(8)}</strong></td>
            <td><strong>${(F10 * 3).toFixed(8)}</strong></td>
            <td><strong>${(G10 * 3).toFixed(8)}</strong></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
        <tr class="highlight-row">
            <td class="empty-cell"></td>
            <td colspan="2" class="level-cell">
                <span class="level-button level-4">Level 4</span>
            </td>
            <td class="empty-cell"></td>
            <td><strong>${(E10 * 4).toFixed(8)}</strong></td>
            <td><strong>${(F10 * 4).toFixed(8)}</strong></td>
            <td><strong>${(G10 * 4).toFixed(8)}</strong></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
            <td class="empty-cell"></td>
        </tr>
    `;
}
document.getElementById('valA3').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    calculate3();
  }
});
// Close BTC Modal on outside click
window.onclick = function(event) {
  const modal = document.getElementById('btcCalculatorModal');
  if (event.target === modal) {
    closeModal('btcCalculatorModal');
  }
};
// New: Nifty Setup Functions
function showNiftySetup() {
  document.getElementById('niftySetupModal').style.display = 'block';
  calculateNifty(); // Auto-calculate on open
}
function calculateNifty() {
  const openPrice = parseFloat(document.getElementById('niftyOpenPrice').value);
  if (isNaN(openPrice) || openPrice <= 0) {
    alert('âš ï¸ Please enter a valid Opening Price!');
    return;
  }
  // Calculate Angle = MOD(SQRT(Opening)*180-225, 360)
  let angle = (Math.sqrt(openPrice) * 180 - 225) % 360;
  if (angle < 0) angle += 360;
  // Calculate Unit = Angle / 60
  const unit = angle / 60;
  // Calculate Candle = TRUNC(Unit)
  const candle = Math.trunc(unit);
  // Display results
  document.getElementById('niftyAngleDisplay').textContent = angle.toFixed(2);
  document.getElementById('niftyUnitDisplay').textContent = unit.toFixed(7) + ' Unit';
  document.getElementById('niftyCandleDisplay').textContent = candle;
  // Add animation to candle
  const candleCell = document.getElementById('niftyCandleDisplay');
  candleCell.classList.remove('pulse-animation');
  setTimeout(() => {
    candleCell.classList.add('pulse-animation');
  }, 10);
}
// Enter key support for Nifty input
document.getElementById('niftyOpenPrice').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    calculateNifty();
  }
});
// Close Nifty Modal on outside click
window.onclick = function(event) {
  const modal = document.getElementById('niftySetupModal');
  if (event.target === modal) {
    closeModal('niftySetupModal');
  }
};
// New: Range Calculator Functions - Embedded from Script 2
function showRangeCalculator() {
  document.getElementById('rangeCalculatorModal').style.display = 'block';
  // Render React component
  const RangeCalculatorComponent = () => {
    const [instruments, setInstruments] = React.useState([
      { name: 'BANKNIFTY', movement: '', multiplier: 0.326 },
      { name: 'NIFTY', movement: '', multiplier: 0.326 },
      { name: 'SENSEX', movement: '', multiplier: 0.326 },
      { name: 'BTC', movement: '', multiplier: 0.326 },
      { name: 'GOLD', movement: '', multiplier: 0.326 }
    ]);
    const calculateRange = (movement, multiplier) => {
      return movement && multiplier ? (movement * multiplier).toFixed(6) : '';
    };
    const handleUpdate = (index, field, value) => {
      const updated = [...instruments];
      updated[index][field] = field === 'name' ? value : parseFloat(value) || '';
      setInstruments(updated);
    };
    const resetAll = () => {
      const resetData = instruments.map(item => ({ ...item, movement: '' }));
      setInstruments(resetData);
    };
    const colors = [
      'from-blue-500 to-blue-600',
      'from-purple-500 to-purple-600',
      'from-red-500 to-red-600',
      'from-pink-500 to-pink-600',
      'from-green-500 to-green-600'
    ];
    return React.createElement(
      'div',
      { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8' },
      React.createElement(
        'div',
        { className: 'max-w-6xl mx-auto' },
        // Title
        React.createElement(
          'div',
          { className: 'text-center mb-12' },
          React.createElement(
            'button',
            {
              onClick: resetAll,
              className: 'bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white text-4xl font-extrabold px-12 py-6 rounded-2xl shadow-2xl hover:scale-105 hover:shadow-pink-500/50 transition-all duration-300 ease-in-out uppercase tracking-wider'
            },
            'ðŸ’« Range Calculator ðŸ’«'
          )
        ),
        // Table
        React.createElement(
          'div',
          { className: 'bg-white rounded-2xl shadow-2xl overflow-hidden' },
          React.createElement(
            'table',
            { className: 'w-full border-collapse' },
            React.createElement(
              'thead',
              null,
              React.createElement(
                'tr',
                { className: 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white' },
                React.createElement(
                  'th',
                  { className: 'border-2 border-indigo-700 p-6 text-center font-bold text-xl' },
                  'Instruments'
                ),
                React.createElement(
                  'th',
                  { className: 'border-2 border-indigo-700 p-6 text-center font-bold text-xl' },
                  'Enter Previous Day Value'
                ),
                React.createElement(
                  'th',
                  { className: 'border-2 border-indigo-700 p-6 text-center font-bold text-xl' },
                  'Range Value'
                )
              )
            ),
            React.createElement(
              'tbody',
              null,
              instruments.map((instrument, index) => {
                const colorGradient = instrument.name === 'Gold' ? 'from-amber-400 via-yellow-500 to-orange-600' : colors[index % colors.length];
                const range = calculateRange(instrument.movement, instrument.multiplier);
                return React.createElement(
                  'tr',
                  { key: index, className: 'hover:bg-gray-50 transition' },
                  // Instrument Button
                  React.createElement(
                    'td',
                    { className: 'border-2 border-gray-300 p-6 text-center' },
                    React.createElement(
                      'button',
                      {
                        className: `bg-gradient-to-r ${colorGradient} text-white px-8 py-4 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition transform hover:scale-105 w-full`
                      },
                      instrument.name
                    )
                  ),
                  // Input
                  React.createElement(
                    'td',
                    { className: 'border-2 border-gray-300 p-6 text-center' },
                    React.createElement(
                      'input',
                      {
                        type: 'number',
                        value: instrument.movement,
                        onChange: (e) => handleUpdate(index, 'movement', e.target.value),
                        placeholder: 'Enter value',
                        className: 'bg-gradient-to-r from-gray-700 to-gray-800 text-white px-8 py-4 rounded-lg font-semibold text-lg text-center border-2 border-gray-600 hover:border-gray-400 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-300 transition shadow-lg placeholder-gray-400 w-full'
                      }
                    )
                  ),
                  // Output
                  React.createElement(
                    'td',
                    { className: 'border-2 border-gray-300 p-6 text-center' },
                    React.createElement(
                      'div',
                      {
                        className: 'bg-gradient-to-r from-teal-400 via-emerald-500 to-green-600 text-white px-8 py-4 rounded-lg font-bold text-xl shadow-lg flex items-center justify-center transition-all duration-300 hover:shadow-emerald-500/40 hover:scale-105'
                      },
                      range || 'â€”'
                    )
                  )
                );
              })
            )
          )
        )
      )
    );
  };
  ReactDOM.render(React.createElement(RangeCalculatorComponent), document.getElementById('range-root'));
}
// Close Range Modal on outside click
window.onclick = function(event) {
  const modal = document.getElementById('rangeCalculatorModal');
  if (event.target === modal) {
    closeModal('rangeCalculatorModal');
    ReactDOM.unmountComponentAtNode(document.getElementById('range-root')); // Clean up React
  }
};
// Daily PNL Functions
let dailyChart;
function updateDailyPNL() {
  const date = document.getElementById('dailyDate').value;
  const dailyTrades = trades.filter(t => t.date === date);
  const pnlData = dailyTrades.map(t => {
    const isBuyer = t.type.startsWith('BUY') || t.type === 'LONG';
    const diff = isBuyer ? (t.exit - t.entry) : (t.entry - t.exit);
    return {instrument: t.instrument, type: t.type, entry: t.entry, exit: t.exit, lots: t.qty, quantity: t.qty * t.lotsize, points: diff.toFixed(0), pnl: t.pl};
  });
  // Render chart
  const ctx = document.getElementById('dailyChart').getContext('2d');
  if (dailyChart) dailyChart.destroy();
  dailyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: pnlData.map(d => d.instrument),
     datasets: [{
        label: 'P&L',
        data: pnlData.map(d => d.pnl),
        backgroundColor: pnlData.map(d => d.pnl >= 0 ? '#16a34a' : '#dc2626')
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          title: {
            display: true,
            text: 'Instruments'
          },
          barPercentage: 0.5,
          categoryPercentage: 0.6
        },
        y: {
          title: {
            display: true,
            text: 'P&L (â‚¹)'
          }
        }
      }
    }
  });
  // Render table
  const tbody = document.getElementById('dailyTable').querySelector('tbody');
  tbody.innerHTML = pnlData.map(d => `<tr><td>${d.instrument}</td><td>${d.type}</td><td>â‚¹${formatCurrency(d.entry)}</td><td>â‚¹${formatCurrency(d.exit)}</td><td>${d.lots}</td><td>${d.quantity}</td><td>${d.points}</td><td class="${d.pnl >= 0 ? 'profit' : 'loss'}">â‚¹${formatCurrency(d.pnl)}</td></tr>`).join('');
  if (pnlData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8">No trades for this day</td></tr>';
  }
  // New: Update Final PNL Button
  const totalPNL = pnlData.reduce((sum, d) => sum + d.pnl, 0);
  const finalBtn = document.getElementById('finalPNLBtn');
  finalBtn.style.display = 'block';
  finalBtn.textContent = `Final PNL: â‚¹${formatCurrency(totalPNL)}`;
  finalBtn.className = `final-pnl-btn ${totalPNL < 0 ? 'loss' : ''}`;
}
function formatDate(isoDate) {
  if (!isoDate) return '';
  const [year, month, day] = isoDate.split('-');
  return `${day}-${month}-${year}`;
}
function formatCurrency(value) {
  return Number(value).toLocaleString('en-IN', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}
window.onload = () => {
  const now = new Date();
  currentViewYear = now.getFullYear();
  currentViewMonth = now.getMonth() + 1;
  currentWeeklyYear = now.getFullYear();
  currentWeeklyMonth = now.getMonth() + 1;
  initGoldenScroll(); // Initialize the scrolling golden words
  loadData();
  dedupeActionButtons();
  render();
  updateStats();
  renderMonthly();
  renderYearlyTable();
  if (notificationsEnabled) {
    document.getElementById('notificationToggle').innerHTML = '<span class="icon">ðŸ›Žï¸</span> Notifications (On)';
  }
};
</script>
</body>
</html>
  <!-- ðŸ’š Blinking View-Only Mode Badge -->
  <div class="viewOnlyBadge">View-Only Mode Enabled â€” Editing Locked</div>

  <!-- ðŸ”´ Back To Journal Button -->
  <button
    class="backToJournal"
    data-allow="true"
    onclick="window.location.href='https://livetradingjunction-cyber.github.io/Live-trading-Junction-Journal/'"
  >
    â¬… Back To Journal
  </button>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const lockedTags = ["INPUT", "TEXTAREA", "SELECT", "BUTTON"];
      const lockedEls = document.querySelectorAll(lockedTags.join(","));
      lockedEls.forEach((el) => {
        if (el.getAttribute("data-allow") === "true") return;
        el.disabled = true;
        el.classList.add("viewOnlyDim");
      });

      const anchors = document.querySelectorAll("a");
      anchors.forEach((a) => {
        if (a.getAttribute("data-allow") === "true") return;
        a.classList.add("viewOnlyDim");
        a.addEventListener("click", (e) => e.preventDefault());
      });

      console.log("âœ… View-only mode active. Inputs locked except Back To Journal.");
    });
  </script>
</body>
</html>
